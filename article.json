{"praise_nums": 1, "front_image_path": "full/4e7eaa407bd1631ba66460fdfd5f28b74d8dd767.jpg", "tags": "", "comment_nums": 0, "url_object_id": "e27337ad29009266355840120fc7da9b", "url": "http://python.jobbole.com/87566/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/panzi/p/6421826.html\">丶Pz</a>   </div><h2>前言</h2>\n<p>最近业余在做一个基于.NET Core的搜索项目，奈何基层代码写好了，没有看起来很华丽的数据供测试。很巧的也是博客搜索，于是乎想到了博客园。C#也能做做页面数据抓取的，不过在博客园看到的大部分都是python实现，所以就临时想了一下看看python到底是什么东东，不看基础语法，不看语言功能，直接上代码，哪里不会搜哪里。代码完成总共用时大概4个小时，其中搭建环境加安装BeautifulSoup大概1个小时。解析HTML用时间最多了，边看demo边解析，大概2个小时，剩下的时间就是调试加保存数据了。</p>\n<h2>环境搭建</h2>\n<p>既然用python，那么自然少不了语言环境。于是乎到官网下载了3.5版本的。安装完之后，随机选择了一个编辑器叫PyCharm，话说python编辑器还真挺多的。由于本人是小白，所以安装事项不在过多赘述。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/65c23ba3dc06a55f818ec9bfc8b01e96.png\" alt=\"\"></p>\n<p>建好项目，打开编辑器，直接开工。本来之前用C#写的时候，大体思路就是获取网页内容，然后正则匹配。后来发现网上的帖子也很多。不过在搜索过程中发现，不建议用正则来匹配HTML。有正好我的正则不太好，所以我就搜了一下HTML解析工具，果不其然，人家都做好了，直接拿来用吧。没错就是这个东东：<strong>BeautifulSoup 。</strong>安装也很简单，不过中间出了个小插曲，就是bs4没有。继续搜，然后需要用pip安装一下就好了。（当然我并不知道ps4和pip是什么鬼）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/3b36ddf2d5289542890ddc537c00ea7a.png\" alt=\"\"></p>\n<h2>思路分析</h2>\n<p>博客吗，我当然就对准了博客园，于是乎，进入博客园首页，查看请求。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/69fb6594ddfb9f42536d459a68ea47f3.png\" alt=\"\"></p>\n<h2>发送请求</h2>\n<p>当然我不知道python是怎么进行网络请求的，其中还有什么2.0和3.0的不同，中间曲曲折折了不少，最终还是写出了最简单的一段请求代码。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6249096685496130\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport urllib.parse\r\nimport urllib.request\r\n\r\n# params  CategoryId=808 CategoryType=SiteHome ItemListActionName=PostList PageIndex=3 ParentCategoryId=0 TotalPostCount=4000\r\ndef getHtml(url,values):\r\n    user_agent='Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36'\r\n    headers = {'User-Agent':user_agent}\r\n    data = urllib.parse.urlencode(values)\r\n    response_result = urllib.request.urlopen(url+'?'+data).read()\r\n    html = response_result.decode('utf-8')\r\n    return html\r\n\r\n#获取数据\r\ndef requestCnblogs(index):\r\n    print('请求数据')\r\n    url = 'http://www.cnblogs.com/mvc/AggSite/PostList.aspx'\r\n    value= {\r\n         'CategoryId':808,\r\n         'CategoryType' : 'SiteHome',\r\n         'ItemListActionName' :'PostList',\r\n         'PageIndex' : index,\r\n         'ParentCategoryId' : 0,\r\n        'TotalPostCount' : 4000\r\n    }\r\n    result = getHtml(url,value)\r\n    return result</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6249096685496130-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6249096685496130-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-4\"><span class=\"crayon-p\"># params  CategoryId=808 CategoryType=SiteHome ItemListActionName=PostList PageIndex=3 ParentCategoryId=0 TotalPostCount=4000</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getHtml</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">user_agent</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36'</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">user_agent</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-12\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-13\"><span class=\"crayon-p\">#获取数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-14\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">requestCnblogs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'请求数据'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.cnblogs.com/mvc/AggSite/PostList.aspx'</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'CategoryId'</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">808</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-19\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'CategoryType'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SiteHome'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-20\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'ItemListActionName'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'PostList'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-21\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'PageIndex'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-22\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'ParentCategoryId'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'TotalPostCount'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6249096685496130-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHtml</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6249096685496130-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n\n</div>\n<p>其实博客园这个请求还是挺标准的，哈哈正好适合抓取。因为他返回的就是一段html。（如果返回json那不是更好。。。。）</p>\n<h2>数据解析</h2>\n<p>上文已经提到了，用到的是BeautifulSoup，好处就是不用自己写正则，只要根据他的语法来写就好了，在多次的测试之后终于完成了数据的解析。先上一段HTML。然后在对应下面的代码，也许看起来更轻松一些。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be62490a0253830559\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;div class=\"post_item\"&gt;\r\n    &lt;div class=\"digg\"&gt;\r\n        &lt;div class=\"diggit\" onclick=\"DiggPost('hyper-xl',6417741,281238,1)\"&gt;\r\n            &lt;span class=\"diggnum\" id=\"digg_count_6417741\"&gt;1&lt;/span&gt;\r\n        &lt;/div&gt;\r\n        &lt;div class=\"clear\"&gt;&lt;/div&gt;\r\n        &lt;div id=\"digg_tip_6417741\" class=\"digg_tip\"&gt;&lt;/div&gt;\r\n    &lt;/div&gt;\r\n    &lt;div class=\"post_item_body\"&gt;\r\n        &lt;h3&gt;&lt;a class=\"titlelnk\" href=\"http://www.cnblogs.com/hyper-xl/p/6417741.html\" target=\"_blank\"&gt;Python 字符串格式化&lt;/a&gt;&lt;/h3&gt;\r\n\r\n\r\n        &lt;p class=\"post_item_summary\"&gt;\r\n            &lt;a href=\"http://www.cnblogs.com/hyper-xl/\" target=\"_blank\"&gt;\r\n                &lt;img width=\"48\" height=\"48\" class=\"pfs\"\r\n                     src=\"//pic.cnblogs.com/face/795666/20160421231717.png\" alt=\"\" /&gt;\r\n            &lt;/a&gt;    转载请注明出处 Python2.6+ 增加了str.format函数，用来代替原有的'%'操作符\r\n\r\n            。它使用比'%'更加直观、灵活。下面详细介绍一下它的使用方法。 下面是使用'%'的例子: 格式很像C语言的printf是不是？由于'%'是一个操作符，只能在左右\r\n\r\n            两边各放一个参数，因此右边多个值需要用元组或 ...\r\n        &lt;/p&gt;\r\n\r\n        &lt;div class=\"post_item_foot\"&gt;\r\n            &lt;a href=\"http://www.cnblogs.com/hyper-xl/\" class=\"lightblue\"&gt;新月的力量_141&lt;/a&gt;\r\n            发布于 2017-02-19 23:07\r\n            &lt;span class=\"article_comment\"&gt;\r\n                &lt;a href=\"http://www.cnblogs.com/hyper-xl/p/6417741.html#commentform\" title=\"\" class=\"gray\"&gt;\r\n                    评论(0)\r\n                &lt;/a&gt;\r\n            &lt;/span&gt;\r\n            &lt;span class=\"article_view\"&gt;\r\n                &lt;a href=\"http://www.cnblogs.com/hyper-xl/p/6417741.html\" class=\"gray\"&gt;\r\n                    阅读\r\n\r\n                    (138)\r\n                &lt;/a&gt;\r\n            &lt;/span&gt;\r\n        &lt;/div&gt;\r\n    &lt;/div&gt;\r\n    &lt;div class=\"clear\"&gt;&lt;/div&gt;\r\n&lt;/div&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490a0253830559-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490a0253830559-42\">42</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"post_item\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"digg\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"diggit\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">onclick</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"DiggPost('hyper-xl',6417741,281238,1)\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"diggnum\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"digg_count_6417741\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"clear\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"digg_tip_6417741\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"digg_tip\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"post_item_body\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"titlelnk\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.cnblogs.com/hyper-xl/p/6417741.html\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"_blank\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-i\">Python</span><span class=\"crayon-h\"> </span>字符串格式化<span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-12\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"post_item_summary\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.cnblogs.com/hyper-xl/\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"_blank\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">img </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"48\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"48\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"pfs\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-16\"><span class=\"crayon-h\">                     </span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"//pic.cnblogs.com/face/795666/20160421231717.png\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alt</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">    </span>转载请注明出处<span class=\"crayon-h\"> </span><span class=\"crayon-v\">Python2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span>增加了<span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">format</span>函数，用来代替原有的<span class=\"crayon-s\">'%'</span>操作符</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-18\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-19\"><span class=\"crayon-h\">            </span>。它使用比<span class=\"crayon-s\">'%'</span>更加直观、灵活。下面详细介绍一下它的使用方法。<span class=\"crayon-h\"> </span>下面是使用<span class=\"crayon-s\">'%'</span>的例子<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>格式很像<span class=\"crayon-i\">C</span>语言的<span class=\"crayon-i\">printf</span>是不是？由于<span class=\"crayon-s\">'%'</span>是一个操作符，只能在左右</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-20\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-21\"><span class=\"crayon-h\">            </span>两边各放一个参数，因此右边多个值需要用元组或<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"post_item_foot\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.cnblogs.com/hyper-xl/\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"lightblue\"</span><span class=\"crayon-o\">&gt;</span>新月的力量<span class=\"crayon-v\">_141</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-26\"><span class=\"crayon-h\">            </span>发布于<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"article_comment\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-28\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.cnblogs.com/hyper-xl/p/6417741.html#commentform\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"gray\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-29\"><span class=\"crayon-h\">                    </span>评论<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"article_view\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.cnblogs.com/hyper-xl/p/6417741.html\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"gray\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-34\"><span class=\"crayon-h\">                    </span>阅读</div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-36\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">138</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490a0253830559-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"clear\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490a0253830559-42\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0078 seconds] -->\r\n\n</div>\n<p>通过上文的HTML代码可以看到几点。首先每一条数据都在 div(class=”post_item”)下。然后 div(“post_item_body”)下有用户信息，标题，链接，简介等信息。逐一根据样式解析即可。代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be62490ae087975701\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom bs4 import BeautifulSoup\r\nimport request\r\nimport re\r\n\r\n#解析最外层\r\ndef blogParser(index):\r\n\r\n  cnblogs = request.requestCnblogs(index)\r\n  soup = BeautifulSoup(cnblogs, 'html.parser')\r\n  all_div = soup.find_all('div', attrs={'class': 'post_item_body'}, limit=20)\r\n\r\n  blogs = []\r\n  #循环div获取详细信息\r\n  for item in all_div:\r\n      blog = analyzeBlog(item)\r\n      blogs.append(blog)\r\n\r\n  return blogs\r\n\r\n#解析每一条数据\r\ndef analyzeBlog(item):\r\n    result = {}\r\n    a_title = find_all(item,'a','titlelnk')\r\n    if a_title is not None:\r\n        # 博客标题\r\n        result[\"title\"] = a_title[0].string\r\n        # 博客链接\r\n        result[\"href\"] = a_title[0]['href']\r\n    p_summary = find_all(item,'p','post_item_summary')\r\n    if p_summary is not None:\r\n        # 简介\r\n        result[\"summary\"] = p_summary[0].text\r\n    footers = find_all(item,'div','post_item_foot')\r\n    footer = footers[0]\r\n    # 作者\r\n    result[\"author\"] = footer.a.string\r\n    # 作者url\r\n    result[\"author_url\"] = footer.a['href']\r\n    str = footer.text\r\n    time = re.findall(r\"发布于 .+? .+? \", str)\r\n    result[\"create_time\"] = time[0].replace('发布于 ','')\r\n\r\n    comment_str = find_all(footer,'span','article_comment')[0].a.string\r\n    result[\"comment_num\"] = re.search(r'\\d+', comment_str).group()\r\n\r\n    view_str = find_all(footer,'span','article_view')[0].a.string\r\n    result[\"view_num\"] = re.search(r'\\d+', view_str).group()\r\n\r\n    return result\r\n\r\ndef find_all(item,attr,c):\r\n    return item.find_all(attr,attrs={'class':c},limit=1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490ae087975701-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490ae087975701-52\">52</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">re</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-5\"><span class=\"crayon-p\">#解析最外层</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">blogParser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">cnblogs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">requestCnblogs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cnblogs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">all_div</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'post_item_body'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">blogs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-p\">#循环div获取详细信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">all_div</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">blog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">analyzeBlog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">blogs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blogs</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-20\"><span class=\"crayon-p\">#解析每一条数据</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-21\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">analyzeBlog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a_title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'titlelnk'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a_title </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 博客标题</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a_title</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 博客链接</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"href\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a_title</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p_summary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'post_item_summary'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p_summary </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 简介</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"summary\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p_summary</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-33\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">footers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'post_item_foot'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">footer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">footers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 作者</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"author\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">footer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 作者url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"author_url\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">footer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">footer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-40\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"发布于 .+? .+? \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"create_time\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'发布于 '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-42\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comment_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">footer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'span'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'article_comment'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"comment_num\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'\\d+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment_str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">view_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">footer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'span'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'article_view'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"view_num\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'\\d+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view_str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-48\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">result</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-50\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490ae087975701-51\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490ae087975701-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">limit</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0092 seconds] -->\r\n\n</div>\n<p>上边一堆代码下来，着实花费了我不少时间，边写边调试，边百度~~不过还好最终还是出来了。等数据都整理好之后，然后我把它保存到了txt文件里面，以供其他语言来处理。本来想写个put直接put到ElasticSearch中，奈何没成功。后边在试吧，毕竟我的重点只是导数据，不在抓取这里。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be62490b4714077752\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport match\r\nimport os\r\nimport datetime\r\nimport json\r\n\r\ndef writeToTxt(list_name,file_path):\r\n    try:\r\n        #这里直接write item 即可，不要自己给序列化在写入，会导致json格式不正确的问题\r\n        fp = open(file_path,\"w+\",encoding='utf-8')\r\n        l = len(list_name)\r\n        i = 0\r\n        fp.write('[')\r\n        for item in list_name:\r\n            fp.write(item)\r\n            if i&lt;l-1:\r\n                fp.write(',\\n')\r\n            i += 1\r\n        fp.write(']')\r\n        fp.close()\r\n    except IOError:\r\n        print(\"fail to open file\")\r\n\r\n#def getStr(item):\r\n#   return json.dumps(item).replace('\\'','\\\"')+',\\n'\r\n\r\ndef saveBlogs():\r\n    for i in range(1,2):\r\n        print('request for '+str(i)+'...')\r\n        blogs = match.blogParser(i,5)\r\n        #保存到文件\r\n        path = createFile()\r\n        writeToTxt(blogs,path+'/blog_'+ str(i) +'.json')\r\n        print('第'+ str(i) +'页已经完成')\r\n    return 'success'\r\n\r\ndef createFile():\r\n    date = datetime.datetime.now().strftime('%Y-%m-%d')\r\n    path = '/'+date\r\n    if os.path.exists(path):\r\n        return path\r\n    else:\r\n        os.mkdir(path)\r\n        return path\r\n\r\nresult = saveBlogs()\r\nprint(result)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2be62490b4714077752-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be62490b4714077752-46\">46</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">match</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">os</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">datetime</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">writeToTxt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">list_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">file_path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#这里直接write item 即可，不要自己给序列化在写入，会导致json格式不正确的问题</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"w+\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">list_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'['</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list_name</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">l</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">',\\n'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">']'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">IOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fail to open file\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-22\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-23\"><span class=\"crayon-p\">#def getStr(item):</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-24\"><span class=\"crayon-p\">#   return json.dumps(item).replace('\\'','\\\"')+',\\n'</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-26\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">saveBlogs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'request for '</span><span class=\"crayon-o\">+</span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'...'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">blogs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">blogParser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#保存到文件</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">createFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">writeToTxt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blogs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'/blog_'</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'.json'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'第'</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'页已经完成'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'success'</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-36\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">createFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strftime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'%Y-%m-%d'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-o\">+</span><span class=\"crayon-e\">date</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-39\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-41\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mkdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-44\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be62490b4714077752-45\"><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">saveBlogs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be62490b4714077752-46\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n\n</div>\n<p>上边呢，我取了一百页的数据，也就是大概2000条做测试。</p>\n<h2>成果验收</h2>\n<p>废了好大劲终于写完那些代码之后呢，就可以享受胜利的果实了，虽然是初学者，代码写的很渣，这参考一下，那参考一下，不过还是有些收获的。运行效果如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/1c0adc7316ffdad1dcc6049de071a7bc.png\" alt=\"\"></p>\n<p>生成的文件：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/b7866d727aa55b2374ac109604022917.png\" alt=\"\"></p>\n<p>文件内容：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/83bfe3b21187c2fba00459c2d52e7d89.png\" alt=\"\"></p>\n<h2>总结</h2>\n<p>一个简单的抓取程序就写完了，python还真是TM的好用。以后有空再研究研究吧。代码行数算上空行和注释总共<strong> 100</strong> （50+25+25） 行。凑个整数好看点~~现在认识字我感觉就可以上手写程序了。这里百度一下，那里google一下，问题就解决了，程序也出来了，大功告成。</p>\n<p>是时候该和python暂时告别了，继续我的.NET事业。话说上次做rss采集的时候，好多“.NET要完蛋了”，“为什么我们不招.NET” 是什么鬼。 小伙伴们，下次见。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87566\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87566votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87566\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/65c23ba3dc06a55f818ec9bfc8b01e96.png"], "title": "一个Python小白5个小时爬虫经历", "fav_nums": 0}
{"praise_nums": 2, "front_image_path": "full/6d203868fce1b612a5bf3099f7df90543cc9b3e3.jpg", "tags": "", "comment_nums": 0, "url_object_id": "86bc04c79dec06b8822a704f64be3930", "url": "http://python.jobbole.com/87535/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.kdnuggets.com/2016/11/top-20-python-machine-learning-open-source-updated.html\">Prasad Pore</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p> </p>\n<p>如今开源是创新的核心，推动着技术的飞速革新。本文会为你介绍 2016 年机器学习 Top 20 Python 开源项目，同时分析得出一些有趣的见解和发展趋势。</p>\n<p>KDnuggets 为您带来 <a href=\"http://www.kdnuggets.com/2015/06/top-20-python-machine-learning-open-source-projects.html\">Github 上最新的 Python 机器学习开源项目前 20 名</a>。奇怪的是，去年一些非常活跃的项目渐渐停滞了，因此没能上榜，而 13 个新项目冲进了今年的 top 20（参考贡献 contributions 和提交数 commits）。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/large/63918611gy1fe0izuhdicj217k0wgdiw.jpg\" width=\"1568\" height=\"1168\"></p>\n<p><strong>2016 Top 20 Python</strong> <strong>机器学习开源项目</strong></p>\n<p><strong>1. </strong><a href=\"http://scikit-learn.org/\"><strong>Scikit-learn</strong></a> 是一个简单且高效的数据挖掘和数据分析工具，易上手，可以在多个上下文中重复使用。它基于NumPy, SciPy 和 matplotlib，开源，可商用（基于 BSD 许可）</p>\n<p>提交数: 21486, 贡献者: 736, Github 链接: <a href=\"http://github.com/scikit-learn/scikit-learn\">Scikit-learn</a></p>\n<p><strong>2. </strong><a href=\"https://www.tensorflow.org/\"><strong>Tensorflow</strong></a> 最初由谷歌机器智能科研组织中的谷歌大脑团队（Google Brain Team）的研究人员和工程师开发。该系统设计的初衷是为了便于机器学习研究，能够更快更好地将科研原型转化为生产项目。</p>\n<p>提交数: 10466, 贡献者: 493, Github 链接: <a href=\"https://github.com/tensorflow/tensorflow\">Tensorflow</a></p>\n<p><strong>3. </strong><a href=\"http://deeplearning.net/software/theano/\"><strong>Theano</strong></a> 允许高效地定义、优化以及评估涉及多维数组的数学表达式. 提交数: 24108, 贡献者: 263, Github 链接: <a href=\"https://github.com/Theano/Theano\">Theano</a></p>\n<p><strong>4. </strong><a href=\"http://caffe.berkeleyvision.org/\"><strong>Caffe</strong></a> 是一个基于表达式，速度和模块化原则创建的深度学习框架。它由伯克利视觉学习中心（BVLC, Berkeley Vision and Learning Center）和社区贡献者共同开发。 提交数: 3801, 贡献者: 215, Github 链接: <a href=\"https://github.com/BVLC/caffe\">Caffe</a></p>\n<p><strong>5. </strong><a href=\"https://radimrehurek.com/gensim/\"><strong>Gensim</strong></a> 是一个免费的 Python 库，它包含可扩展的统计语义，分析纯文本文档的语义结构，以及检索相似语义的文档等功能。</p>\n<p>提交数: 2702, 贡献者: 145, Github 链接: <a href=\"https://github.com/RaRe-Technologies/gensim\">Gensim</a></p>\n<p><strong>6. </strong><a href=\"http://deeplearning.net/software/pylearn2/\"><strong>Pylearn2</strong></a> 是一个机器学习库。它的大多数功能都是构建于<a href=\"http://deeplearning.net/software/theano/\">Theano</a> 之上的。这意味着你可以利用数学表达式自己写 Pylearn2 插件（新模型，算法等等），Theano 会为你优化这些表达式使其更加稳定，你还可以选择将其编译到后端（CPU 或 GPU）。</p>\n<p>提交数: 7100, 贡献者: 115, Github 链接: <a href=\"http://github.com/lisa-lab/pylearn2\">Pylearn2</a></p>\n<p><strong>7. </strong><a href=\"http://statsmodels.sourceforge.net/\"><strong>Statsmodels</strong></a> 是一个 Python 模块，可以用来探索数据，估计统计模型，进行统计测试。对于不同类型的数据和模型估计，都有描述性统计，统计测试，绘图功能和结果统计的详细列表可用。</p>\n<p>提交数: 8664, 贡献者: 108, Github 链接: <a href=\"https://github.com/statsmodels/statsmodels/\">Statsmodels</a></p>\n<p><strong>8. </strong><a href=\"http://shogun-toolbox.org/\"><strong>Shogun</strong></a> 是一个机器学习工具箱，它提供了很多统一高效的机器学习方法。这个工具箱允许多个数据表达，算法类和通用工具无缝组合。</p>\n<p>提交数: 15172 贡献者: 105, Github 链接: <a href=\"https://github.com/shogun-toolbox/shogun\">Shogun</a></p>\n<p><strong>9. </strong><a href=\"http://chainer.org/\"><strong>Chainer</strong></a> 是一个基于 Python 的独立的深度学习模型开源框架。Chainer 提供了灵活、直观且高性能的方法实现全方位的深度学习模型，包括循环神经网络 (recurrent neural networks) 和变分自编码器(variational autoencoders)这些最新的模型 。</p>\n<p>提交数: 6298, 贡献者: 84, Github 链接: <a href=\"https://github.com/pfnet/chainer\">Chainer</a></p>\n<p><strong>10. </strong><a href=\"http://numenta.org/\"><strong>NuPIC</strong></a> 是一个基于 HTM 算法 (Hierarchical Temporal Memory) 的开源项目。HTM 的一部分已经通过实践、测试和应用，另一部分仍在开发之中。</p>\n<p>提交数: 6088, 贡献者: 76, Github 链接: <a href=\"http://github.com/numenta/nupic\">NuPIC</a></p>\n<p><strong>11. </strong><a href=\"http://neon.nervanasys.com/\"><strong>Neon</strong></a> 是 <a href=\"http://nervanasys.com/\">Nervana</a> 公司一个基于 Python 的深度学习库。它易于使用且具有超高的性能。</p>\n<p>提交数: 875, 贡献者: 47, Github 链接: <a href=\"https://github.com/NervanaSystems/neon\">Neon</a></p>\n<p><strong>12. </strong><a href=\"https://nilearn.github.io/\"><strong>Nilearn</strong></a> 是一个 Python 模块，用于在神经成像 (NeuroImaging) 数据上进行快速简单的统计学习。它利用 <a href=\"http://scikit-learn.org/\">scikit-learn</a> Python 工具箱来处理多变量统计信息，包括预测建模，分类，解码或连接分析.</p>\n<p>提交数: 5254, 贡献者: 46, Github 链接: <a href=\"http://github.com/nilearn/nilearn\">Nilearn</a></p>\n<p><strong>13. </strong><a href=\"http://orange.biolab.si/orange3/\"><strong>Orange3</strong></a> 是一个同时适用于新手和数据专家的机器学习和数据可视化开源软件，支持拥有大型工具箱的交互式数据分析工作流程。</p>\n<p>提交数: 6356, 贡献者: 40, Github 链接: <a href=\"https://github.com/biolab/orange3\">Orange3</a></p>\n<p><strong>14. </strong><a href=\"https://pymc-devs.github.io/pymc/README.html\"><strong>Pymc</strong></a> 是一个Python 模块，它能实现贝叶斯统计模型和拟合算法，包括马尔科夫链蒙特卡罗（Markov chain Monte Carlo）算法。它非常灵活，具有可扩展性，适用于处理一系列大规模问题。</p>\n<p>提交数: 2701, 贡献者: 37, Github 链接: <a href=\"https://github.com/pymc-devs/pymc\">Pymc</a></p>\n<p><strong>15. </strong><a href=\"http://pybrain.org/\"><strong>PyBrain</strong></a> 是一个模块化的 Python 机器学习库。它致力于为机器学习任务提供灵活易上手但功能强大的算法，和一系列用于测试和比较算法的预定义环境。</p>\n<p>提交数: 984, 贡献者: 31, Github 链接: <a href=\"http://github.com/pybrain/pybrain\">PyBrain</a></p>\n<p><strong>16. </strong><a href=\"https://fuel.readthedocs.io/\"><strong>Fuel</strong></a> 是一个数据管道框架（data pipeline framework），它为机器学习模型提供所需的数据。<a href=\"https://github.com/mila-udem/blocks\">Blocks</a> 和 <a href=\"https://github.com/lisa-lab/pylearn2\">Pylearn2</a> 这两个神经网络库都有计划使用 Fuel。</p>\n<p>提交数: 1053, 贡献者: 29, Github 链接: <a href=\"http://github.com/mila-udem/fuel\">Fuel</a></p>\n<p><strong>17.</strong><a href=\"http://www.pymvpa.org/\"><strong>PyMVPA</strong></a> 是一个 Python 包，旨在简化大型数据集的统计学习分析。它提供了一个可扩展的框架和一个用于分类，回归，特征选择，数据导入导出等算法的高级接口。</p>\n<p>提交数: 9258, 贡献者: 26, Github 链接: <a href=\"https://github.com/PyMVPA/PyMVPA\">PyMVPA</a></p>\n<p><strong>18. </strong><a href=\"https://pypi.python.org/pypi/annoy\"><strong>Annoy</strong></a> (<a href=\"http://en.wikipedia.org/wiki/Nearest_neighbor_search#Approximate_nearest_neighbor\">Approximate Nearest Neighbors</a> Oh Yeah) 是一个带有 Python 绑定的 C++ 库，用于在空间中找到和已知的查询点临近的点。它还可以创建大型的基于文件的只读数据结构，并映射至内存，以便多个进程能共同使用相同的数据。</p>\n<p>提交数: 365, Contributors: 24, Github 链接: <a href=\"https://github.com/spotify/annoy\">Annoy</a></p>\n<p><strong>19. </strong><strong><a href=\"https://pypi.python.org/pypi/deap\">Deap</a> </strong>是一个创新的，仍在发展中的计算框架，用于快速构建原型和测试方法。它旨在使算法和数据结构更加清晰透明。它与并行机制（如多进程和 <a href=\"http://scoop.googlecode.com/\">SCOOP</a> 模块）完美协调。</p>\n<p>提交数: 1854, 贡献者: 21, Github 链接: <a href=\"https://github.com/deap/deap\">Deap</a></p>\n<p><strong>20. </strong><strong><a href=\"https://pypi.python.org/pypi/Pattern\">Pattern</a> </strong>是一个 Python 的网络挖掘模块。它绑定了数据挖掘(Google + Twitter + Wikipedia API, 网络爬虫, HTML DOM 解析器)，自然语言处理 (词性标记, n-gram 搜索, 语义分析, WordNet)，机器学习(向量空间模型, k-means 聚类, Naive Bayes + k-NN + SVM 分类器) 和网络分析(图核心性 graph centrality 和可视化)等工具。</p>\n<p>提交数: : 943, Contributors: 20 , Github 链接: <a href=\"http://github.com/clips/pattern\">Pattern</a></p>\n<p>在下面的图表中，可以看到 PyMVPA 相较于其他项目拥有最高的贡献率（contribution rate）。令人吃惊的是，Scikit-learn 虽然拥有最多的贡献者，但是贡献率却很低。这种现象背后的原因可能是：PyMVPA 是新项目，正处于开发的早期阶段，新功能开发，漏洞修补和重构等都能够引导更多的提交。而 Scikit-learn 属于比较旧且非常稳定的项目，改进和修复的空间更小。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611gy1fe0j01d223j217k0r8tb8.jpg\" width=\"1568\" height=\"980\"></p>\n<p>在比较同时上榜 2015 和 2016 Top 20 的项目时，可以发现，Pattern，PyBrain 和 Pylearn2 没有新的贡献者（contributors）也没有新的贡献代码。同时，还可以发现贡献者数和提交数之间有显著关联。贡献者数的增长可能会导致提交数的增长，我认为这是开源项目和社区的魔力——引领头脑风暴，激发更多创意，开发更好的软件工具。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611gy1fe0j01ytfcj217k0wgdhe.jpg\" width=\"1568\" height=\"1168\"></p>\n<p>以上是对 2016 Python 机器学习开源项目所做的分析，该分析基于项目贡献者和提交数，作者是 KDnuggets 团队的 Prasad 和 Gregory。</p>\n<p>开源万岁！分享万岁！</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87535\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87535votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87535\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 20</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://wx2.sinaimg.cn/large/63918611gy1fe0izuhdicj217k0wgdiw.jpg"], "title": "机器学习 Python 库 Top 20", "fav_nums": 7}
{"praise_nums": 2, "front_image_path": "full/d21a83f6d43617f04d77157889bd773c35ec673d.jpg", "tags": "", "comment_nums": 0, "url_object_id": "885a2b3477ed75ded49320359a277539", "url": "http://python.jobbole.com/87514/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://cyrusin.github.io/2015/09/15/python-singleton-20150915/\">Li Shuai（@Tinker达文希 ）</a>   </div><div>\n<p>有些时候你的项目中难免需要一些全局唯一的对象,这些对象大多是一些工具性的东西,在Python中实现单例模式并不是什么难事。以下总结几种方法:</p>\n<h3>使用类装饰器</h3>\n<p>使用装饰器实现单例类的时候,类本身并不知道自己是单例的,所以写代码的人可以不care这个,只要正常写自己的类的实现就可以,类的单例有装饰器保证。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2cc76e7954016432687\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef singleton(cls):\r\n    instances = {}\r\n    def _wrapper(*args, **kwargs):\r\n        if cls not in instances:\r\n            instances[cls] = cls(*args, **kwargs)\r\n        return instances[cls]\r\n    return _wrapper\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7954016432687-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7954016432687-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7954016432687-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7954016432687-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7954016432687-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7954016432687-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7954016432687-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7954016432687-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2cc76e7954016432687-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">singleton</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7954016432687-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">instances</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7954016432687-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7954016432687-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cls </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">instances</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7954016432687-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">instances</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cls</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7954016432687-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">instances</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7954016432687-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_wrapper</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7954016432687-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>你会发现<code>singleton</code>装饰器内部使用了一个<code>dict</code>。当然你也可以用其他的方式,不过以下的实现是<strong>错误</strong>的:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2cc76e7961684598064\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef singleton(cls):\r\n    _instance = None #外部作用域的引用对于嵌套的内部作用域是只读的\r\n    def _wrapper(*args, **kwargs):\r\n        if _instance is None: #解释器会抛出\"UnboundLocalError: ...referenced before assignment\"\r\n            _instance = cls(*args, **kwargs) #赋值行为使解释器将\"_instance\"看作局部变量\r\n        return _instance\r\n    return _wrapper \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7961684598064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7961684598064-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7961684598064-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7961684598064-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7961684598064-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7961684598064-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7961684598064-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7961684598064-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2cc76e7961684598064-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">singleton</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7961684598064-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#外部作用域的引用对于嵌套的内部作用域是只读的</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7961684598064-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7961684598064-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_instance </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#解释器会抛出\"UnboundLocalError: ...referenced before assignment\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7961684598064-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cls</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#赋值行为使解释器将\"_instance\"看作局部变量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7961684598064-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_instance</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7961684598064-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_wrapper</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7961684598064-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h3>使用元类(<code>__metaclass__</code>)和可调用对象(<code>__call__</code>)</h3>\n<p>Python的对象系统中一些皆对象,类也不例外,可以称之为”类型对象”,比较绕,但仔细思考也不难:类本身也是一种对象,只不过这种对象很特殊,它表示某一种类型。是对象,那必然是实例化来的,那么谁实例化后是这种类型对象呢?也就是元类。</p>\n<p>Python中,<code>class</code>关键字表示定义一个类对象,此时解释器会按一定规则寻找<code>__metaclass__</code>,如果找到了,就调用对应的元类实现来实例化该类对象;没找到,就会调用<code>type</code>元类来实例化该类对象。</p>\n<p><code>__call__</code>是Python的魔术方法,Python的面向对象是”Duck type”的,意味着对象的行为可以通过实现协议来实现,可以看作是一种特殊的接口形式。某个类实现了<code>__call__</code>方法意味着该类的对象是可调用的,可以想像函数调用的样子。再考虑一下<code>foo=Foo()</code>这种实例化的形式,是不是很像啊。结合元类的概念,可以看出,<code>Foo</code>类是单例的,则在调用<code>Foo()</code>的时候每次都返回了同样的对象。而<code>Foo</code>作为一个类对象是单例的,意味着它的类(即生成它的元类)是实现了<code>__call__</code>方法的。所以可以如下实现:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2cc76e7967426663378\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Singleton(type):\r\n    def __init__(cls, name, bases, attrs):\r\n        super(Singleton, cls).__init__(name, bases, attrs)\r\n        cls._instance = None\r\n    def __call__(cls, *args, **kwargs):\r\n        if cls._instance is None\r\n            # 以下不要使用'cls._instance = cls(*args, **kwargs)', 防止死循环,\r\n            # cls的调用行为已经被当前'__call__'协议拦截了\r\n            # 使用super(Singleton, cls).__call__来生成cls的实例\r\n            cls._instance = super(Singleton, cls).__call__(*args, **kwargs)\r\n        return cls._instance\r\n\r\nclass Foo(object): #单例类\r\n    __metaclass__ = Singleton\r\n\r\n&gt;&gt;&gt;a = Foo()\r\n&gt;&gt;&gt;b = Foo()\r\n&gt;&gt;&gt;a is b\r\n&gt;&gt;&gt;True\r\n&gt;&gt;&gt;a.x = 1\r\n&gt;&gt;&gt;b.x\r\n&gt;&gt;&gt;1\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e7967426663378-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e7967426663378-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Singleton</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bases</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Singleton</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bases</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_instance </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># 以下不要使用'cls._instance = cls(*args, **kwargs)', 防止死循环,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># cls的调用行为已经被当前'__call__'协议拦截了</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># 使用super(Singleton, cls).__call__来生成cls的实例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Singleton</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_instance</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-12\"> </div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-13\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#单例类</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">__metaclass__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Singleton</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-16\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-17\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-18\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-19\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-20\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-21\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e7967426663378-22\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e7967426663378-23\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p>\n<h3>使用<code>__new__</code></h3>\n<p><code>__init__</code>不是Python对象的构造方法,<code>__init__</code>只负责初始化实例对象,在调用<code>__init__</code>方法之前,会首先调用<code>__new__</code>方法生成对象,可以认为<code>__new__</code>方法充当了构造方法的角色。所以可以在<code>__new__</code>中加以控制,使得某个类只生成唯一对象。具体实现时可以实现一个父类,重载<code>__new__</code>方法,单例类只需要继承这个父类就好。<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t</p><div id=\"crayon-58e2cc76e796b317177914\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Singleton(object):\r\n    def __new__(cls, *args, **kwargs):\r\n        if not hasattr(cls, '_instance'):\r\n            cls._instance = super(Singleton, cls).__new__(cls, *args, **kwargs)\r\n        return cls._instance\r\n\r\nclass Foo(Singleton): #单例类\r\n    a = 1\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e796b317177914-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e796b317177914-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e796b317177914-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e796b317177914-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e796b317177914-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e796b317177914-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e796b317177914-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2cc76e796b317177914-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2cc76e796b317177914-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2cc76e796b317177914-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Singleton</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e796b317177914-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__new__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e796b317177914-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hasattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'_instance'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e796b317177914-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Singleton</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__new__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e796b317177914-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_instance</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e796b317177914-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2cc76e796b317177914-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Singleton</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#单例类</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2cc76e796b317177914-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2cc76e796b317177914-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87514\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87514votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87514\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/591d8b55a524f825dd29a22b8df70000.jpg"], "title": "在Python中实现单例模式", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/a6d031713da6a85b0c6d6390db2c13c7de0b75fd.jpg", "tags": "", "comment_nums": 0, "url_object_id": "5d33b2cd212eddd57ad75905c32c088a", "url": "http://python.jobbole.com/87519/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/starof/p/4703820.html\">starof</a>   </div><p><span id=\"pos_placeholder\" style=\"width: 0px;height: 0px;margin: 0px;padding: 0px\"></span>python 中curses封装了c语言的curses，把c中复杂部分简单化，比如addstr(),mvaddstr(),mvwaddstr()合并成了一个addstr()方法。</p>\n<h1>一、语法入门</h1>\n<h2>1、打开和关闭一个curses 应用程序</h2>\n<p>在任何代码执行前都先要初始化curses。初始化操作就是调用initscr()函数，如下。该函数根据不同设备返回一个window对象代表整个屏幕，这个window对象通常叫做stdscr，和c语言报错一致。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3d0713027875\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport curses\r\nstdscr = curses.initscr()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3d0713027875-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3d0713027875-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3d0713027875-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">curses</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3d0713027875-2\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initscr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<p>使用curses通常要关闭屏幕回显，目的是读取字符仅在适当的环境下输出。这就需要调用noecho()方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3db965826940\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurses.noecho()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3db965826940-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3db965826940-1\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">noecho</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p>应用程序一般是立即响应的，即不需要按回车就立即回应的，这种模式叫cbreak模式，相反的常用的模式是缓冲输入模式。开启立即cbreak模式代码如下。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3df816370883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurses.cbreak()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3df816370883-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3df816370883-1\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cbreak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p>终端经常返回特殊键作为一个多字节的转义序列，比如光标键，或者导航键比如Page UP和Home键 。curses可以针对这些序列做一次处理，比如curses.KEY_LEFT返回一个特殊的值。要完成这些工作，必须开启键盘模式。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3e3832118426\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstdscr.keypad(1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3e3832118426-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3e3832118426-1\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">keypad</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p>关闭curses非常简单，如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3e6480906711\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurses.nocbreak()#关闭字符终端功能（只有回车时才发生终端）\r\nstdscr.keypad(0)\r\ncurses.echo() #打开输入回显功能</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3e6480906711-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3e6480906711-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3e6480906711-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3e6480906711-1\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nocbreak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-p\">#关闭字符终端功能（只有回车时才发生终端）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3e6480906711-2\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">keypad</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3e6480906711-3\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">echo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#打开输入回显功能</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>调用endwin()恢复默认设置</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3e9010157255\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurses.endwin()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3e9010157255-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3e9010157255-1\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endwin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p>调试curses时常见的问题就是curses应用程序结束后没有重置终端到之前的状态，把终端弄的一团糟。python中该问题经常是因为代码有bug，发送异常引起的。比如键盘敲入字符后屏幕不回显，这让shell用起来非常困难。</p>\n<p>为了避免这样的问题，可以导入curses.wrapper模块。这个函数做了一些初始化的工作，包括上面提到的和颜色的初始化。然后再执行你提供的函数，最后重置。而且被调用的函数写在try-catch中。</p>\n<h2>2、打开新窗口和pad</h2>\n<p>通常调用initscr()获取一个window对象代表全部屏幕。但是很多程序希望划分屏幕为几个小的窗口，为了重绘，擦出这些工作在小窗口中独立进行。newwin()函数就是用来新建一个新的窗口，需要给定窗口尺寸，并返回新的window对象的。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3ed946008930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbegin_x = 20; begin_y = 7\r\nheight = 5; width = 40\r\nwin = curses.newwin(height, width, begin_y, begin_x)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3ed946008930-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3ed946008930-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3ed946008930-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3ed946008930-1\"><span class=\"crayon-v\">begin_x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">begin_y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3ed946008930-2\"><span class=\"crayon-v\">height</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3ed946008930-3\"><span class=\"crayon-v\">win</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newwin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">begin_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">begin_x</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p><strong>注意：坐标通过是先y后x</strong>。这和别的坐标系统不同，但是根深蒂固，写的时候就这样现在改太晚喽。</p>\n<p>当调用一个方法去显示或者擦除文本时，效果不会立即显示。 为了减少屏幕重绘的时间，curses就先累积这些操作，用一种更有效的方式去显示。就比如说你的程序先在窗口显示了几个字符，然后就清除屏幕，那就没必要发送初始字符了，因为它们不会被显示。</p>\n<p>因此，curses需要你使用refresh()函数明确指出重绘窗口。</p>\n<h3>pad</h3>\n<p>pad是window的特例。pad可以比显示的屏幕大，一次只显示pad的一部分。创建一个pad很简单，只需要提供宽高即可。但是刷新pad需要提供屏幕上显示的部分pad的坐标。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3f1390025523\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npad = curses.newpad(100, 100)\r\n#  These loops fill the pad with letters; this is\r\n# explained in the next section\r\nfor y in range(0, 100):\r\n    for x in range(0, 100):\r\n        try:\r\n            pad.addch(y,x, ord('a') + (x*x+y*y) % 26)\r\n        except curses.error:\r\n            pass\r\n\r\n#  Displays a section of the pad in the middle of the screen\r\npad.refresh(0,0, 5,5, 20,75)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f1390025523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f1390025523-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f1390025523-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f1390025523-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f1390025523-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f1390025523-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f1390025523-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f1390025523-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f1390025523-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f1390025523-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f1390025523-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f1390025523-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f1390025523-1\"><span class=\"crayon-v\">pad</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newpad</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f1390025523-2\"><span class=\"crayon-p\">#  These loops fill the pad with letters; this is</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f1390025523-3\"><span class=\"crayon-p\"># explained in the next section</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f1390025523-4\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f1390025523-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f1390025523-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f1390025523-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pad</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ord</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">x*</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">+</span><span class=\"crayon-e \">y*</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f1390025523-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f1390025523-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f1390025523-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f1390025523-11\"><span class=\"crayon-p\">#  Displays a section of the pad in the middle of the screen</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f1390025523-12\"><span class=\"crayon-v\">pad</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">refresh</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">75</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<p>同时由多个window或者多个pad，有一问题：刷新某个window或pad时屏幕会闪烁。</p>\n<p>避免闪烁的方法：在每个window调用noutrefresh()方法。 然后使用refresh()方法的最后再调用doupdate()方法。</p>\n<h2>3、显示文本</h2>\n<p>addscr不同格式如下：如果没有坐标，字符显示在上一次操作完的位置。</p>\n<table>\n<thead valign=\"bottom\">\n<tr>\n<th>Form</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody valign=\"top\">\n<tr>\n<td><em>str</em> or <em>ch</em></td>\n<td>Display the string <em>str</em> or character <em>ch</em> at the current position</td>\n</tr>\n<tr>\n<td><em>str</em> or <em>ch</em>, <em>attr</em></td>\n<td>Display the string <em>str</em> or character <em>ch</em>, using attribute <em>attr</em> at the current position</td>\n</tr>\n<tr>\n<td><em>y</em>, <em>x</em>, <em>str</em> or <em>ch</em></td>\n<td>Move to position <em>y,x</em> within the window, and display <em>str</em> or <em>ch</em></td>\n</tr>\n<tr>\n<td><em>y</em>, <em>x</em>, <em>str</em> or <em>ch</em>, <em>attr</em></td>\n<td>Move to position <em>y,x</em> within the window, and display <em>str</em> or <em>ch</em>, using attribute <em>attr</em></td>\n</tr>\n</tbody>\n</table>\n<p>属性可以让文本高亮显示，比如黑体，下划线，倒序，彩色显示。</p>\n<h2>4、属性和颜色</h2>\n<p>属性和描述：</p>\n<table>\n<thead valign=\"bottom\">\n<tr>\n<th>Attribute</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody valign=\"top\">\n<tr>\n<td><tt>A_BLINK</tt></td>\n<td>Blinking text</td>\n</tr>\n<tr>\n<td><tt>A_BOLD</tt></td>\n<td>Extra bright or bold text</td>\n</tr>\n<tr>\n<td><tt>A_DIM</tt></td>\n<td>Half bright text</td>\n</tr>\n<tr>\n<td><tt>A_REVERSE</tt></td>\n<td>Reverse-video text</td>\n</tr>\n<tr>\n<td><tt>A_STANDOUT</tt></td>\n<td>The best highlighting mode available</td>\n</tr>\n<tr>\n<td><tt>A_UNDERLINE</tt></td>\n<td>Underlined text</td>\n</tr>\n</tbody>\n</table>\n<p>屏幕第一行reverse-video显示。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3f5815298515\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstdscr.addstr(0, 0, \"Current mode: Typing mode\",\r\n              curses.A_REVERSE)\r\nstdscr.refresh()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f5815298515-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f5815298515-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f5815298515-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f5815298515-1\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addstr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Current mode: Typing mode\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f5815298515-2\"><span class=\"crayon-h\">              </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">A_REVERSE</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f5815298515-3\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">refresh</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>curses使用前景色和背景色，可通过color_pair()方法获取一对颜色。</p>\n<p>使用颜色对1显示一行</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3f8487945054\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstdscr.addstr(\"Pretty text\", curses.color_pair(1))\r\nstdscr.refresh()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3f8487945054-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb3f8487945054-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3f8487945054-1\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addstr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Pretty text\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">color_pair</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb3f8487945054-2\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">refresh</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>start_color()初始化了8中基本颜色：0:black, 1:red, 2:green, 3:yellow, 4:blue, 5:magenta, 6:cyan, and 7:white。</p>\n<p>init_pair(n,f,b)修改颜色对n，让f为前景色，b为背景色。颜色对0天生的黑白色，不允许改。</p>\n<p>比如：修改color1为红色文本，白色背景：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3fc868090431\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurses.init_pair(1, curses.COLOR_RED, curses.COLOR_WHITE)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3fc868090431-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3fc868090431-1\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init_pair</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_RED</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_WHITE</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>使用：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb3ff158392333\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstdscr.addstr(0,0, \"RED ALERT!\", curses.color_pair(1))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb3ff158392333-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb3ff158392333-1\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addstr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"RED ALERT!\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">color_pair</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<h2>5、用户输入</h2>\n<p>获取输入一遍使用getch()方法，这个方法暂停等待用户输入，显示用echo()方法。</p>\n<p>getch()返回一个整数 ，在0到255之间，表示输入字符的ASCII值。打印255的是些特殊字符，比如Page Up,Home。</p>\n<p>代码经常这样写</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb402608954649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhile 1:\r\n    c = stdscr.getch()\r\n    if c == ord('p'):\r\n        PrintDocument()\r\n    elif c == ord('q'):\r\n        break  # Exit the while()\r\n    elif c == curses.KEY_HOME:\r\n        x = y = 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb402608954649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb402608954649-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb402608954649-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb402608954649-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb402608954649-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb402608954649-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb402608954649-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb402608954649-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb402608954649-1\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb402608954649-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb402608954649-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ord</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb402608954649-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">PrintDocument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb402608954649-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ord</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'q'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb402608954649-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Exit the while()</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb402608954649-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">KEY_HOME</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb402608954649-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>getstr()获取一个字符串。因为功能有限不常用。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb405414920680\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurses.echo()            # Enable echoing of characters\r\n# Get a 15-character string, with the cursor on the top line\r\ns = stdscr.getstr(0,0, 15)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb405414920680-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb405414920680-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb405414920680-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb405414920680-1\"><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">echo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># Enable echoing of characters</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb405414920680-2\"><span class=\"crayon-p\"># Get a 15-character string, with the cursor on the top line</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb405414920680-3\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getstr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<h1>二、例子</h1>\n<p>代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb408552104379\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#-*- coding: UTF-8 -*-\r\nimport curses\r\n\r\nstdscr = curses.initscr()\r\n\r\ndef display_info(str, x, y, colorpair=2):\r\n    '''''使用指定的colorpair显示文字'''  \r\n    global stdscr\r\n    stdscr.addstr(y, x,str, curses.color_pair(colorpair))\r\n    stdscr.refresh()\r\n\r\ndef get_ch_and_continue():\r\n    '''''演示press any key to continue'''\r\n    global stdscr\r\n    #设置nodelay，为0时会变成阻塞式等待\r\n    stdscr.nodelay(0)\r\n    #输入一个字符\r\n    ch=stdscr.getch()\r\n    #重置nodelay,使得控制台可以以非阻塞的方式接受控制台输入，超时1秒\r\n    stdscr.nodelay(1)\r\n    return True\r\n\r\ndef set_win():\r\n    '''''控制台设置'''\r\n    global stdscr\r\n    #使用颜色首先需要调用这个方法\r\n    curses.start_color()\r\n    #文字和背景色设置，设置了两个color pair，分别为1和2\r\n    curses.init_pair(1, curses.COLOR_GREEN, curses.COLOR_BLACK)\r\n    curses.init_pair(2, curses.COLOR_RED, curses.COLOR_BLACK)\r\n    #关闭屏幕回显\r\n    curses.noecho()\r\n    #输入时不需要回车确认\r\n    curses.cbreak()\r\n    #设置nodelay，使得控制台可以以非阻塞的方式接受控制台输入，超时1秒\r\n    stdscr.nodelay(1)\r\n\r\ndef unset_win():\r\n    '''控制台重置'''\r\n    global stdstr\r\n    #恢复控制台默认设置（若不恢复，会导致即使程序结束退出了，控制台仍然是没有回显的）\r\n    curses.nocbreak()\r\n    stdscr.keypad(0)\r\n    curses.echo()\r\n    #结束窗口\r\n    curses.endwin()\r\nif __name__=='__main__':\r\n    try:\r\n        set_win()\r\n        display_info('Hola, curses!',0,5)\r\n        display_info('Press any key to continue...',0,10)\r\n        get_ch_and_continue()\r\n    except Exception,e:\r\n        raise e\r\n    finally:\r\n        unset_win()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb408552104379-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb408552104379-56\">56</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-1\"><span class=\"crayon-p\">#-*- coding: UTF-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">curses</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-4\"><span class=\"crayon-v\">stdscr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initscr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">display_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colorpair</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">'使用指定的colorpair显示文字'</span><span class=\"crayon-s\">''</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stdscr</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addstr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">color_pair</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colorpair</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">refresh</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-12\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_ch_and_continue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">'演示press any key to continue'</span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stdscr</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#设置nodelay，为0时会变成阻塞式等待</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nodelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#输入一个字符</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#重置nodelay,使得控制台可以以非阻塞的方式接受控制台输入，超时1秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nodelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-22\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-23\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">set_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">'控制台设置'</span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stdscr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#使用颜色首先需要调用这个方法</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_color</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#文字和背景色设置，设置了两个color pair，分别为1和2</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init_pair</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_GREEN</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_BLACK</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init_pair</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_RED</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_BLACK</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#关闭屏幕回显</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">noecho</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#输入时不需要回车确认</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cbreak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#设置nodelay，使得控制台可以以非阻塞的方式接受控制台输入，超时1秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nodelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-38\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">unset_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">'控制台重置'</span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stdstr</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#恢复控制台默认设置（若不恢复，会导致即使程序结束退出了，控制台仍然是没有回显的）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nocbreak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">keypad</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">echo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#结束窗口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endwin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-47\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">set_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">display_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hola, curses!'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">display_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Press any key to continue...'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">get_ch_and_continue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">Exception</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb408552104379-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb408552104379-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unset_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n\n</div>\n<p>执行：# python testcurses.py</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/1ddf219688e6264bdfbd6d87c0224cf2.png\" alt=\"\"></p>\n<h1>三、排错</h1>\n<p>报错：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be63cb40d347824768\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@yl-web-test srv]# python curses.py\r\nTraceback (most recent call last):\r\n  File \"curses.py\", line 2, in &lt;module&gt;\r\n    import curses\r\n  File \"/srv/curses.py\", line 4, in &lt;module&gt;\r\n    stdscr = curses.initscr()\r\nAttributeError: 'module' object has no attribute 'initscr'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb40d347824768-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb40d347824768-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb40d347824768-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb40d347824768-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb40d347824768-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be63cb40d347824768-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be63cb40d347824768-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be63cb40d347824768-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">yl</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">web</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">test </span><span class=\"crayon-v\">srv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># python curses.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb40d347824768-2\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb40d347824768-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"curses.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb40d347824768-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">curses</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb40d347824768-5\"><span class=\"crayon-e\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/srv/curses.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be63cb40d347824768-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdscr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initscr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be63cb40d347824768-7\"><span class=\"crayon-v\">AttributeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'module'</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">no </span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'initscr'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<p>原因：因为我的文件取名是curses.py，而系统也是用的curses.py，python执行时先从当前目录查找，所以不能和系统文件重名。</p>\n<p>换个名字，比如改名为testcurses.py 就好了。</p>\n<p>参考：</p>\n<p><a href=\"https://docs.python.org/2/howto/curses.html\" target=\"_blank\">https://docs.python.org/2/howto/curses.html</a></p>\n<p>请使用手机”扫一扫”x</p>\n<p>请使用手机”扫一扫”x</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87519\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87519votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87519\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "title": "python curses使用", "fav_nums": 1}
{"praise_nums": 1, "front_image_path": "full/839cd877a62b6c6b2588d023abf04a611ffde478.jpg", "tags": "", "comment_nums": 0, "url_object_id": "e356a2aa7b8f1bf9fe6b3e52a52e0325", "url": "http://python.jobbole.com/87522/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/169403f7e40c#\">鱼心fishstar</a>   </div><div>\n<p>打算学习 Python 来做数据分析的你，是不是在开始时就遇到各种麻烦呢？</p>\n<blockquote>\n<ul>\n<li>到底该装 Python2 呢还是 Python3 ？</li>\n<li>为什么安装 Python 时总是出错？</li>\n<li>怎么安装工具包呢？</li>\n<li>为什么提示说在安装这个工具前必须先安装一堆其他不明所以的工具？</li>\n</ul>\n</blockquote>\n<p>相信大多数 Python 的初学者们都曾为环境问题而头疼不已，但你并不孤独，大家都是这么折腾过来的。为了在入门时少走弯路，并且让高涨的积极性不至于太受打击，这里推荐使用 Anaconda 来管理你的安装环境和各种工具包。</p>\n<p>本文介绍了Anaconda的使用，全文大纲如下：</p>\n<blockquote>\n<ul>\n<li>为什么选择 Anaconda\n<ul>\n<li>什么是 Anaconda</li>\n<li>什么是 conda</li>\n<li>Anaconda 的优点</li>\n</ul>\n</li>\n<li>如何安装 Anaconda</li>\n<li>如何管理 Python 包</li>\n<li>如何管理 Python 环境</li>\n</ul>\n</blockquote>\n<hr>\n<h2>一、为什么选择Anaconda？</h2>\n<h3>1.1 什么是 Anaconda？</h3>\n<p>Anaconda是专注于数据分析的Python发行版本，包含了conda、Python等190多个科学包及其依赖项。作为好奇宝宝的你是不是发现了一个新名词 <em>conda</em>，那么你一定会问 conda 又是什么呢？</p>\n<h3>1.2 什么是 conda ？</h3>\n<p>conda 是开源包（packages）和虚拟环境（environment）的管理系统。</p>\n<ul>\n<li><strong>packages 管理：</strong> 可以使用 conda 来安装、更新 、卸载工具包 ，并且它更关注于数据科学相关的工具包。在安装 anaconda 时就预先集成了像 Numpy、Scipy、 pandas、Scikit-learn 这些在数据分析中常用的包。另外值得一提的是，conda 并不仅仅管理Python的工具包，它也能安装非python的包。比如在新版的 Anaconda 中就可以安装R语言的集成开发环境 Rstudio。</li>\n<li><strong>虚拟环境管理：</strong> 在conda中可以建立多个虚拟环境，用于隔离不同项目所需的不同版本的工具包，以防止版本上的冲突。对纠结于 Python 版本的同学们，我们也可以建立 Python2 和 Python3 两个环境，来分别运行不同版本的 Python 代码。</li>\n</ul>\n<p>知道 <strong>是什么（what）</strong> 的同时，我们也需要问一问 <strong>为什么（why）</strong>。那么，为什么要选择用Anaconda呢？</p>\n<h3>1.3 Anaconda 的优点？</h3>\n<p>Anaconda的优点总结起来就八个字：省时省心、分析利器。</p>\n<ul>\n<li><strong>省时省心：</strong> Anaconda通过管理工具包、开发环境、Python版本，大大简化了你的工作流程。不仅可以方便地安装、更新、卸载工具包，而且安装时能自动安装相应的依赖包，同时还能使用不同的虚拟环境隔离不同要求的项目。</li>\n<li><strong>分析利器：</strong> 在 <a href=\"https://www.continuum.io/why-anaconda\" target=\"_blank\">Anaconda</a> 官网中是这么宣传自己的：适用于企业级大数据分析的Python工具。其包含了720多个数据科学相关的开源包，在数据可视化、机器学习、深度学习等多方面都有涉及。不仅可以做数据分析，甚至可以用在大数据和人工智能领域。</li>\n</ul>\n<p>解决了 <strong>是什么</strong> 以及 <strong>为什么</strong> 的问题后，下面让我们看一下 <strong>怎么做（How）</strong>。</p>\n<hr>\n<h2>二、如何安装Anaconda？</h2>\n<p>可以从<a href=\"https://www.continuum.io/downloads\" target=\"_blank\">这里</a>下载 Anaconda 的安装程序以及查看安装说明。无论是 Windows、Linux 还是 MAC 的 OSX 系统，都可以找到对应的安装软件。如果你的电脑是64位则尽量选64位版本。至于 Python 的版本是 2.7 还是 3.x，这里推荐你使用 Python3，因为 Python2 终将<a href=\"https://pythonclock.org/\" target=\"_blank\">停止维护</a>。可能目前市面上大多数教程使用的都还是 Python2，这也不用着急，因为在 Anaconda 中可以同时管理两个 Python 版本的环境。</p>\n<p>根据提示进行安装，完成后你大概会惊讶地发现电脑中多了好多应用，不用担心，我们一项项来看：</p>\n<blockquote>\n<ul>\n<li><strong>Anaconda Navigtor</strong> ：用于管理工具包和环境的图形用户界面，后续涉及的众多管理命令也可以在 Navigator 中手工实现。</li>\n<li><strong>Jupyter notebook</strong> ：基于web的交互式计算环境，可以编辑易于人们阅读的文档，用于展示数据分析的过程。</li>\n<li><strong>qtconsole</strong> ：一个可执行 IPython 的仿终端图形界面程序，相比 Python Shell 界面，qtconsole 可以直接显示代码生成的图形，实现多行代码输入执行，以及内置许多有用的功能和函数。</li>\n<li><strong>spyder</strong> ：一个使用Python语言、跨平台的、科学运算集成开发环境。</li>\n</ul>\n</blockquote>\n<p>安装完成后，我们还需要对所有工具包进行升级，以避免可能发生的错误。打开你电脑的终端，在命令行中输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860292c577100321\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda upgrade --all</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860292c577100321-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860292c577100321-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-v\">upgrade</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">all</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在终端询问是否安装如下升级版本时，输入 <code>y</code>。</p>\n<p>有的情况下，你可能会遇到找不到 conda 命令的错误提示，这很可能是环境路径设置的问题，需要添加conda环境变量：<code>export PATH=xxx/anaconda/bin:$PATH</code>, 其中xxx替换成anaconda的安装路径。</p>\n<p>至此，安装完成，下面让我们看一下如何用 Anaconda 管理工具包和环境。</p>\n<hr>\n<h2>三、如何管理Python包？</h2>\n<p>安装一个 package：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602937335878610\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda install package_name</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602937335878610-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602937335878610-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">package_name</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这里 package_name 是需要安装包的名称。你也可以同时安装多个包，比如同时安装numpy 、scipy 和 pandas，则执行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860293b400540382\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda install numpy scipy pandas</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860293b400540382-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860293b400540382-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-e\">scipy </span><span class=\"crayon-v\">pandas</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>你也可以指定安装的版本，比如安装 1.1 版本的 numpy ：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860293f246854374\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda install numpy=1.10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860293f246854374-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860293f246854374-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">numpy</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1.10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>移除一个 package：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602942538055614\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda remove package_name</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602942538055614-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602942538055614-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">remove </span><span class=\"crayon-v\">package_name</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>升级 package 版本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602945270582348\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda update package_name</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602945270582348-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602945270582348-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">update </span><span class=\"crayon-v\">package_name</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>查看所有的 packages：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602948703618143\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda list</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602948703618143-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602948703618143-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-v\">list</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果你记不清 package 的具体名称，也可以进行模糊查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860294b789852700\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda  search search_term</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860294b789852700-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860294b789852700-1\"><span class=\"crayon-e\">conda  </span><span class=\"crayon-e\">search </span><span class=\"crayon-v\">search_term</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<hr>\n<h2>四、如何管理Python环境？</h2>\n<p>默认的环境是 root，你也可以创建一个新环境：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860294e496956453\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda create -n env_name  list of packages</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860294e496956453-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860294e496956453-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-v\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">env_name  </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">packages</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>其中 <code>-n</code> 代表 name，<code>env_name</code> 是需要创建的环境名称，<code>list of packages</code> 则是列出在新环境中需要安装的工具包。</p>\n<p>例如，当我安装了 Python3 版本的 Anaconda 后，默认的 root 环境自然是 Python3，但是我还需要创建一个 Python 2 的环境来运行旧版本的 Python 代码，最好还安装了 pandas 包，于是我们运行以下命令来创建：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602951341931307\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda create -n py2 python=2.7 pandas</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602951341931307-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602951341931307-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-v\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">py2 </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2.7</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pandas</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>细心的你一定会发现，py2 环境中不仅安装了 pandas，还安装了 numpy 等一系列 packages，这就是使用 conda 的方便之处，它会自动为你安装相应的依赖包，而不需要你一个个手动安装。</p>\n<p>进入名为 env_name 的环境：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602956551807641\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsource activate env_name</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602956551807641-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602956551807641-1\"><span class=\"crayon-e\">source </span><span class=\"crayon-e\">activate </span><span class=\"crayon-v\">env_name</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>退出当前环境：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860295a230835353\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsource deactivate</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860295a230835353-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860295a230835353-1\"><span class=\"crayon-e\">source </span><span class=\"crayon-v\">deactivate</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>另外注意，在 Windows 系统中，使用 <code>activate env_name</code> 和 <code>deactivate</code> 来进入和退出某个环境。</p>\n<p>删除名为 env_name 的环境：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e4860295d387773214\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda env remove -n env_name</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e4860295d387773214-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e4860295d387773214-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">env </span><span class=\"crayon-v\">remove</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">env_name</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>显示所有的环境：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602960085257761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda env list</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602960085257761-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602960085257761-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">env </span><span class=\"crayon-v\">list</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>当分享代码的时候，同时也需要将运行环境分享给大家，执行如下命令可以将当前环境下的 package 信息存入名为 environment 的 YAML 文件中。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602963717043128\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda env export &gt; environment.yaml</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602963717043128-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602963717043128-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">env </span><span class=\"crayon-v\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">yaml</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>同样，当执行他人的代码时，也需要配置相应的环境。这时你可以用对方分享的 YAML 文件来创建一摸一样的运行环境。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2e48602966304725548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda env create -f environment.yaml</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2e48602966304725548-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2e48602966304725548-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">env </span><span class=\"crayon-v\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">yaml</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>至此，你已跨入 Anaconda 的大门，后续就可以徜徉在 Python 的海洋中了。</p>\n<p>祝学习愉快！</p>\n<hr>\n<p><em>注：本文代码示例参考自Udacity数据分析课程之Anaconda章节。</em></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87522\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87522votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87522\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 11 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/e9df80726bb79e9fc74d6707dda9f585.jpg"], "title": "致Python初学者们 - Anaconda入门使用指南", "fav_nums": 11}
{"praise_nums": 1, "front_image_path": "full/774ebd44e9357a83fc69c79170b01ff5f37f3599.jpg", "tags": "", "comment_nums": 0, "url_object_id": "34f408316936597fb4691ef7bcc11179", "url": "http://python.jobbole.com/87527/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/86117613b7a6\">鱼心fishstar</a>   </div><p>在数据分析的道路上，你一定曾有过为新发现而激动不已的时刻，此时你急于将自己的发现告诉大家，却遇到了这样的问题：<em>如何将我的分析过程清晰地表述出来呢？</em></p>\n<p>为了能与同行们有效沟通，你需要重现整个分析过程，并将说明文字、代码、图表、公式、结论都整合在一个文档中。显然传统的文本编辑工具并不能满足这一需求，所以这儿隆重推荐一款神器 <a href=\"http://jupyter.org/\" target=\"_blank\">Jupyter Notebook</a>，不仅能在文档中执行代码，还能以网页形式分享。</p>\n<p>下图简单展示了Jupyter Notebook 文档的样式，更多示例可在 <a href=\"http://nbviewer.jupyter.org/\" target=\"_blank\">nbviewer</a> 中找到。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/332de395b21f2788a46010117b708553.png\"><br>\nJupyter Notebook 文档示例</p>\n<p>本文将按如下内容来展开：</p>\n<blockquote><p>一、Jupyter Notebook 介绍</p></blockquote>\n<ul>\n<li>文学编程</li>\n<li>历史传承</li>\n<li>优点</li>\n</ul>\n<blockquote><p>二、Jupyter Notebook 使用入门</p></blockquote>\n<ul>\n<li>安装</li>\n<li>运行</li>\n<li>界面</li>\n</ul>\n<blockquote><p>三、Jupyter Notebook 进阶功能</p></blockquote>\n<ul>\n<li>数学公式编辑</li>\n<li>幻灯片制作</li>\n<li>魔术关键字</li>\n</ul>\n<hr>\n<h2>一、Jupyter Notebook 介绍</h2>\n<h3>文学编程</h3>\n<p>在介绍 Jupyter Notebook 之前，让我们先来看一个概念：<strong><a href=\"https://zh.m.wikipedia.org/wiki/%E6%96%87%E5%AD%A6%E7%BC%96%E7%A8%8B\" target=\"_blank\">文学编程</a></strong> ( <strong>Literate programming</strong> )，这是由 Donald Knuth 提出的<a href=\"http://www.literateprogramming.com\" target=\"_blank\">编程方法</a>。传统的结构化编程，人们需要按计算机的逻辑顺序来编写代码；与此相反，文学编程则可以让人们按照自己的思维逻辑来开发程序。</p>\n<p>简单来说，文学编程的读者不是机器，而是人。 我们从写出让机器读懂的代码，过渡到向人们解说如何让机器实现我们的想法，其中除了代码，更多的是叙述性的文字、图表等内容。这么一看，这不正是数据分析人员所需要的编码风格么？不仅要当好一个程序员，还得当好一个作家。那么 Jupyter Notebook 就是不可或缺的一款集编程和写作于一体的效率工具。</p>\n<h3>历史传承</h3>\n<p>也许说到 Jupyter 你会觉得陌生，但想必你或多或少听过鼎鼎大名的 <a href=\"https://ipython.org\" target=\"_blank\">IPython</a>。其实Jupyter 脱胎于 IPython 项目，IPython 顾名思义，是专注于 Python 的项目，但随着项目发展壮大，已经不仅仅局限于 Python 这一种编程语言了。Jupyter 的名字就很好地释义了这一发展过程，它是 <strong>Ju</strong>lia、<strong>Pyt</strong>hon 以及 <strong>R</strong> 语言的组合，字形相近于木星（Jupiter），而且现在支持的语言也远超这三种了。</p>\n<h3>优点</h3>\n<p>以下列举了 Jupyter Notebook 的众多优点：</p>\n<ul>\n<li>极其适合数据分析<br>\n想象一下如下混乱的场景：你在终端中运行程序，可视化结果却显示在另一个窗口中，包含函数和类的脚本存在其他文档中，更可恶的是你还需另外写一份说明文档来解释程序如何执行以及结果如何。此时 Jupyter Notebook 从天而降，将所有内容收归一处，你是不是顿觉灵台清明，思路更加清晰了呢？</li>\n<li>支持多语言<br>\n也许你习惯使用 R 语言来做数据分析，或者是想用学术界常用的 MATLAB 和 Mathematica，这些都不成问题，只要安装相对应的核（kernel）即可。<a href=\"https://github.com/jupyter/jupyter/wiki/Jupyter-kernels\" target=\"_blank\">这里</a>列出了 Jupyter 支持的所有语言，供您参考。</li>\n<li>分享便捷<br>\n支持以网页的形式分享，GitHub 中天然支持 Notebook 展示，也可以通过 <a href=\"http://nbviewer.jupyter.org\" target=\"_blank\">nbviewer</a> 分享你的文档。当然也支持导出成 HTML、Markdown 、PDF 等多种格式的文档。</li>\n<li>远程运行<br>\n在任何地点都可以通过网络链接远程服务器来实现运算，这里给出一个远程运行的<a href=\"https://try.jupyter.org\" target=\"_blank\">例子</a>，可以体验一下 Jupyter Notebook。</li>\n<li>交互式展现<br>\n不仅可以输出图片、视频、数学公式，甚至可以呈现一些互动的可视化内容，比如可以缩放的地图或者是可以旋转的三维模型。这就需要交互式插件（Interactive widgets）来支持，更多内容请参考<a href=\"http://jupyter.org/widgets.html\" target=\"_blank\">这里</a>。</li>\n</ul>\n<hr>\n<h2>二、Jupyter Notebook 使用入门</h2>\n<h3>安装</h3>\n<p>对于初学者，最简单的方法是安装 Anaconda，因为它自带了 Jupyter Notebook。如果想进一步了解 Anaconda 的使用方法，可参考我的上一篇文章<a href=\"http://www.jianshu.com/p/169403f7e40c\" target=\"_blank\">《致Python初学者们 – Anaconda入门使用指南》</a>。</p>\n<p>对于有经验的同学，自然使用命令行最为便捷。</p>\n<p>如果在 conda 环境中，可以使用如下命令安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86236e91359798803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconda install jupyter notebook</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86236e91359798803-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86236e91359798803-1\"><span class=\"crayon-e\">conda </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">jupyter </span><span class=\"crayon-v\">notebook</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者直接通过 pip 安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86236e9b367510250\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install jupyter notebook</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86236e9b367510250-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86236e9b367510250-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">jupyter </span><span class=\"crayon-v\">notebook</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>更多的安装说明请参考<a href=\"http://jupyter.org/install.html\" target=\"_blank\">官网</a>。</p>\n<h3>运行</h3>\n<p>如果使用 Anaconda，可以在其 Navigator 图形界面中点击打开 Notebook。但是最快捷的方法还是在命令行中输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86236e9f852767296\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njupyter notebook</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86236e9f852767296-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86236e9f852767296-1\"><span class=\"crayon-e\">jupyter </span><span class=\"crayon-v\">notebook</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>此时你的 Web 浏览器被自动打开，显示文件目录。通过点击右上角的 <code>new</code> 创建新文档。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/8310e7c227d3ab483bbece71da3f12a4.png\"><br>\n进入 notebook</p>\n<p>而关闭 notebook 文档可以通过选择文件名前的复选框后，点击 <code>Shutdown</code> 按钮实现。如果要关闭整个服务，则在原来的终端中按 <code>Control + C</code> 两次。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/2ed93cee31d2cd6ca3cc100975734ca6.png\"><br>\n退出 notebook</p>\n<h3>界面</h3>\n<p>Notebook 文档是由一系列<em>单元</em>（Cell）构成，主要有两种形式的单元：</p>\n<ul>\n<li>代码单元：这里是你编写代码的地方，通过按 <code>Shift + Enter</code> 运行代码，其结果显示在本单元下方。代码单元左边有 <code>In [1]:</code> 这样的序列标记，方便人们查看代码的执行次序。</li>\n<li>Markdown 单元：在这里对文本进行编辑，采用 markdown 的语法规范，可以设置文本格式、插入链接、图片甚至数学公式。同样使用 <code>Shift + Enter</code> 运行 markdown 单元来显示格式化的文本。</li>\n</ul>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/22f807dcd225fdc00a0e5febdce499ab.png\"><br>\nJupyter Notebook 编辑界面</p>\n<p>类似于 Linux 的 Vim 编辑器，在 notebook 中也有两种模式：</p>\n<ul>\n<li>编辑模式：编辑文本和代码。选中单元并按 <code>Enter</code> 键进入编辑模式，此时单元左侧显示绿色竖线。</li>\n<li>命令模式：用于执行键盘输入的快捷命令。通过 <code>Esc</code> 键进入命令模式，此时单元左侧显示蓝色竖线。</li>\n</ul>\n<p>如果要使用快捷键，首先按 <code>Esc</code> 键进入命令模式，然后按相应的键实现对文档的操作。比如切换成代码单元（<code>Y</code>）或 markdown 单元（<code>M</code>），或者在本单元的下方增加一单元（<code>B</code>）。查看所有快捷命令可以按<code>H</code>。</p>\n<p>尽管一开始需要花费一些学习成本，但熟练使用快捷键将大大提高工作效率。试想你在键盘上十指如飞时，如果还需要通过鼠标来操作文档，是不是很影响思考速度呢？</p>\n<hr>\n<h2>三、Jupyter Notebook 进阶功能</h2>\n<h3>数学公式编辑</h3>\n<p>如果你曾做过严肃的学术研究，一定对 <a href=\"https://www.latex-project.org\" target=\"_blank\">LaTeX</a> 并不陌生，这简直是写科研论文的必备工具，不但能实现严格的文档排版，而且能编辑复杂的数学公式。在 Jupyter Notebook 的 markdown 单元中我们也可以使用 LaTeX 的语法来插入数学公式。</p>\n<p>在文本行中插入数学公式，使用一对 <code>$</code>符号，比如质能方程 <code>$E = mc^2$</code>。如果要插入一个数学区块，则使用一对美元$符号。比如下面公式表示 z=x/y：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86236ea4610732732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ $ z = frac{x}{y} $ $</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86236ea4610732732-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86236ea4610732732-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">z</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">frac</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>如何在 notebook 中使用 LaTeX，可进一步参考 <a href=\"http://data-blog.udacity.com/posts/2016/10/latex-primer/\" target=\"_blank\">A Primer on Using LaTeX in Jupyter Notebooks</a> 这篇文章。</p>\n<h3>幻灯片制作</h3>\n<p>既然Jupyter Notebook 擅长展示数据分析的过程，除了通过网页形式分享外，当然也可以将其制作成幻灯片的形式。这里有一个幻灯片<a href=\"http://www.slideviper.oquanta.info/tutorial/slideshow_tutorial_slides.html#/\" target=\"_blank\">示例</a>供参考，其制作风格简洁明晰。</p>\n<p>那么如何用 Jupyter Notebook 制作幻灯片呢？首先在 notebook 的菜单栏选择 View &gt; Cell Toolbar &gt; Slideshow，这时在文档的每个单元右上角显示了 Slide Type 的选项。通过设置不同的类型，来控制幻灯片的格式。有如下5中类型：</p>\n<ul>\n<li>Slide：主页面，通过按左右方向键进行切换。</li>\n<li>Sub-Slide：副页面，通过按上下方向键进行切换。</li>\n<li>Fragment：一开始是隐藏的，按空格键或方向键后显示，实现动态效果。</li>\n<li>Skip：在幻灯片中不显示的单元。</li>\n<li>Notes：作为演讲者的备忘笔记，也不在幻灯片中显示。</li>\n</ul>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/fe34193562d85fe0e032c1a8678c6f98.png\"><br>\nJupyter Notebook 幻灯片设置</p>\n<p>当编写好了幻灯片形式的 notebook，如何来演示呢？这时需要使用 <code>nbconvert</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86236ea8013422504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njupyter nbconvert notebook.ipynb --to slides --post serve</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86236ea8013422504-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86236ea8013422504-1\"><span class=\"crayon-e\">jupyter </span><span class=\"crayon-e\">nbconvert </span><span class=\"crayon-v\">notebook</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ipynb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slides</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">post </span><span class=\"crayon-v\">serve</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在命令行中敲入上述代码后，浏览器会自动打开相应的幻灯片。</p>\n<h3>魔术关键字</h3>\n<p>魔术关键字（magic keywords），正如其名，是用于控制 notebook 的特殊的命令。它们运行在代码单元中，以 <code>%</code> 或者 <code>%%</code> 开头，前者控制一行，后者控制整个单元。</p>\n<p>比如，要得到代码运行的时间，则可以使用 <code>%timeit</code>；如果要在文档中显示 matplotlib 包生成的图形，则使用 <code>% matplotlib inline</code>；如果要做代码调试，则使用 <code>%pdb</code>。但注意这些命令大多是在Python kernel 中适用的，其他 kernel 大多不适用。有许许多多的魔术关键字可以使用，更详细的清单请参考 <a href=\"http://ipython.readthedocs.io/en/stable/interactive/magics.html\" target=\"_blank\">Built-in magic commands</a> 。</p>\n<hr>\n<h2>相关资源汇总</h2>\n<p>本文给出了许多扩展链接供参考，这里汇总如下，供您参考：</p>\n<ol>\n<li><a href=\"http://jupyter.org/\" target=\"_blank\">Jupyter Notebook 官网</a></li>\n<li><a href=\"http://www.literateprogramming.com\" target=\"_blank\">文学编程 Literate programming</a></li>\n<li><a href=\"https://ipython.org\" target=\"_blank\">IPython 官网</a></li>\n<li><a href=\"https://www.latex-project.org\" target=\"_blank\">LaTeX官网</a></li>\n<li><a href=\"http://data-blog.udacity.com/posts/2016/10/latex-primer/\" target=\"_blank\">LaTeX 语法：A Primer on Using LaTeX in Jupyter Notebooks</a></li>\n<li><a href=\"http://ipython.readthedocs.io/en/stable/interactive/magics.html\" target=\"_blank\">魔术关键字：Built-in magic commands</a></li>\n</ol>\n<ul>\n<li>如果你现在迫不及待地想试一试 Jupyter Notebook了，请参考系列文章<a href=\"http://www.jianshu.com/p/39eb230e6f15\" target=\"_blank\">Python数据分析的起手式</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87527\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87527votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87527\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/e509b419c9e7f95eccc2fbd8223c80e8.png"], "title": "左手程序员，右手作家：你必须会的Jupyter Notebook", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/d21a83f6d43617f04d77157889bd773c35ec673d.jpg", "tags": "", "comment_nums": 0, "url_object_id": "fa4b0cf9897d73db22c5438a302d6e19", "url": "http://python.jobbole.com/87500/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://cyrusin.github.io/2016/03/11/python-closure-20160311/\">Li Shuai</a>   </div><h2>延迟绑定</h2>\n<p>Python闭包函数所引用的外部自由变量是延迟绑定的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c878ef77c551475386\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nIn [2]: def multipliers():\r\n   ...:     return [lambda x: i * x for i in range(4)] \r\nIn [3]: print [m(2) for m in multipliers()]\r\n[6, 6, 6, 6]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef77c551475386-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef77c551475386-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef77c551475386-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef77c551475386-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c878ef77c551475386-1\"><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">multipliers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef77c551475386-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2c878ef77c551475386-3\"><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">m</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">multipliers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef77c551475386-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>如以上代码: <code>i</code>是闭包函数引用的外部作用域的自由变量, 只有在内部函数被调用的时候才会搜索变量<code>i</code>的值, 由于循环已结束, <code>i</code>指向最终值3, 所以各函数调用都得到了相同的结果。</p>\n<p>解决方法:</p>\n<p>1) 生成闭包函数的时候立即绑定(<strong>使用函数形参的默认值</strong>):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c878ef792029181834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nIn [5]: def multipliers():\r\n    return [lambda x, i=i: i* x for i in range(4)]\r\n       ...: \r\n\r\nIn [6]: print [m(2) for m in multipliers()]\r\n[0, 2, 4, 6]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef792029181834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef792029181834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef792029181834-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef792029181834-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef792029181834-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef792029181834-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c878ef792029181834-1\"><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">multipliers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef792029181834-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c878ef792029181834-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef792029181834-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c878ef792029181834-5\"><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">m</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">multipliers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef792029181834-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>如以上代码: 生成闭包函数的时候, 可以看到每个闭包函数都有一个带默认值的参数: <code>i=i</code>, 此时, 解释器会查找<code>i</code>的值, 并将其赋予形参<code>i</code>, 这样在生成闭包函数的外部作用域(即外部循环中), 找到了变量<code>i</code>, 遂将其当前值赋予形参<code>i</code>。</p>\n<p>2) 使用<strong>functools.partial</strong>:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c878ef796056921069\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nIn [26]: def multipliers():\r\n    return [functools.partial(lambda i, x: x * i, i) for i in range(4)]\r\n    ....: \r\n\r\nIn [27]: print [m(2) for m in multipliers()]\r\n    [0, 2, 4, 6]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef796056921069-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef796056921069-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef796056921069-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef796056921069-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef796056921069-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef796056921069-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c878ef796056921069-1\"><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">26</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">multipliers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef796056921069-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">functools</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">partial</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c878ef796056921069-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef796056921069-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c878ef796056921069-5\"><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">m</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">multipliers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef796056921069-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>如以上代码: 在有可能因为延迟绑定而出问题的时候, 可以通过<code>functools.partial</code>构造偏函数, 使得自由变量优先绑定到闭包函数上。</p>\n<h2><span id=\"pos_placeholder\" style=\"width: 0px;height: 0px;margin: 0px;padding: 0px\"></span>禁止在闭包函数内对引用的自由变量进行重新绑定</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c878ef799822845526\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef foo(func):\r\n    free_value = 8\r\n    def _wrapper(*args, **kwargs):\r\n        old_free_value = free_value #保存旧的free_value\r\n        free_value = old_free_value * 2 #模拟产生新的free_value\r\n        func(*args, **kwargs)\r\n        free_value = old_free_value\r\n    return _wrapper</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef799822845526-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef799822845526-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef799822845526-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef799822845526-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef799822845526-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef799822845526-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c878ef799822845526-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c878ef799822845526-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c878ef799822845526-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef799822845526-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">free_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-58e2c878ef799822845526-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef799822845526-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">old_free_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#保存旧的free_value</span></div><div class=\"crayon-line\" id=\"crayon-58e2c878ef799822845526-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">free_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">old_free_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#模拟产生新的free_value</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef799822845526-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c878ef799822845526-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">free_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">old_free_value</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c878ef799822845526-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_wrapper</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>以上代码会报错, <code>UnboundLocalError: local variable 'free_value' referenced before assignment</code>, 以上代码本意是打算实现一个带有某个初始化状态(<code>free_value</code>)但在执行内部闭包函数的时候又可以按需变化出新的状态(<code>free_value = old_free_value * 2</code>)的装饰器, 但内部由于发生了重新绑定, 解释器会将<code>free_value</code>看作局部变量, <code>old_free_value = free_value</code>则会报错, 因为解释器认为<code>free_value</code>是没有赋值就被引用了。</p>\n<p>解决：打算修改闭包函数引用的自由变量时, 可以将其放入一个list, 这样, <code>free_value = [8]</code>, <code>free_value</code>不可修改, 但<code>free_value[0]</code>是可以安全的被修改的。</p>\n<p>另外, Python 3.x增加了<code>nonlocal</code>关键字, 也可以解决这个问题。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87500\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87500votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87500\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/591d8b55a524f825dd29a22b8df70000.jpg"], "title": "Python闭包的两个注意事项", "fav_nums": 1}
{"praise_nums": 2, "front_image_path": "full/b1cbb12f48a1ab3c3b853279ca5df78907afbb96.jpg", "tags": "", "comment_nums": 0, "url_object_id": "b0dd33cc1643d58bf88f4408c3349f89", "url": "http://python.jobbole.com/87502/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/lihao21/article/details/52304119\">haozlee</a>   </div><div>\n<h1 id=\"概览\">概览</h1>\n<p>之前对 Nginx，WSGI（或者 uWSGI，uwsgi），Flask(或者 Django），这几者的关系一存存在疑惑。通过查阅了些资料，总算把它们的关系理清了。<br>\n总括来说，客户端从发送一个 HTTP 请求到 Flask 处理请求，分别经过了 web服务器层，WSGI层，web框架层，这三个层次。不同的层次其作用也不同，下面简要介绍各层的作用。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/ea59b2826893aabac52f96f8d1fd733a.jpg\" alt=\"web服务器，web框架与WSGI的三层关系\"></p>\n<p>图1：web服务器，web框架与 WSGI 的三层关系</p>\n<p><span id=\"more-87502\"></span></p>\n<h1 id=\"web服务器层\">Web服务器层</h1>\n<p>对于传统的客户端 – 服务器架构，其请求的处理过程是，客户端向服务器发送请求，服务器接收请求并处理请求，然后给客户端返回响应。在这个过程中，服务器的作用是：</p>\n<ol>\n<li>接收请求</li>\n<li>处理请求</li>\n<li>返回响应</li>\n</ol>\n<p>Web服务器是一类特殊的服务器，其作用是主要是接收 HTTP 请求并返回响应。提起 web服务器大家都不会陌生，常见的 web服务器有 Nginx，Apache，IIS等。在上图1的三层结构中，web服务器是最先接收用户请求的，并将响应结果返回给用户。</p>\n<h1 id=\"web框架层\">Web框架层</h1>\n<p>Web框架的作用主要是方便我们开发 web应用程序，HTTP请求的动态数据就是由 web框架层来提供的。常见的 web框架有Flask，Django等，我们以 Flask 框架为例子，展示 web框架的作用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2bc7f90d2d267159683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom flask import Flask\r\napp = Flask(__name__)\r\n\r\n@app.route('/hello')\r\ndef hello_world():\r\n    return 'Hello World!'\r\n\r\nif __name__ == '__main__':\r\n    app.run(host='0.0.0.0', port=8080)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d2d267159683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2bc7f90d2d267159683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d2d267159683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2bc7f90d2d267159683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d2d267159683-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2bc7f90d2d267159683-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d2d267159683-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2bc7f90d2d267159683-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d2d267159683-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d2d267159683-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">flask </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Flask</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2bc7f90d2d267159683-2\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d2d267159683-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2bc7f90d2d267159683-4\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/hello'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d2d267159683-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">hello_world</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2bc7f90d2d267159683-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hello World!'</span></div><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d2d267159683-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2bc7f90d2d267159683-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d2d267159683-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'0.0.0.0'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8080</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>以上简单的几行代码，就创建了一个 web应用程序对象 <code>app</code>。<code>app</code> 监听机器所有 ip 的 8080 端口，接受用户的请求连接。我们知道，HTTP 协议使用 URL 来定位资源，上面的程序会将路径 <code>/hello</code> 的请求交由 <code>hello_world</code> 方法处理，<code>hello_world</code> 返回 ‘Hello World!’ 字符串。对于 web框架的使用者来说，他们并不关心如何接收 HTTP 请求，也不关心如何将请求路由到具体方法处理并将响应结果返回给用户。Web框架的使用者在大部分情况下，只需要关心如何实现业务的逻辑即可。</p>\n<h1 id=\"wsgi层\">WSGI层</h1>\n<p>WSGI 不是服务器，也不是用于与程序交互的API，更不是真实的代码，WSGI 只是一种接口,它只适用于 Python 语言，其全称为 Web Server Gateway Interface，定义了 web服务器和 web应用之间的接口规范。也就是说，只要 web服务器和 web应用都遵守WSGI协议，那么 web服务器和 web应用就可以随意的组合。<br>\n下面的代码展示了 web服务器是如何与 web应用组合在一起的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2bc7f90d38712114731\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef application(env, start_response):\r\n    start_response('200 OK', [('Content-Type', 'text/html')])\r\n    return [b\"Hello World\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d38712114731-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2bc7f90d38712114731-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2bc7f90d38712114731-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d38712114731-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">application</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2bc7f90d38712114731-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">start_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'200 OK'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/html'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2bc7f90d38712114731-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\"Hello World\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>方法 <code>application</code>由 web服务器调用，参数<code>env</code>，<code>start_response</code> 由 web服务器实现并传入。其中，<code>env</code>是一个字典，包含了类似 HTTP_HOST，HOST_USER_AGENT，SERVER_PROTOCO 等环境变量。<code>start_response</code>则是一个方法，该方法接受两个参数，分别是<code>status</code>，<code>response_headers</code>。<code>application</code>方法的主要作用是，设置 http 响应的状态码和 Content-Type 等头部信息，并返回响应的具体结果。</p>\n<p>上述代码就是一个完整的 WSGI 应用，当一个支持 WSGI 的 web服务器接收到客户端的请求后，便会调用这个 <code>application</code> 方法。WSGI 层并不需要关心<code>env</code>，<code>start_response</code> 这两个变量是如何实现的，就像在 <code>application</code> 里面所做的，直接使用这两个变量即可。</p>\n<p>值得指出的是，WSGI 是一种协议，需要区分几个相近的名词：</p>\n<ul>\n<li>uwsgi<br>\n同 wsgi 一样也是一种协议，uWSGI服务器正是使用了 uwsgi 协议</li>\n<li>uWSGI<br>\n实现了 uwsgi 和 WSGI 两种协议的web服务器。注意 uWSGI 本质上也是一种 web服务器，处于上面描述的三层结构中的 web服务器层。</li>\n<li>CGI<br>\n通用网关接口，并不限于 Python 语言，定义了 web服务器是如何向客户端提供动态的内容。例如，规定了客户端如何将参数传递给 web服务器，web服务器如何将参数传递给 web应用，web应用如何将它的输出如何发送给客户端，等等。<br>\n生产环境下的 web应用都不使用 CGI 了，CGI进程（类似 Python 解释器）针对每个请求创建，用完就抛弃，效率低下。WSGI 正是为了替代 CGI 而出现的。</li>\n</ul>\n<p>说到这，我们基本理清了 WSGI 在 web服务器与 web框架之间作用：WSGI 就像一条纽带，将 web服务器与 web框架连接起来。回到本文的题目，Nginx 属于一种 web服务器，Flask属于一种 web框架，因此，WSGI 与 Nginx、Flask 的作用就不明而喻了。</p>\n<p>最后以 Nginx，WSGI，Flask 之间的对话结束本文。<br>\n<strong>Nginx</strong>：Hey，WSGI，我刚收到了一个请求，我需要你作些准备，然后由Flask来处理这个请求。<br>\n<strong>WSGI</strong>：OK，Nginx。我会设置好环境变量，然后将这个请求传递给Flask处理。<br>\n<strong>Flask</strong>：Thanks WSGI！给我一些时间，我将会把请求的响应返回给你。<br>\n<strong>WSGI</strong>：Alright，那我等你。<br>\n<strong>Flask</strong>：Okay，我完成了，这里是请求的响应结果，请求把结果传递给Nginx。<br>\n<strong>WSGI</strong>：Good job！Nginx，这里是响应结果，已经按照要求给你传递回来了。<br>\n<strong>Nginx</strong>：Cool，我收到了，我把响应结果返回给客户端。大家合作愉快~</p>\n<h1 id=\"参考资料\">参考资料：</h1>\n<ol>\n<li><a href=\"http://hackerxu.com/2015/05/10/flask011.html\">http://hackerxu.com/2015/05/10/flask011.html</a></li>\n<li><a href=\"https://www.quora.com/What-are-good-ways-to-understand-WSGI-flup-fastcgi-CGI-and-Django\">https://www.quora.com/What-are-good-ways-to-understand-WSGI-flup-fastcgi-CGI-and-Django</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface\">https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface</a></li>\n<li><a href=\"http://flask.pocoo.org/docs/0.10/quickstart/\">http://flask.pocoo.org/docs/0.10/quickstart/</a></li>\n<li><a href=\"http://stackoverflow.com/questions/219110/how-python-web-frameworks-wsgi-and-cgi-fit-together\">http://stackoverflow.com/questions/219110/how-python-web-frameworks-wsgi-and-cgi-fit-together</a></li>\n<li><a href=\"https://www.python.org/dev/peps/pep-0333/\">https://www.python.org/dev/peps/pep-0333/</a></li>\n<li>《Python核心编程（第3版）》Wesley Chun著</li>\n</ol>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87502\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87502votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87502\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/a540fbb0f3cd5c7aa48940cfb6f27467.png"], "title": "如何理解Nginx, WSGI, Flask之间的关系", "fav_nums": 8}
{"praise_nums": 2, "front_image_path": "full/af4571ab68e7f3066d3aadf08de9928f8d6c901b.jpg", "tags": "", "comment_nums": 0, "url_object_id": "f69bf13e29990e8c12fe6d0163d185a9", "url": "http://python.jobbole.com/86917/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q3198108035\">tsteho</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.blog.pythonlibrary.org/2016/08/02/python-201-a-multiprocessing-tutorial/\">Mike</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Python2.6版本中新添了multiprocessing模块。它最初由Jesse Noller和Richard Oudkerk定义在<a href=\"https://www.python.org/dev/peps/pep-0371/\"><u>PEP 371</u></a>中。就像你能通过threading模块衍生线程一样，multiprocessing 模块允许你衍生进程。这里用到的思想：因为你现在能衍生进程，所以你能够避免使用全局解释器锁（GIL），并且充分利用机器的多个处理器。</p>\n<p>多进程包也包含一些根本不在threading 模块中的API。比如：有一个灵活的Pool类能让你在多个输入下并行化地执行函数。我们将在后面的小节讲解Pool类。我们将以multiprocessing模块的<strong><b>Process</b></strong>类开始讲解。</p>\n<p>…………………………………………………………………………………………………………………………</p>\n<h3>开始学习multiprocessing模块</h3>\n<p>Process这个类和threading模块中的Thread类很像。让我们创建一系列调用相同函数的进程，并且看看它是如何工作的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9dbc205116603\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\n \r\nfrom multiprocessing import Process\r\n \r\ndef doubler(number):\r\n    \"\"\"\r\n    A doubling function that can be used by a process\r\n    \"\"\"\r\n    result = number * 2\r\n    proc = os.getpid()\r\n    print('{0} doubled to {1} by process id: {2}'.format(\r\n        number, result, proc))\r\n \r\nif __name__ == '__main__':\r\n    numbers = [5, 10, 15, 20, 25]\r\n    procs = []\r\n \r\n    for index, number in enumerate(numbers):\r\n        proc = Process(target=doubler, args=(number,))\r\n        procs.append(proc)\r\n        proc.start()\r\n \r\n    for proc in procs:\r\n        proc.join()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dbc205116603-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dbc205116603-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-7\"><span class=\"crayon-s\">    A doubling function that can be used by a process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-8\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'{0} doubled to {1} by process id: {2}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-13\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">numbers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">procs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">numbers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">doubler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">procs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-22\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dbc205116603-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">proc </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">procs</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dbc205116603-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>对于上面的例子，我们导入<strong><b>Process</b></strong>类、创建一个叫<strong><b>doubler</b></strong>的函数。在函数中，我们将传入的数字乘上2。我们也用Python的<strong><b>os</b></strong>模块来获取当前进程的ID（pid）。这个ID将告诉我们哪个进程正在调用<strong><b>doubler</b></strong>函数。然后，在下面的代码块中，我们实例化了一系列的Process类并且启动它们。最后一个循环只是调用每个进程的<strong><b>join()</b></strong>方法，该方法告诉Python等待进程直到它结束。如果你需要结束一个进程，你可以调用它的<strong><b>terminate()</b></strong>方法。</p>\n<p>当你运行上面的代码，你应该看到和下面类似的输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9dc9803174893\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n5 doubled to 10 by process id: 10468\r\n10 doubled to 20 by process id: 10469\r\n15 doubled to 30 by process id: 10470\r\n20 doubled to 40 by process id: 10471\r\n25 doubled to 50 by process id: 10472</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dc9803174893-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dc9803174893-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dc9803174893-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dc9803174893-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dc9803174893-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9dc9803174893-1\"><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">process </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10468</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dc9803174893-2\"><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">process </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10469</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dc9803174893-3\"><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">process </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10470</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dc9803174893-4\"><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">process </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10471</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dc9803174893-5\"><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">process </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10472</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>有时候，你最好给你的进程取一个易于理解的名字 。幸运的是，<strong><b>Process</b></strong>类确实允许你访问同样的进程。让我们来看看如下例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9dcd773917760\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\n \r\nfrom multiprocessing import Process, current_process\r\n \r\n \r\ndef doubler(number):\r\n    \"\"\"\r\n    A doubling function that can be used by a process\r\n    \"\"\"\r\n    result = number * 2\r\n    proc_name = current_process().name\r\n    print('{0} doubled to {1} by: {2}'.format(\r\n        number, result, proc_name))\r\n \r\n \r\nif __name__ == '__main__':\r\n    numbers = [5, 10, 15, 20, 25]\r\n    procs = []\r\n    proc = Process(target=doubler, args=(5,))\r\n \r\n    for index, number in enumerate(numbers):\r\n        proc = Process(target=doubler, args=(number,))\r\n        procs.append(proc)\r\n        proc.start()\r\n \r\n    proc = Process(target=doubler, name='Test', args=(2,))\r\n    proc.start()\r\n    procs.append(proc)\r\n \r\n    for proc in procs:\r\n        proc.join()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dcd773917760-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dcd773917760-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">current_process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-5\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-6\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-8\"><span class=\"crayon-s\">    A doubling function that can be used by a process</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-9\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proc_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">current_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'{0} doubled to {1} by: {2}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proc_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-14\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-15\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-16\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">numbers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">procs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">doubler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">numbers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">doubler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">procs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-25\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">doubler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'Test'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">procs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-29\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dcd773917760-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">proc </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">procs</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dcd773917760-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p>这一次，我们多导入了<strong><b>current_process</b></strong>。<strong><b>current_process</b></strong>基本上和threading模块的<strong><b>current_thread</b></strong>是类似的东西。我们用它来获取正在调用我们的函数的线程的名字。你将注意到我们没有给前面的5个进程设置名字。然后我们将第6个进程的名字设置为“Test”。</p>\n<p>让我们看看我们将得到什么样的输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9dd2334257039\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n5 doubled to 10 by: Process-2\r\n10 doubled to 20 by: Process-3\r\n15 doubled to 30 by: Process-4\r\n20 doubled to 40 by: Process-5\r\n25 doubled to 50 by: Process-6\r\n2 doubled to 4 by: Test</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd2334257039-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd2334257039-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd2334257039-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd2334257039-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd2334257039-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd2334257039-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd2334257039-1\"><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd2334257039-2\"><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd2334257039-3\"><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd2334257039-4\"><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd2334257039-5\"><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd2334257039-6\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubled </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Test</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>输出结果说明：默认情况下，multiprocessing模块给每个进程分配了一个编号，而该编号被用来组成进程的名字的一部分。当然，如果我们给定了名字的话，并不会有编号被添加到名字中。</p>\n<h3>锁</h3>\n<p><strong><b>multiprocessing</b></strong>模块支持锁，它和threading模块做的方式一样。你需要做的只是导入Lock，获取它，做一些事，释放它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9dd5081771765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom multiprocessing import Process, Lock\r\n \r\n \r\ndef printer(item, lock):\r\n    \"\"\"\r\n    Prints out the item that was passed in\r\n    \"\"\"\r\n    lock.acquire()\r\n    try:\r\n        print(item)\r\n    finally:\r\n        lock.release()\r\n \r\nif __name__ == '__main__':\r\n    lock = Lock()\r\n    items = ['tango', 'foxtrot', 10]\r\n    for item in items:\r\n        p = Process(target=printer, args=(item, lock))\r\n        p.start()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9dd5081771765-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9dd5081771765-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lock</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-3\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">printer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-6\"><span class=\"crayon-s\">    Prints out the item that was passed in</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-7\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-13\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'tango'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'foxtrot'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9dd5081771765-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">printer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9dd5081771765-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>我们在这里创建了一个简单的用于打印函数，你输入什么，它就输出什么。为了避免线程之间互相阻塞，我们使用Lock对象。代码循环列表中的三个项并为它们各自都创建一个进程。每一个进程都将调用我们的函数，并且每次遍历到的那一项作为参数传入函数。因为我们现在使用了锁，所以队列中下一个进程将一直阻塞，直到之前的进程释放锁。</p>\n<h3>日志</h3>\n<p>为进程创建日志与为线程创建日志有一些不同。它们存在不同是因为Python的logging包不使用共享锁的进程，因此有可能以来自不同进程的信息作为结束的标志。让我们试着给前面的例子添加基本的日志。代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9ddb873048444\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport logging\r\nimport multiprocessing\r\n \r\nfrom multiprocessing import Process, Lock\r\n \r\ndef printer(item, lock):\r\n    \"\"\"\r\n    Prints out the item that was passed in\r\n    \"\"\"\r\n    lock.acquire()\r\n    try:\r\n        print(item)\r\n    finally:\r\n        lock.release()\r\n \r\nif __name__ == '__main__':\r\n    lock = Lock()\r\n    items = ['tango', 'foxtrot', 10]\r\n    multiprocessing.log_to_stderr()\r\n    logger = multiprocessing.get_logger()\r\n    logger.setLevel(logging.INFO)\r\n    for item in items:\r\n        p = Process(target=printer, args=(item, lock))\r\n        p.start()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddb873048444-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddb873048444-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">logging</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lock</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-5\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-6\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">printer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-8\"><span class=\"crayon-s\">    Prints out the item that was passed in</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-9\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-15\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-16\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'tango'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'foxtrot'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log_to_stderr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_logger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setLevel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddb873048444-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">printer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddb873048444-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>最简单的添加日志的方法通过推送它到stderr实现。我们能通过调用the<strong><b>log_to_stderr()</b></strong> 函数来实现该方法。然后我们调用<strong><b>get_logger</b></strong> 函数获得一个logger实例，并将它的日志等级设为INFO。之后的代码是相同的。需要提示下这里我并没有调用join()方法。取而代之的：当它退出，父线程将自动调用join()方法。</p>\n<p>当你这么做了，你应该得到类似下面的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9ddf382922278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[INFO/Process-1] child process calling self.run()\r\ntango\r\n[INFO/Process-1] process shutting down\r\n[INFO/Process-1] process exiting with exitcode 0\r\n[INFO/Process-2] child process calling self.run()\r\n[INFO/MainProcess] process shutting down\r\nfoxtrot\r\n[INFO/Process-2] process shutting down\r\n[INFO/Process-3] child process calling self.run()\r\n[INFO/Process-2] process exiting with exitcode 0\r\n10\r\n[INFO/MainProcess] calling join() for process Process-3\r\n[INFO/Process-3] process shutting down\r\n[INFO/Process-3] process exiting with exitcode 0\r\n[INFO/MainProcess] calling join() for process Process-2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ddf382922278-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ddf382922278-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">calling </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-2\"><span class=\"crayon-i\">tango</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">shutting </span><span class=\"crayon-i\">down</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">exiting </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exitcode</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">calling </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">MainProcess</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">shutting </span><span class=\"crayon-e\">down</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-7\"><span class=\"crayon-i\">foxtrot</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-8\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">shutting </span><span class=\"crayon-i\">down</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">calling </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-10\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">exiting </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exitcode</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-11\"><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-12\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">MainProcess</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calling </span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-13\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">shutting </span><span class=\"crayon-i\">down</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ddf382922278-14\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">exiting </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exitcode</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ddf382922278-15\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">MainProcess</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calling </span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-v\">Process</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p>现在如果你想要保存日志到硬盘中，那么这件事就显得有些棘手。你能在Python的<a href=\"#logging-to-a-single-file-from-multiple-processes\"><u>logging Cookbook</u></a>阅读一些有关那类话题。</p>\n<h3>Pool类</h3>\n<p>Pool类被用来代表一个工作进程池。它有让你将任务转移到工作进程的方法。让我们看下面一个非常简单的例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9de4801441937\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom multiprocessing import Pool\r\n \r\ndef doubler(number):\r\n    return number * 2\r\n \r\nif __name__ == '__main__':\r\n    numbers = [5, 10, 20]\r\n    pool = Pool(processes=3)\r\n    print(pool.map(doubler, numbers))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de4801441937-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de4801441937-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de4801441937-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de4801441937-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de4801441937-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de4801441937-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de4801441937-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de4801441937-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de4801441937-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9de4801441937-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de4801441937-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de4801441937-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de4801441937-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de4801441937-5\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de4801441937-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de4801441937-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">numbers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de4801441937-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">processes</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de4801441937-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doubler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">numbers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>基本上执行上述代码之后，一个Pool的实例被创建，并且该实例创建了3个工作进程。然后我们使用<strong><b>map</b></strong> 方法将一个函数和一个可迭代对象映射到每个进程。最后我们打印出这个例子的结果：<strong><b>[10, 20, 40]</b></strong><strong><b>。</b></strong></p>\n<p>你也能通过<strong><b>apply_async</b></strong>方法获得池中进程的运行结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9de8955542184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom multiprocessing import Pool\r\n \r\ndef doubler(number):\r\n    return number * 2\r\n \r\nif __name__ == '__main__':\r\n    pool = Pool(processes=3)\r\n    result = pool.apply_async(doubler, (25,))\r\n    print(result.get(timeout=1))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de8955542184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de8955542184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de8955542184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de8955542184-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de8955542184-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de8955542184-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de8955542184-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9de8955542184-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9de8955542184-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9de8955542184-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de8955542184-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de8955542184-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doubler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de8955542184-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de8955542184-5\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de8955542184-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de8955542184-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">processes</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9de8955542184-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apply_async</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doubler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">25</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9de8955542184-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>我们上面做的事实际上就是请求进程的运行结果。那就是get函数的用途。它尝试去获取我们的结果。你能够注意到我们设置了timeout，这是为了预防我们调用的函数发生异常的情况。毕竟我们不想要它被无限期地阻塞。</p>\n<h3>进程通信</h3>\n<p>当遇到进程间通信的情况，multiprocessing 模块提供了两个主要的方法：Queues 和 Pipes。Queue 实现上既是线程安全的也是进程安全的。让我们看一个相当简单的并且基于 Queue的例子。代码来自于我的文章（<a href=\"http://www.blog.pythonlibrary.org/2016/07/28/python-201-a-tutorial-on-threads/\"><u>threading articles</u></a>）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88e9ded358177185\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom multiprocessing import Process, Queue\r\n \r\nsentinel = -1\r\n \r\ndef creator(data, q):\r\n    \"\"\"\r\n    Creates data to be consumed and waits for the consumer\r\n    to finish processing\r\n    \"\"\"\r\n    print('Creating data and putting it on the queue')\r\n    for item in data:\r\n \r\n        q.put(item)\r\n \r\n \r\ndef my_consumer(q):\r\n    \"\"\"\r\n    Consumes some data and works on it\r\n \r\n    In this case, all it does is double the input\r\n    \"\"\"\r\n    while True:\r\n        data = q.get()\r\n        print('data found to be processed: {}'.format(data))\r\n        processed = data * 2\r\n        print(processed)\r\n \r\n        if data is sentinel:\r\n            break\r\n \r\n \r\nif __name__ == '__main__':\r\n    q = Queue()\r\n    data = [5, 10, 13, -1]\r\n    process_one = Process(target=creator, args=(data, q))\r\n    process_two = Process(target=my_consumer, args=(q,))\r\n    process_one.start()\r\n    process_two.start()\r\n \r\n    q.close()\r\n    q.join_thread()\r\n \r\n    process_one.join()\r\n    process_two.join()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88e9ded358177185-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88e9ded358177185-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">multiprocessing</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Process</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-3\"><span class=\"crayon-v\">sentinel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-4\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">creator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-7\"><span class=\"crayon-s\">    Creates data to be consumed and waits for the consumer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-8\"><span class=\"crayon-s\">    to finish processing</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-9\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Creating data and putting it on the queue'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-12\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-14\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-15\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-16\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my_consumer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-18\"><span class=\"crayon-s\">    Consumes some data and works on it</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-19\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-20\"><span class=\"crayon-s\">    In this case, all it does is double the input</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-21\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'data found to be processed: {}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">processed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">processed</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-27\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentinel</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-30\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-31\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-32\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">process_one</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">creator</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">process_two</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">my_consumer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">process_one</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">process_two</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-42\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2da88e9ded358177185-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">process_one</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88e9ded358177185-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">process_two</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0061 seconds] -->\r\n<p>在这里我们只需要导入Queue和Process。Queue用来创建数据和添加数据到队列中，Process用来消耗数据并执行它。通过使用Queue的<strong><b>put()</b></strong><strong><b>和</b></strong><strong><b>get()</b></strong><strong><b>方法</b></strong>，我们就能添加数据到Queue、从Queue获取数据。代码的最后一块只是创建了Queue 对象以及两个Process对象，并且运行它们。你能注意到我们在进程对象上调用<strong><b>join()</b></strong><strong><b>方法</b></strong>，而不是在Queue本身上调用。</p>\n<h3><strong><b>总结</b></strong></h3>\n<p>我们这里有大量的资料。你已经学习如何使用multiprocessing模块指定不变的函数、使用Queues在进程间通信、给进程命名等很多事。在Python文档中也有很多本文没有接触到的知识点，因此也务必深入了解下文档。与此同时，你现在知道如何用Python利用你电脑所有的处理能力了！</p>\n<h3><strong><b>相关阅读</b></strong></h3>\n<ul>\n<li>有关multiprocessing模块的Python文档(<a href=\"https://docs.python.org/3/library/multiprocessing.html\"><u>multiprocessing module</u></a>)</li>\n<li>Python模块周刊：<a href=\"https://pymotw.com/2/multiprocessing/\"><u>multiprocessing</u></a></li>\n<li>Python的并发–<u><a href=\"http://www.blog.pythonlibrary.org/2012/08/03/python-concurrency-porting-from-a-queue-to-multiprocessing/\">Porting a Queue to multiprocessing</a></u></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"86917\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"86917votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"86917\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3198108035\">tsteho</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3198108035\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/78BB6F88A07D4D78DB552CAD9BD3D689/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Python爱好者        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q3198108035\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/q3198108035/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q3198108035/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"QQ：3280767506\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "title": "Python 201：多进程教程", "fav_nums": 4}
{"praise_nums": 1, "front_image_path": "full/d21a83f6d43617f04d77157889bd773c35ec673d.jpg", "tags": "", "comment_nums": 0, "url_object_id": "38a370f36a6b832e70b0a36c4af24e3c", "url": "http://python.jobbole.com/87492/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://wsfdl.com/python/2013/11/02/Python%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD.html\">koala bear</a>   </div><div>\n<blockquote><p>Direct use of <strong>__import__()</strong> is rare, except in cases where you want to import a module whose name is only known <strong>at runtime</strong>.</p></blockquote>\n<p>本文介绍 python module 的动态加载，我们有时希望从配置文件等地获取要被动态加载的 module，但是所读取的配置项通常为字符串类型，无法用 import 加载，例如：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c88526816417264549\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; import 'os'\r\n File \"&lt;stdin&gt;\", line 1\r\n import 'os'\r\n ^\r\nSyntaxError: invalid syntax\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c88526816417264549-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526816417264549-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526816417264549-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526816417264549-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526816417264549-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526816417264549-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c88526816417264549-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'os'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526816417264549-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526816417264549-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'os'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526816417264549-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526816417264549-5\"><span class=\"crayon-v\">SyntaxError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">invalid </span><span class=\"crayon-i\">syntax</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526816417264549-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>Python 提供内建函数 <a href=\"https://docs.python.org/2/library/functions.html#__import__\"><strong>__import__</strong></a> 动态加载 module，__import__ 的用法如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c8852682a259331956\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n__import__ (name[, globals[, locals[, fromlist[, level]]]])\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c8852682a259331956-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c8852682a259331956-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c8852682a259331956-1\"><span class=\"crayon-e\">__import__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">globals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">locals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fromlist</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c8852682a259331956-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<ul>\n<li>name (required): 被加载 module 的名称</li>\n<li>globals (optional): 包含全局变量的字典，该选项很少使用，采用默认值 global()</li>\n<li>locals (optional): 包含局部变量的字典，内部标准实现未用到该变量，采用默认值 local()</li>\n<li>fromlist (Optional): 被导入的 submodule 名称</li>\n<li>level (Optional): 导入路径选项，默认为 -1，表示同时支持 absolute import 和 relative import</li>\n</ul>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c8852682e739555337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; os_module = __import__('os')\r\n&gt;&gt;&gt; print os_module.path\r\n&lt;module 'posixpath' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/posixpath.pyc'&gt;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c8852682e739555337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c8852682e739555337-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c8852682e739555337-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c8852682e739555337-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c8852682e739555337-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os_module</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__import__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'os'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c8852682e739555337-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">os_module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span></div><div class=\"crayon-line\" id=\"crayon-58e2c8852682e739555337-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'posixpath'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/posixpath.pyc'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c8852682e739555337-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>事实上，import 本质上是调用 __import__ 加载 module 的，比如：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c88526831326653586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport foo\r\n\r\n最终调用如下函数实现\r\n\r\nfoo = __import__('foo', globals(), locals(), [], -1)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c88526831326653586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526831326653586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526831326653586-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526831326653586-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526831326653586-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526831326653586-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c88526831326653586-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-i\">foo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526831326653586-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c88526831326653586-3\">最终调用如下函数实现</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526831326653586-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c88526831326653586-5\"><span class=\"crayon-v\">foo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__import__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'foo'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526831326653586-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>但如果使用不善，也容易踩坑：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c88526834833772220\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; __import__(\"os\")\r\n&lt;module 'os' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/os.pyc'&gt;\r\n\r\n&gt;&gt;&gt; __import__(\"os.path\")\r\n&lt;module 'os' from '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/os.pyc'&gt;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c88526834833772220-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526834833772220-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526834833772220-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526834833772220-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526834833772220-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526834833772220-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c88526834833772220-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__import__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"os\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526834833772220-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'os'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/os.pyc'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526834833772220-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526834833772220-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__import__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"os.path\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526834833772220-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'os'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/os.pyc'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526834833772220-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>如果输入的参数如果带有 “.”，采用 __import__ 直接导入 module 容易造成意想不到的结果。 OpenStack 的 <a href=\"https://github.com/openstack/oslo.utils/blob/master/oslo_utils/importutils.py\">oslo.utils</a> 封装了 __import__，支持动态导入 class, object 等。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c88526838688859894\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport sys\r\nimport traceback\r\n\r\n\r\ndef import_class(import_str):\r\n    \"\"\"Returns a class from a string including module and class.\r\n    .. versionadded:: 0.3\r\n    \"\"\"\r\n    mod_str, _sep, class_str = import_str.rpartition('.')\r\n    __import__(mod_str)\r\n    try:\r\n        return getattr(sys.modules[mod_str], class_str)\r\n    except AttributeError:\r\n        raise ImportError('Class %s cannot be found (%s)' %\r\n                          (class_str,\r\n                           traceback.format_exception(*sys.exc_info())))\r\n\r\n\r\ndef import_object(import_str, *args, **kwargs):\r\n    \"\"\"Import a class and return an instance of it.\r\n    .. versionadded:: 0.3\r\n    \"\"\"\r\n    return import_class(import_str)(*args, **kwargs)\r\n\r\n\r\ndef import_module(import_str):\r\n    \"\"\"Import a module.\r\n    .. versionadded:: 0.3\r\n    \"\"\"\r\n    __import__(import_str)\r\n    return sys.modules[import_str]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c88526838688859894-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c88526838688859894-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">traceback</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">import_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Returns a class from a string including module and class.</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-7\"><span class=\"crayon-s\">    .. versionadded:: 0.3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-8\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">mod_str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_sep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rpartition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">__import__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mod_str</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">modules</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mod_str</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_str</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">AttributeError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">ImportError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Class %s cannot be found (%s)'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-15\"><span class=\"crayon-h\">                          </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">class_str</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-16\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">traceback</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format_exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exc_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-18\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-19\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">import_object</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Import a class and return an instance of it.</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-21\"><span class=\"crayon-s\">    .. versionadded:: 0.3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-22\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-24\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-26\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">import_module</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Import a module.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-28\"><span class=\"crayon-s\">    .. versionadded:: 0.3</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-29\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">__import__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c88526838688859894-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">modules</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">import_str</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c88526838688859894-32\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87492\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87492votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87492\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/591d8b55a524f825dd29a22b8df70000.jpg"], "title": "__import__ 与动态加载 python module", "fav_nums": 0}
{"praise_nums": 4, "front_image_path": "full/79b76b01dd1967d5ffea0907a21ce531255d8dde.jpg", "tags": "", "comment_nums": 2, "url_object_id": "58feff08ee866ff09469deda813b025c", "url": "http://python.jobbole.com/87496/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/wireless_com/article/details/60571394\">半吊子全栈工匠</a>   </div><div>\n<h2 id=\"关于词云wordcloud\">关于词云wordcloud</h2>\n<p>什么是词云呢？词云又叫文字云，是对文本数据中出现频率较高的“关键词”在视觉上的突出呈现，形成关键词的渲染形成类似云一样的彩色图片，从而一眼就可以领略文本数据的主要表达意思。</p>\n<p>现在，可以从网络上找到各种各样的词云，下面一图来自沈浩老师的微博：</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/7a8555f13563d11e0ca86ad0e7482440.png\" alt=\"演员词云.png\"></p>\n<p>从百度图片中可以看到更多制作好的词云，例如</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/b88a86883b315eceb525f524650c0668.png\" alt=\"百度词云.png\"></p>\n<h2 id=\"词云制作有很多工具\">词云制作有很多工具…..</h2>\n<p>从技术上来看，词云是一种有趣的数据可视化方法，互联网上有很多的现成的工具：</p>\n<ol>\n<li>Wordle是一个用于从文本生成词云图而提供的游戏工具</li>\n<li>Tagxedo 可以在线制作个性化词云</li>\n<li>Tagul 是一个 Web 服务，同样可以创建华丽的词云</li>\n<li>Tagcrowd 还可以输入web的url，直接生成某个网页的词云</li>\n<li>……</li>\n</ol>\n<h2 id=\"十行代码\">十行代码</h2>\n<p>但是作为一个老码农，还是喜欢自己用代码生成自己的词云，复杂么？需要很长时间么？ 很多文字都介绍过各种的方法，但实际上只需要10行python代码即可。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be66d0812929571682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport matplotlib.pyplot as plt\r\nfrom wordcloud import WordCloud\r\nimport jieba\r\n\r\ntext_from_file_with_apath = open('/Users/hecom/23tips.txt').read()\r\n\r\nwordlist_after_jieba = jieba.cut(text_from_file_with_apath, cut_all = True)\r\nwl_space_split = \" \".join(wordlist_after_jieba)\r\n\r\nmy_wordcloud = WordCloud().generate(wl_space_split)\r\n\r\nplt.imshow(my_wordcloud)\r\nplt.axis(\"off\")\r\nplt.show()\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0812929571682-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0812929571682-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">wordcloud </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">WordCloud</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">jieba</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-5\"><span class=\"crayon-v\">text_from_file_with_apath</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/Users/hecom/23tips.txt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-7\"><span class=\"crayon-v\">wordlist_after_jieba</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cut</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text_from_file_with_apath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cut_all</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-8\"><span class=\"crayon-v\">wl_space_split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wordlist_after_jieba</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-10\"><span class=\"crayon-v\">my_wordcloud</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WordCloud</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">generate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wl_space_split</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-12\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">imshow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">my_wordcloud</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-13\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">axis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"off\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0812929571682-14\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0812929571682-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>如此而已，生成的一个词云是这样的：</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/128c747ef896774316df90f5c8bfd449.png\" alt=\"研发管理词云.png\"></p>\n<p>看一下这10行代码：</p>\n<p>1～3 行分别导入了画图的库，词云生成库和jieba的分词库；</p>\n<p>4 行是读取本地的文件,代码中使用的文本是本公众号中的<a href=\"https://mp.weixin.qq.com/s?__biz=MzAwOTcyNzA0OQ==&amp;mid=2658971169&amp;idx=1&amp;sn=886407a5b5f9d0aa94523c88fc8717cb&amp;chksm=80d33307b7a4ba11d26000994dfbdb3a2e1f9824159a11e5cce9573da93a99689b94d779321d#rd\">《老曹眼中研发管理二三事》</a>。</p>\n<p>5～6 行使用jieba进行分词，并对分词的结果以空格隔开；</p>\n<p>7行对分词后的文本生成词云；</p>\n<p>8～10行用pyplot展示词云图。</p>\n<p>这是我喜欢python的一个原因吧，简洁明快。</p>\n<h2 id=\"执行环境\">执行环境</h2>\n<p>如果这十行代码没有运行起来，需要检查自己的执行环境了。对于完整的开发学习环境，可以参考本公众号<a href=\"https://mp.weixin.qq.com/s?__biz=MzAwOTcyNzA0OQ==&amp;mid=2658971039&amp;idx=1&amp;sn=b00d159b1f30ab10893f3448ba3a412f&amp;chksm=80d330b9b7a4b9affde0f6550983ad4ee8c4e021bc33ea0fe03ff0e79599267d5685af9c20dd#rd\">老曹眼中的开发学习环境</a>。<br>\n对于面向python 的数据分析而言，个人喜欢Anaconda，可以去<a href=\"https://www.continuum.io/downloads/\">https://www.continuum.io/downloads/</a> 下载安装，安装成功后的运行界面如下：</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/4f52eb5a25ed1e109ef7a4d8d97799e3.png\" alt=\"anaconda.png\"></p>\n<p>anaconda 是python 数据爱好者的福音。</p>\n<p>安装wordcloud 和 jieba 两个库同样非常简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be66d0821868963249\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install wordcloud\r\npip install jieba\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0821868963249-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0821868963249-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0821868963249-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be66d0821868963249-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">wordcloud</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0821868963249-2\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">jieba</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0821868963249-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>遇到的一个小坑，刚开始运行这十行代码的时候，只显式了若干彩色的小矩形框，中文词语显式不出来，以为是万恶的UTF8问题，debug一下，发现print 结巴分词的结果是可以显示中文的，那就是wordcloud 生成词语的字体库问题了。开源的好处来了，直接进入wordcloud.py 的源码，找字体库相关的代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be66d0829412739415\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFONT_PATH = os.environ.get(\"FONT_PATH\", os.path.join(os.path.dirname(__file__), \"DroidSansMono.ttf\"))\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0829412739415-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0829412739415-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be66d0829412739415-1\"><span class=\"crayon-v\">FONT_PATH</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"FONT_PATH\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dirname</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__file__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"DroidSansMono.ttf\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0829412739415-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>wordcloud 默认使用了DroidSansMono.ttf 字体库，改一下换成一个支持中文的ttf 字库， 重新运行一下这十行代码，就可以了。</p>\n<h2 id=\"看一下源码\">看一下源码</h2>\n<p>既然进入了源码，就会忍不住好奇心，浏览一下wordcloud 的实现过程和方式吧。</p>\n<p>wordcloud.py总共不过600行，其间有着大量的注释，读起来很方便。其中用到了较多的库，常见的random，os，sys，re（正则）和可爱的numpy，还采用了PIL绘图，估计一些人又会遇到安装PIL的那些坑.</p>\n<p>生产词云的原理其实并不复杂，大体分成5步：</p>\n<ol>\n<li>对文本数据进行分词，也是众多NLP文本处理的第一步，对于wordcloud中的process_text（）方法，主要是停词的处理</li>\n<li>计算每个词在文本中出现的频率，生成一个哈希表。词频计算相当于各种分布式计算平台的第一案例wordcount， 和各种语言的hello world 程序具有相同的地位了，呵呵。</li>\n<li>根据词频的数值按比例生成一个图片的布局，类IntegralOccupancyMap 是该词云的算法所在，是词云的数据可视化方式的核心。</li>\n<li>将词按对应的词频在词云布局图上生成图片，核心方法是generate_from_frequencies,不论是generate（）还是generate_from_text（）都最终到generate_from_frequencies</li>\n<li>完成词云上各词的着色,默认是随机着色</li>\n</ol>\n<p>词语的各种增强功能大都可以通过wordcloud的构造函数实现，里面提供了22个参数，还可以自行扩展。</p>\n<h2 id=\"更多的小例子\">更多的小例子</h2>\n<p>看看一个准文言文的词云，本字来自本公众号去年的旧文——<a href=\"https://mp.weixin.qq.com/s?__biz=MzAwOTcyNzA0OQ==&amp;tempkey=fvyv%2FjwflqEEOMJ5SzbIvx4prGrf0hg0ipeIkEn84%2BHjQ8wEpG0s1Dv1%2F6iKWpDQpP6R62J3Qx1IrznyKs7Oq7PDoAfKedp5tBdcz9laa8b4lRgoSDMvJodJCYYfYFAhT0%2FPwEcXqmxmdt9jqqVwpA%3D%3D\">妻</a></p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/c9caca82fd8d6967a23e1ecfea748774.png\" alt=\"wife.png\"></p>\n<p>其中在构造函数中传入了关于大小的几个参数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be66d0832096595432\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwidth=800,height=400,max_font_size=84,min_font_size=16\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0832096595432-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0832096595432-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be66d0832096595432-1\"><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">800</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">max_font_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">84</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">min_font_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0832096595432-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>自惭形秽，根本看不出文言文的色彩和对妻子的感情流露，不是好文字呀！</p>\n<p>矩形的词云太简陋了，直接在图片上用词云来填充就有意思多了，wordcloud中采用的mask方式来实现的。换上一张自己的照片，用<a href=\"https://mp.weixin.qq.com/s?__biz=MzAwOTcyNzA0OQ==&amp;mid=2658971132&amp;idx=1&amp;sn=d1f5848d621ff0c894988665af00b4a2&amp;chksm=80d330dab7a4b9ccec8a514a7a719e4c2907aa3ea318d23b20efa1e7fccd02238e0e99961fa1#rd\">在谈《全栈架构师》</a>中的文字，词云出来的效果是这样的</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/581bb67b779fcbb9b26d03022b84ace3.png\" alt=\"chw_fullstack.png\"></p>\n<p>较难看出肖像的特点了，还好，可以遮丑。其中增加了3行代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be66d0839628051282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom PIL import Image\r\nimport numpy as np\r\nabel_mask = np.array(Image.open(\"/Users/hecom/chw.png\"))\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0839628051282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0839628051282-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be66d0839628051282-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d0839628051282-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be66d0839628051282-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">PIL </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0839628051282-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line\" id=\"crayon-58e2be66d0839628051282-3\"><span class=\"crayon-v\">abel_mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/Users/hecom/chw.png\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d0839628051282-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在构造函数的时候，将mask传递进去即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be66d083f295272523\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbackground_color=\"black\", mask=abel_mask\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be66d083f295272523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be66d083f295272523-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be66d083f295272523-1\"><span class=\"crayon-v\">background_color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"black\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">abel</span><span class=\"crayon-sy\">_</span>mask</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be66d083f295272523-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>自己做的这些词云图片还是太陋，这就是原型简单，好的产品困难呀！做好一个漂亮词云的图片，还是要在诸多细节上下功夫的。</p>\n<p>例如：<br>\n分词的处理，“就是”这样没有意义的词不应该出现在词云里呀？<br>\n所展示关键词的目的性选择？<br>\n如何选择一个合适的字库？<br>\n如何更好地自主着色？<br>\n图片的预处理，如何让图片和词云表达原图片的主要特征？<br>\n……</p>\n<h2 id=\"词云的背后\">词云的背后</h2>\n<p>词云的背后实际上是数据集成处理的典型过程，我们所熟知的6C,如下图：</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/03/cb62da147455c56044ef53a5913fb6a3.png\" alt=\"6C.jpg\"></p>\n<ul>\n<li>Connect: 目标是从各种各样数据源选择数据，数据源会提供APIs,输入格式,数据采集的速率,和提供者的限制.</li>\n<li>Correct: 聚焦于数据转移以便于进一步处理，同时保证维护数据的质量和一致性</li>\n<li>Collect: 数据存储在哪，用什么格式，方便后面阶段的组装和消费</li>\n<li>Compose: 集中关注如何对已采集的各种数据集的混搭, 丰富这些信息能够构建一个引入入胜的数据驱动产品。</li>\n<li>Consume: 关注数据的使用、渲染以及如何使正确的数据在正确的时间达到正确的效果。</li>\n<li>Control: 这是随着数据、组织、参与者的增长，需要的第六个附加步骤，它保证了数据的管控。</li>\n</ul>\n<p>这十行代码构建的词云，没有通过API从公众号(wireless_com)直接获取,简化和抽象是工程化的典型方式，这里至今复制粘贴，甚至省略了correct的过程，直接将数据存储在纯文本文件中，通过jieba分词进行处理即compose，使用词云生成可视化图片用于消费consume，把一个个自己生成的词云组织到不同的文件目录便于检索算是初步的管控control吧。</p>\n<h4 id=\"参考网站\">参考网站</h4>\n<ul>\n<li><a href=\"https://www.continuum.io\">https://www.continuum.io</a></li>\n<li><a href=\"https://github.com/fxsjy/jieba\">https://github.com/fxsjy/jieba</a></li>\n<li><a href=\"https://github.com/amueller/word_cloud\">https://github.com/amueller/word_cloud</a></li>\n</ul>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87496\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87496votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87496\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/7a8555f13563d11e0ca86ad0e7482440.png"], "title": "10行python代码的词云", "fav_nums": 7}
{"praise_nums": 2, "front_image_path": "full/3446026347052b4de8586ad9d163c656c8aa894d.jpg", "tags": "", "comment_nums": 0, "url_object_id": "20217b22a28bbaa5999b1d41c3fa5e45", "url": "http://python.jobbole.com/87498/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000008707682\">goodspeed</a>   </div><h2>引言&amp;动机</h2>\n<p>考虑一下这个场景，我们有10000条数据需要处理，处理每条数据需要花费1秒，但读取数据只需要0.1秒，每条数据互不干扰。该如何执行才能花费时间最短呢？</p>\n<p>在多线程(MT)编程出现之前，电脑程序的运行由一个执行序列组成，执行序列按顺序在主机的中央处理器(CPU)中运行。无论是任务本身要求顺序执行还是整个程序是由多个子任务组成，程序都是按这种方式执行的。即使子任务相互独立，互相无关(即，一个子任务的结果不影响其它子 任务的结果)时也是这样。</p>\n<p>对于上边的问题，如果使用一个执行序列来完成，我们大约需要花费 10000*0.1 + 10000 = 11000 秒。这个时间显然是太长了。<span id=\"pos_placeholder\" style=\"width: 0px;height: 0px;margin: 0px;padding: 0px\"></span></p>\n<p>那我们有没有可能在执行计算的同时取数据呢？或者是同时处理几条数据呢？如果可以，这样就能大幅提高任务的效率。这就是多线程编程的目的。</p>\n<p>对于本质上就是异步的， 需要有多个并发事务，各个事务的运行顺序可以是不确定的，随机的，不可预测的问题，多线程是最理想的解决方案。这样的任务可以被分成多个执行流，每个流都有一个要完成的目标，然后将得到的结果合并，得到最终的结果。</p>\n<h2>线程和进程</h2>\n<h3>什么是进程</h3>\n<p>进程(有时被称为重量级进程)是程序的一次 执行。每个进程都有自己的地址空间，内存，数据栈以及其它记录其运行轨迹的辅助数据。操作系 统管理在其上运行的所有进程，并为这些进程公平地分配时间。进程也可以通过 fork 和 spawn 操作 来完成其它的任务。不过各个进程有自己的内存空间，数据栈等，所以只能使用进程间通讯(IPC)， 而不能直接共享信息。</p>\n<h3>什么是线程</h3>\n<p>线程(有时被称为轻量级进程)跟进程有些相似，不同的是，所有的线程运行在同一个进程中， 共享相同的运行环境。它们可以想像成是在主进程或“主线程”中并行运行的“迷你进程”。</p>\n<p>线程状态如图</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/5254ed26be6e59c98e065bdfe454fb69.png\"></p>\n<p>线程有开始，顺序执行和结束三部分。它有一个自己的指令指针，记录自己运行到什么地方。 线程的运行可能被抢占(中断)，或暂时的被挂起(也叫睡眠)，让其它的线程运行，这叫做让步。 一个进程中的各个线程之间共享同一片数据空间，所以线程之间可以比进程之间更方便地共享数据以及相互通讯。</p>\n<p>当然，这样的共享并不是完全没有危险的。如果多个线程共同访问同一片数据，则由于数据访 问的顺序不一样，有可能导致数据结果的不一致的问题。这叫做竞态条件(race condition)。</p>\n<p>线程一般都是并发执行的，不过在单 CPU 的系统中，真正的并发是不可能的，每个线程会被安排成每次只运行一小会，然后就把 CPU 让出来，让其它的线程去运行。由于有的函数会在完成之前阻塞住，在没有特别为多线程做修改的情 况下，这种“贪婪”的函数会让 CPU 的时间分配有所倾斜。导致各个线程分配到的运行时间可能不 尽相同，不尽公平。</p>\n<h2>Python、线程和全局解释器锁</h2>\n<h3>全局解释器锁(GIL)</h3>\n<p>首先需要明确的一点是GIL并不是Python的特性，它是在实现Python解析器(CPython)时所引入的一个概念。就好比C++是一套语言（语法）标准，但是可以用不同的编译器来编译成可执行代码。同样一段代码可以通过CPython，PyPy，Psyco等不同的Python执行环境来执行（其中的JPython就没有GIL）。</p>\n<p>那么CPython实现中的GIL又是什么呢？GIL全称Global Interpreter Lock为了避免误导，我们还是来看一下官方给出的解释：</p>\n<blockquote><p>In CPython, the global interpreter lock, or GIL, is a mutex that prevents multiple native threads from executing Python bytecodes at once. This lock is necessary mainly because CPython’s memory management is not thread-safe. (However, since the GIL exists, other features have grown to depend on the guarantees that it enforces.)</p></blockquote>\n<p>尽管Python完全支持多线程编程， 但是解释器的C语言实现部分在完全并行执行时并不是线程安全的。 实际上，解释器被一个全局解释器锁保护着，它确保任何时候都只有一个Python线程执行。</p>\n<p>在多线程环境中，Python 虚拟机按以下方式执行:</p>\n<ol>\n<li>设置GIL</li>\n<li>切换到一个线程去执行</li>\n<li>运行\n<ul>\n<li>指定数量的字节码指令</li>\n<li>线程主动让出控制（可以调用time.sleep(0))</li>\n</ul>\n</li>\n<li>把线程设置完睡眠状态</li>\n<li>解锁GIL</li>\n<li>再次重复以上步骤</li>\n</ol>\n<blockquote><p>对所有面向 I/O 的(会调用内建的操作系统 C 代码的)程序来说，GIL 会在这个 I/O 调用之 前被释放，以允许其它的线程在这个线程等待 I/O 的时候运行。如果某线程并未使用很多 I/O 操作， 它会在自己的时间片内一直占用处理器(和 GIL)。也就是说，I/O 密集型的 Python 程序比计算密集 型的程序更能充分利用多线程环境的好处。</p></blockquote>\n<h3>退出线程</h3>\n<p>当一个线程结束计算，它就退出了。线程可以调用 thread.exit()之类的退出函数，也可以使用 Python 退出进程的标准方法，如 sys.exit()或抛出一个 SystemExit 异常等。不过，你不可以直接 “杀掉”(“kill”)一个线程。</p>\n<h3>在 Python 中使用线程</h3>\n<p>在 Win32 和 Linux, Solaris, MacOS, *BSD 等大多数类 Unix 系统上运行时，Python 支持多线程 编程。Python 使用 POSIX 兼容的线程，即 pthreads。</p>\n<p>默认情况下，只要在解释器中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c10166986650\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt; import thread</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c10166986650-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c10166986650-1\"><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">thread</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果没有报错，则说明线程可用。</p>\n<h3>Python 的 threading 模块</h3>\n<p>Python 供了几个用于多线程编程的模块，包括 thread, threading 和 Queue 等。thread 和 threading 模块允许程序员创建和管理线程。thread 模块 供了基本的线程和锁的支持，而 threading 供了更高级别，功能更强的线程管理的功能。Queue 模块允许用户创建一个可以用于多个线程之间 共享数据的队列数据结构。</p>\n<h5>核心 示:避免使用 thread 模块</h5>\n<p>出于以下几点考虑，我们不建议您使用 thread 模块。</p>\n<ol>\n<li>更高级别的 threading 模块更为先 进，对线程的支持更为完善，而且使用 thread 模块里的属性有可能会与 threading 出现冲突。其次， 低级别的 thread 模块的同步原语很少(实际上只有一个)，而 threading 模块则有很多。</li>\n<li>对于你的进程什么时候应该结束完全没有控制，当主线程结束 时，所有的线程都会被强制结束掉，没有警告也不会有正常的清除工作。我们之前说过，至少 threading 模块能确保重要的子线程退出后进程才退出。</li>\n</ol>\n<h2>thread 模块</h2>\n<p>除了产生线程外，thread 模块也提供了基本的同步数 据结构锁对象(lock object，也叫原语锁，简单锁，互斥锁，互斥量，二值信号量)。</p>\n<p>thread 模块函数</p>\n<ul>\n<li>start_new_thread(function, args, kwargs=None)：产生一个新的线程，在新线程中用指定的参数和可选的 kwargs 来调用这个函数。</li>\n<li>allocate_lock()：分配一个 LockType 类型的锁对象</li>\n<li>exit()：让线程退出</li>\n<li>acquire(wait=None)：尝试获取锁对象</li>\n<li>locked()：如果获取了锁对象返回 True，否则返回 False</li>\n<li>release()：释放锁</li>\n</ul>\n<p>下面是一个使用 thread 的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c1b483645792\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport thread\r\nfrom time import sleep, time\r\n\r\n\r\ndef loop(num):\r\n    print('start loop at:', time())\r\n    sleep(num)\r\n    print('loop done at:', time())\r\n\r\n\r\ndef loop1(num):\r\n    print('start loop 1 at:', time())\r\n    sleep(num)\r\n    print('loop 1 done at:', time())\r\n\r\n\r\ndef main():\r\n    print('starting at:', time())\r\n    thread.start_new_thread(loop, (4,))\r\n    thread.start_new_thread(loop1, (5,))\r\n    sleep(6)\r\n    print('all DONE at:', time())\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n\r\n('starting at:', 1489387024.886667)\r\n('start loop at:', 1489387024.88705)\r\n('start loop 1 at:', 1489387024.887277)\r\n('loop done at:', 1489387028.888182)\r\n('loop 1 done at:', 1489387029.888904)\r\n('all DONE at:', 1489387030.889918)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1b483645792-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1b483645792-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop done at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-11\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loop1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop 1 at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop 1 done at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-16\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-17\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_new_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_new_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'all DONE at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-24\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-26\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-27\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1489387024.886667</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-28\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1489387024.88705</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-29\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop 1 at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1489387024.887277</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-30\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop done at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1489387028.888182</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1b483645792-31\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop 1 done at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1489387029.888904</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1b483645792-32\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'all DONE at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1489387030.889918</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>start_new_thread()要求一定要有前两个参数。所以，就算我们想要运行的函数不要参数，也要传一个空的元组。<br>\n为什么要加上sleep(6)这一句呢? 因为，如果我们没有让主线程停下来，那主线程就会运行下一条语句，显示 “all done”，然后就关闭运行着 loop()和 loop1()的两个线程，退出了。</p>\n<p>我们有没有更好的办法替换使用sleep() 这种不靠谱的同步方式呢？答案是使用锁，使用了锁，我们就可以在两个线程都退出之后马上退出。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c1f449024728\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#! -*- coding: utf-8 -*-\r\n\r\nimport thread\r\nfrom time import sleep, time\r\n\r\nloops = [4, 2]\r\n\r\ndef loop(nloop, nsec, lock):\r\n    print('start loop %s at: %s' % (nloop, time()))\r\n    sleep(nsec)\r\n    print('loop %s done at: %s' % (nloop, time()))\r\n    # 每个线程都会被分配一个事先已经获得的锁，在 sleep()的时间到了之后就释放 相应的锁以通知主线程，这个线程已经结束了。\r\n    lock.release()\r\n\r\n\r\ndef main():\r\n    print('starting at:', time())\r\n    locks = []\r\n    nloops = range(len(loops))\r\n\r\n    for i in nloops:\r\n        # 调用 thread.allocate_lock()函数创建一个锁的列表\r\n        lock = thread.allocate_lock()\r\n        # 分别调用各个锁的 acquire()函数获得, 获得锁表示“把锁锁上”\r\n        lock.acquire()\r\n        locks.append(lock)\r\n\r\n    for i in nloops:\r\n        # 创建线程，每个线程都用各自的循环号，睡眠时间和锁为参数去调用 loop()函数\r\n        thread.start_new_thread(loop, (i, loops[i], locks[i]))\r\n\r\n    for i in nloops:\r\n        # 在线程结束的时候，线程要自己去做解锁操作\r\n        # 当前循环只是坐在那一直等(达到暂停主 线程的目的)，直到两个锁都被解锁为止才继续运行。\r\n        while locks[i].locked(): pass\r\n\r\n    print('all DONE at:', time())\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c1f449024728-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c1f449024728-41\">41</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-1\"><span class=\"crayon-p\">#! -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-4\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-6\"><span class=\"crayon-v\">loops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-8\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop %s at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop %s done at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 每个线程都会被分配一个事先已经获得的锁，在 sleep()的时间到了之后就释放 相应的锁以通知主线程，这个线程已经结束了。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-14\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-16\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">locks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-20\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 调用 thread.allocate_lock()函数创建一个锁的列表</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allocate_lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 分别调用各个锁的 acquire()函数获得, 获得锁表示“把锁锁上”</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">locks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 创建线程，每个线程都用各自的循环号，睡眠时间和锁为参数去调用 loop()函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_new_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">locks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 在线程结束的时候，线程要自己去做解锁操作</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 当前循环只是坐在那一直等(达到暂停主 线程的目的)，直到两个锁都被解锁为止才继续运行。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">locks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">locked</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-36\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-37\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'all DONE at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-38\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-39\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c1f449024728-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c1f449024728-41\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p>为什么我们不在创建锁的循环里创建线程呢?有以下几个原因:</p>\n<ol>\n<li>我们想到实现线程的同步，所以要让“所有的马同时冲出栅栏”。</li>\n<li>获取锁要花一些时间，如果你的 线程退出得“太快”，可能会导致还没有获得锁，线程就已经结束了的情况。</li>\n</ol>\n<h2>threading 模块</h2>\n<p>threading 模块不仅提供了 Thread 类，还 供了各 种非常好用的同步机制。</p>\n<p>下面是threading 模块里所有的对象：</p>\n<ol>\n<li>Thread： 表示一个线程的执行的对象</li>\n<li>Lock： 锁原语对象(跟 thread 模块里的锁对象相同)</li>\n<li>RLock： 可重入锁对象。使单线程可以再次获得已经获得了的锁(递归锁定)。</li>\n<li>Condition： 条件变量对象能让一个线程停下来，等待其它线程满足了某个“条件”。 如，状态的改变或值的改变。</li>\n<li>Event： 通用的条件变量。多个线程可以等待某个事件的发生，在事件发生后， 所有的线程都会被激活。</li>\n<li>Semaphore： 为等待锁的线程 供一个类似“等候室”的结构</li>\n<li>BoundedSemaphore： 与 Semaphore 类似，只是它不允许超过初始值</li>\n<li>Timer： 与 Thread 相似，只是，它要等待一段时间后才开始运行。</li>\n</ol>\n<h5>守护线程</h5>\n<p>另一个避免使用 thread 模块的原因是，它不支持守护线程。当主线程退出时，所有的子线程不 论它们是否还在工作，都会被强行退出。有时，我们并不期望这种行为，这时，就引入了守护线程 的概念<br>\nthreading 模块支持守护线程，它们是这样工作的:守护线程一般是一个等待客户请求的服务器， 如果没有客户 出请求，它就在那等着。如果你设定一个线程为守护线程，就表示你在说这个线程 是不重要的，在进程退出的时候，不用等待这个线程退出。<br>\n如果你的主线程要退出的时候，不用等待那些子线程完成，那就设定这些线程的 daemon 属性。 即，在线程开始(调用 thread.start())之前，调用 setDaemon()函数设定线程的 daemon 标志 (thread.setDaemon(True))就表示这个线程“不重要”<br>\n如果你想要等待子线程完成再退出，那就什么都不用做，或者显式地调用 thread.setDaemon(False)以保证其 daemon 标志为 False。你可以调用 thread.isDaemon()函数来判 断其 daemon 标志的值。新的子线程会继承其父线程的 daemon 标志。整个 Python 会在所有的非守护 线程退出后才会结束,即进程中没有非守护线程存在的时候才结束。</p>\n<h3>Thread 类</h3>\n<p>Thread类提供了以下方法:</p>\n<ul>\n<li>run(): 用以表示线程活动的方法。</li>\n<li>start():启动线程活动。</li>\n<li>join([time]): 等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。</li>\n<li>is_alive(): 返回线程是否活动的。</li>\n<li>name(): 设置/返回线程名。</li>\n<li>daemon(): 返回/设置线程的 daemon 标志，一定要在调用 start()函数前设置</li>\n</ul>\n<p>用 Thread 类，你可以用多种方法来创建线程。我们在这里介绍三种比较相像的方法。</p>\n<ul>\n<li>创建一个Thread的实例，传给它一个函数</li>\n<li>创建一个Thread的实例，传给它一个可调用的类对象</li>\n<li>从Thread派生出一个子类，创建一个这个子类的实例</li>\n</ul>\n<p>下边是三种不同方式的创建线程的示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c26239278650\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#! -*- coding: utf-8 -*-\r\n\r\n# 创建一个Thread的实例，传给它一个函数\r\n\r\nimport threading\r\nfrom time import sleep, time\r\n\r\nloops = [4, 2]\r\n\r\ndef loop(nloop, nsec, lock):\r\n    print('start loop %s at: %s' % (nloop, time()))\r\n    sleep(nsec)\r\n    print('loop %s done at: %s' % (nloop, time()))\r\n    # 每个线程都会被分配一个事先已经获得的锁，在 sleep()的时间到了之后就释放 相应的锁以通知主线程，这个线程已经结束了。\r\n\r\n\r\ndef main():\r\n    print('starting at:', time())\r\n    threads = []\r\n    nloops = range(len(loops))\r\n\r\n    for i in nloops:\r\n        t = threading.Thread(target=loop, args=(i, loops[i]))\r\n        threads.append(t)\r\n\r\n    for i in nloops:\r\n        # start threads\r\n        threads[i].start()\r\n\r\n    for i in nloops:\r\n        # wait for all\r\n        # join()会等到线程结束，或者在给了 timeout 参数的时候，等到超时为止。\r\n        # 使用 join()看上去 会比使用一个等待锁释放的无限循环清楚一些(这种锁也被称为\"spinlock\")\r\n        threads[i].join()  # threads to finish\r\n\r\n    print('all DONE at:', time())\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c26239278650-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c26239278650-39\">39</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-1\"><span class=\"crayon-p\">#! -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-3\"><span class=\"crayon-p\"># 创建一个Thread的实例，传给它一个函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">threading</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-6\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-8\"><span class=\"crayon-v\">loops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop %s at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop %s done at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 每个线程都会被分配一个事先已经获得的锁，在 sleep()的时间到了之后就释放 相应的锁以通知主线程，这个线程已经结束了。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-16\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-17\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># start threads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># wait for all</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># join()会等到线程结束，或者在给了 timeout 参数的时候，等到超时为止。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 使用 join()看上去 会比使用一个等待锁释放的无限循环清楚一些(这种锁也被称为\"spinlock\")</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># threads to finish</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'all DONE at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c26239278650-38\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c26239278650-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>与传一个函数很相似的另一个方法是在创建线程的时候，传一个可调用的类的实例供线程启动 的时候执行——这是多线程编程的一个更为面向对象的方法。相对于一个或几个函数来说，由于类 对象里可以使用类的强大的功能，可以保存更多的信息，这种方法更为灵活</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c2b609848156\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#! -*- coding: utf-8 -*-\r\n\r\n# 创建一个 Thread 的实例，传给它一个可调用的类对象\r\n\r\nfrom threading import Thread\r\nfrom time import sleep, time\r\n\r\n\r\nloops = [4, 2]\r\n\r\n\r\nclass ThreadFunc(object):\r\n\r\n    def __init__(self, func, args, name=\"\"):\r\n        self.name = name\r\n        self.func = func\r\n        self.args = args\r\n\r\n    def __call__(self):\r\n        # 创建新线程的时候，Thread 对象会调用我们的 ThreadFunc 对象，这时会用到一个特殊函数 __call__()。\r\n        self.func(*self.args)\r\n\r\n\r\ndef loop(nloop, nsec):\r\n    print('start loop %s at: %s' % (nloop, time()))\r\n    sleep(nsec)\r\n    print('loop %s done at: %s' % (nloop, time()))\r\n\r\n\r\ndef main():\r\n    print('starting at:', time())\r\n    threads = []\r\n    nloops = range(len(loops))\r\n\r\n    for i in nloops:\r\n        t = Thread(target=ThreadFunc(loop, (i, loops[i]), loop.__name__))\r\n        threads.append(t)\r\n\r\n    for i in nloops:\r\n        # start threads\r\n        threads[i].start()\r\n\r\n    for i in nloops:\r\n        # wait for all\r\n        # join()会等到线程结束，或者在给了 timeout 参数的时候，等到超时为止。\r\n        # 使用 join()看上去 会比使用一个等待锁释放的无限循环清楚一些(这种锁也被称为\"spinlock\")\r\n        threads[i].join()  # threads to finish\r\n\r\n    print('all DONE at:', time())\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2b609848156-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2b609848156-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-1\"><span class=\"crayon-p\">#! -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-3\"><span class=\"crayon-p\"># 创建一个 Thread 的实例，传给它一个可调用的类对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-5\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">threading </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-6\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-9\"><span class=\"crayon-v\">loops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-12\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ThreadFunc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-16\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-17\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-18\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-19\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 创建新线程的时候，Thread 对象会调用我们的 ThreadFunc 对象，这时会用到一个特殊函数 __call__()。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-22\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-24\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop %s at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop %s done at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-28\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-30\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-34\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">ThreadFunc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-38\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># start threads</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-42\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># wait for all</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># join()会等到线程结束，或者在给了 timeout 参数的时候，等到超时为止。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 使用 join()看上去 会比使用一个等待锁释放的无限循环清楚一些(这种锁也被称为\"spinlock\")</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># threads to finish</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-48\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'all DONE at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-50\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-52\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2b609848156-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2b609848156-54\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>最后一个例子介绍如何子类化 Thread 类，这与上一个例子中的创建一个可调用的类非常像。使 用子类化创建线程(第 29-30 行)使代码看上去更清晰明了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c2f183610245\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#! -*- coding: utf-8 -*-\r\n\r\n# 创建一个 Thread 的实例，传给它一个可调用的类对象\r\n\r\nfrom threading import Thread\r\nfrom time import sleep, time\r\n\r\n\r\nloops = [4, 2]\r\n\r\n\r\nclass MyThread(Thread):\r\n\r\n    def __init__(self, func, args, name=\"\"):\r\n        super(MyThread, self).__init__()\r\n        self.name = name\r\n        self.func = func\r\n        self.args = args\r\n\r\n    def getResult(self):\r\n        return self.res\r\n\r\n    def run(self):\r\n        # 创建新线程的时候，Thread 对象会调用我们的 ThreadFunc 对象，这时会用到一个特殊函数 __call__()。\r\n        print 'starting', self.name, 'at:', time()\r\n        self.res = self.func(*self.args)\r\n        print self.name, 'finished at:', time()\r\n\r\n\r\n\r\ndef loop(nloop, nsec):\r\n    print('start loop %s at: %s' % (nloop, time()))\r\n    sleep(nsec)\r\n    print('loop %s done at: %s' % (nloop, time()))\r\n\r\n\r\ndef main():\r\n    print('starting at:', time())\r\n    threads = []\r\n    nloops = range(len(loops))\r\n\r\n    for i in nloops:\r\n        t = MyThread(loop, (i, loops[i]), loop.__name__)\r\n        threads.append(t)\r\n\r\n    for i in nloops:\r\n        # start threads\r\n        threads[i].start()\r\n\r\n    for i in nloops:\r\n        # wait for all\r\n        # join()会等到线程结束，或者在给了 timeout 参数的时候，等到超时为止。\r\n        # 使用 join()看上去 会比使用一个等待锁释放的无限循环清楚一些(这种锁也被称为\"spinlock\")\r\n        threads[i].join()  # threads to finish\r\n\r\n    print('all DONE at:', time())\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c2f183610245-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c2f183610245-61\">61</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-1\"><span class=\"crayon-p\">#! -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-3\"><span class=\"crayon-p\"># 创建一个 Thread 的实例，传给它一个可调用的类对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-5\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">threading </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-6\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-9\"><span class=\"crayon-v\">loops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-12\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-17\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-20\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-22\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-23\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 创建新线程的时候，Thread 对象会调用我们的 ThreadFunc 对象，这时会用到一个特殊函数 __call__()。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'starting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'finished at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-28\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-30\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-31\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'start loop %s at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nsec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loop %s done at: %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nloop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-36\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-37\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># start threads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># wait for all</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># join()会等到线程结束，或者在给了 timeout 参数的时候，等到超时为止。</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 使用 join()看上去 会比使用一个等待锁释放的无限循环清楚一些(这种锁也被称为\"spinlock\")</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># threads to finish</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-55\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'all DONE at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-58\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-59\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c2f183610245-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c2f183610245-61\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0069 seconds] -->\r\n<p>除了各种同步对象和线程对象外，threading 模块还 供了一些函数。</p>\n<ul>\n<li>active_count(): 当前活动的线程对象的数量</li>\n<li>current_thread(): 返回当前线程对象</li>\n<li>enumerate(): 返回当前活动线程的列表</li>\n<li>settrace(func): 为所有线程设置一个跟踪函数</li>\n<li>setprofile(func): 为所有线程设置一个 profile 函数</li>\n</ul>\n<h3>Lock &amp; RLock</h3>\n<p>原语锁定是一个同步原语，状态是锁定或未锁定。两个方法acquire()和release() 用于加锁和释放锁。<br>\nRLock 可重入锁是一个类似于Lock对象的同步原语，但同一个线程可以多次调用。</p>\n<p>Lock 不支持递归加锁，也就是说即便在同 线程中，也必须等待锁释放。通常建议改 RLock， 它会处理 “owning thread” 和 “recursion level” 状态，对于同 线程的多次请求锁 为，只累加<br>\n计数器。每次调 release() 将递减该计数器，直到 0 时释放锁，因此 acquire() 和 release() 必须 要成对出现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c34842547529\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nfrom time import sleep\r\nfrom threading import current_thread, Thread\r\n\r\nlock = Rlock()\r\n\r\ndef show():\r\n    with lock:\r\n        print current_thread().name, i\r\n        sleep(0.1)\r\n\r\ndef test():\r\n    with lock:\r\n        for i in range(3):\r\n            show(i)\r\n\r\nfor i in range(2):\r\n    Thread(target=test).start()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c34842547529-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c34842547529-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">sleep</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">threading </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">current_thread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-5\"><span class=\"crayon-v\">lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Rlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">lock</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">current_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-12\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">lock</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-16\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c34842547529-17\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c34842547529-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h3>Event</h3>\n<p>事件用于在线程间通信。一个线程发出一个信号，其他一个或多个线程等待。<br>\nEvent 通过通过 个内部标记来协调多线程运 。 法 wait() 阻塞线程执 ，直到标记为 True。 set() 将标记设为 True，clear() 更改标记为 False。isSet() 用于判断标记状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c38681892363\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom threading import Event\r\n\r\ndef test_event():\r\n    e = Event()\r\n    def test():\r\n        for i in range(5):\r\n            print 'start wait'\r\n            e.wait()\r\n            e.clear()  # 如果不调用clear()，那么标记一直为 True，wait()就不会发生阻塞行为\r\n            print i\r\nThread(target=test).start()\r\nreturn e\r\n\r\n\r\ne = test_event()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c38681892363-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c38681892363-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">threading </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">test_event</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Event</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'start wait'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 如果不调用clear()，那么标记一直为 True，wait()就不会发生阻塞行为</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-11\"><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-12\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c38681892363-14\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c38681892363-15\"><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test_event</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3>Condition</h3>\n<p>条件变量和 Lock 参数一样，也是一个，也是一个同步原语，当需要线程关注特定的状态变化或事件的发生时使用这个锁定。</p>\n<p>可以认为，除了Lock带有的锁定池外，Condition还包含一个等待池，池中的线程处于状态图中的等待阻塞状态，直到另一个线程调用notify()/notifyAll()通知；得到通知后线程进入锁定池等待锁定。</p>\n<p>构造方法：<br>\nCondition([lock/rlock])</p>\n<p>Condition 有以下这些方法：</p>\n<ul>\n<li>acquire([timeout])/release(): 调用关联的锁的相应方法。</li>\n<li>wait([timeout]): 调用这个方法将使线程进入Condition的等待池等待通知，并释放锁。使用前线程必须已获得锁定，否则将抛出异常。</li>\n<li>notify(): 调用这个方法将从等待池挑选一个线程并通知，收到通知的线程将自动调用acquire()尝试获得锁定（进入锁定池）；其他线程仍然在等待池中。调用这个方法不会释放锁定。使用前线程必须已获得锁定，否则将抛出异常。</li>\n<li>notifyAll(): 调用这个方法将通知等待池中所有的线程，这些线程都将进入锁定池尝试获得锁定。调用这个方法不会释放锁定。使用前线程必须已获得锁定，否则将抛出异常。</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c4e148816421\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom threading import Condition, current_thread, Thread\r\n\r\ncon = Condition()\r\n\r\ndef tc1():\r\n    with con:\r\n        for i in range(5):\r\n            print current_thread().name, i\r\n            sleep(0.3)\r\n            if i == 3:\r\n                con.wait()\r\n\r\n\r\ndef tc2():\r\n    with con:\r\n        for i in range(5):\r\n            print current_thread().name, i\r\n            sleep(0.1)\r\n            con.notify()\r\n\r\nThread(target=tc1).start()\r\nThread(target=tc2).start()\r\n\r\nThread-1 0\r\nThread-1 1\r\nThread-1 2\r\nThread-1 3    # 让出锁\r\nThread-2 0\r\nThread-2 1\r\nThread-2 2\r\nThread-2 3\r\nThread-2 4\r\nThread-1 4    # 重新获取锁，继续执\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c4e148816421-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c4e148816421-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">threading </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">Condition</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">current_thread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-3\"><span class=\"crayon-v\">con</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Condition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">tc1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">con</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">current_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">con</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-12\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-14\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">tc2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">con</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">current_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">con</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-20\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-21\"><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tc1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-22\"><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tc2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-24\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-25\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-26\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-27\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 让出锁</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-28\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-29\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-30\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-31\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-32\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c4e148816421-33\"><span class=\"crayon-v\">Thread</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 重新获取锁，继续执</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c4e148816421-34\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>只有获取锁的线程才能调用 wait() 和 notify()，因此必须在锁释放前调用。<br>\n当 wait() 释放锁后，其他线程也可进入 wait 状态。notifyAll() 激活所有等待线程，让它们去抢锁然后完成后续执行。</p>\n<h3>生产者-消费者问题和 Queue 模块</h3>\n<p>现在我们用一个经典的(生产者消费者)例子来介绍一下 Queue模块。</p>\n<p>生产者消费者的场景是： 生产者生产货物，然后把货物放到一个队列之类的数据结构中，生产货物所要花费的时间无法预先确定。消费者消耗生产者生产的货物的时间也是不确定的。</p>\n<p>常用的 Queue 模块的属性:</p>\n<ul>\n<li>queue(size): 创建一个大小为size的Queue对象。</li>\n<li>qsize(): 返回队列的大小(由于在返回的时候，队列可能会被其它线程修改，所以这个值是近似值)</li>\n<li>empty(): 如果队列为空返回 True，否则返回 False</li>\n<li>full(): 如果队列已满返回 True，否则返回 False</li>\n<li>put(item,block=0): 把item放到队列中，如果给了block(不为0)，函数会一直阻塞到队列中有空间为止</li>\n<li>get(block=0): 从队列中取一个对象，如果给了 block(不为 0)，函数会一直阻塞到队列中有对象为止</li>\n</ul>\n<p>Queue 模块可以用来进行线程间通讯，让各个线程之间共享数据。</p>\n<p>现在，我们创建一个队列，让 生产者(线程)把新生产的货物放进去供消费者(线程)使用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c53249053089\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#! -*- coding: utf-8 -*-\r\n\r\nfrom Queue import Queue\r\nfrom random import randint\r\nfrom time import sleep, time\r\nfrom threading import Thread\r\n\r\n\r\nclass MyThread(Thread):\r\n\r\n    def __init__(self, func, args, name=\"\"):\r\n        super(MyThread, self).__init__()\r\n        self.name = name\r\n        self.func = func\r\n        self.args = args\r\n\r\n    def getResult(self):\r\n        return self.res\r\n\r\n    def run(self):\r\n        # 创建新线程的时候，Thread 对象会调用我们的 ThreadFunc 对象，这时会用到一个特殊函数 __call__()。\r\n        print 'starting', self.name, 'at:', time()\r\n        self.res = self.func(*self.args)\r\n        print self.name, 'finished at:', time()\r\n\r\n\r\n# writeQ()和 readQ()函数分别用来把对象放入队列和消耗队列中的一个对象。在这里我们使用 字符串'xxx'来表示队列中的对象。\r\ndef writeQ(queue):\r\n    print 'producing object for Q...'\r\n    queue.put('xxx', 1)\r\n    print \"size now\", queue.qsize()\r\n\r\n\r\ndef readQ(queue):\r\n    queue.get(1)\r\n    print(\"consumed object from Q... size now\", queue.qsize())\r\n\r\n\r\ndef writer(queue, loops):\r\n    # writer()函数只做一件事，就是一次往队列中放入一个对象，等待一会，然后再做同样的事\r\n    for i in range(loops):\r\n        writeQ(queue)\r\n        sleep(1)\r\n\r\n\r\ndef reader(queue, loops):\r\n    # reader()函数只做一件事，就是一次从队列中取出一个对象，等待一会，然后再做同样的事\r\n    for i in range(loops):\r\n        readQ(queue)\r\n        sleep(randint(2, 5))\r\n\r\n\r\n# 设置有多少个线程要被运行\r\nfuncs = [writer, reader]\r\nnfuncs = range(len(funcs))\r\n\r\n\r\ndef main():\r\n    nloops = randint(10, 20)\r\n    q = Queue(32)\r\n    threads = []\r\n\r\n    for i in nfuncs:\r\n        t = MyThread(funcs[i], (q, nloops), funcs[i].__name__)\r\n        threads.append(t)\r\n\r\n    for i in nfuncs:\r\n        threads[i].start()\r\n\r\n    for i in nfuncs:\r\n        threads[i].join()\r\n        print threads[i].getResult()\r\n\r\n    print 'all DONE'\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c53249053089-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c53249053089-79\">79</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-1\"><span class=\"crayon-p\">#! -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">Queue </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-4\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">random </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">randint</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-5\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-6\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">threading </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Thread</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-14\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-15\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-16\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-17\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-20\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 创建新线程的时候，Thread 对象会调用我们的 ThreadFunc 对象，这时会用到一个特殊函数 __call__()。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'starting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'finished at:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-26\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-27\"><span class=\"crayon-p\"># writeQ()和 readQ()函数分别用来把对象放入队列和消耗队列中的一个对象。在这里我们使用 字符串'xxx'来表示队列中的对象。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-28\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">writeQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'producing object for Q...'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'xxx'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"size now\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">qsize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-32\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-34\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">readQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"consumed object from Q... size now\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">qsize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-38\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-39\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">writer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># writer()函数只做一件事，就是一次往队列中放入一个对象，等待一会，然后再做同样的事</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">writeQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-44\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-46\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">reader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># reader()函数只做一件事，就是一次从队列中取出一个对象，等待一会，然后再做同样的事</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">readQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">randint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-52\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-53\"><span class=\"crayon-p\"># 设置有多少个线程要被运行</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-54\"><span class=\"crayon-v\">funcs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">writer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-55\"><span class=\"crayon-v\">nfuncs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">funcs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-56\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-58\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">randint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-62\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nfuncs</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">funcs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nloops</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funcs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-66\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nfuncs</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nfuncs</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'all DONE'</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-76\"> </div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-77\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c53249053089-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c53249053089-79\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0087 seconds] -->\r\n<p></p>\n<h3>FAQ</h3>\n<h5>进程与线程。线程与进程的区别是什么?</h5>\n<p>进程(有时被称为重量级进程)是程序的一次 执行。每个进程都有自己的地址空间，内存，数据栈以及其它记录其运行轨迹的辅助数据。<br>\n线程(有时被称为轻量级进程)跟进程有些相似，不同的是，所有的线程运行在同一个进程中， 共享相同的运行环境。它们可以想像成是在主进程或“主线程”中并行运行的“迷你进程”。</p>\n<p>这篇文章很好的解释了 线程和进程的区别，推荐阅读: <a href=\"http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html\">http://www.ruanyifeng.com/blo…</a></p>\n<h5>Python 的线程。在 Python 中，哪一种多线程的程序表现得更好，I/O 密集型的还是计算 密集型的?</h5>\n<p>由于GIL的缘故，对所有面向 I/O 的(会调用内建的操作系统 C 代码的)程序来说，GIL 会在这个 I/O 调用之 前被释放，以允许其它的线程在这个线程等待 I/O 的时候运行。如果某线程并未使用很多 I/O 操作， 它会在自己的时间片内一直占用处理器(和 GIL)。也就是说，I/O 密集型的 Python 程序比计算密集 型的程序更能充分利用多线程环境的好处。</p>\n<h5>线程。你认为，多 CPU 的系统与一般的系统有什么大的不同?多线程的程序在这种系统上的表现会怎么样?</h5>\n<p>Python的线程就是C语言的一个pthread，并通过操作系统调度算法进行调度（例如linux是CFS）。为了让各个线程能够平均利用CPU时间，python会计算当前已执行的微代码数量，达到一定阈值后就强制释放GIL。而这时也会触发一次操作系统的线程调度（当然是否真正进行上下文切换由操作系统自主决定）。<br>\n伪代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2da88f3c59921470230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhile True:\r\n    acquire GIL\r\n    for i in 1000:\r\n        do something\r\n    release GIL\r\n    /* Give Operating System a chance to do thread scheduling */</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c59921470230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c59921470230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c59921470230-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c59921470230-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2da88f3c59921470230-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2da88f3c59921470230-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2da88f3c59921470230-1\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c59921470230-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">acquire </span><span class=\"crayon-e\">GIL</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c59921470230-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c59921470230-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">something</span></div><div class=\"crayon-line\" id=\"crayon-58e2da88f3c59921470230-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">release </span><span class=\"crayon-v\">GIL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2da88f3c59921470230-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Give Operating System a chance to do thread scheduling */</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>这种模式在只有一个CPU核心的情况下毫无问题。任何一个线程被唤起时都能成功获得到GIL（因为只有释放了GIL才会引发线程调度）。<br>\n但当CPU有多个核心的时候，问题就来了。从伪代码可以看到，从release GIL到acquire GIL之间几乎是没有间隙的。所以当其他在其他核心上的线程被唤醒时，大部分情况下主线程已经又再一次获取到GIL了。这个时候被唤醒执行的线程只能白白的浪费CPU时间，看着另一个线程拿着GIL欢快的执行着。然后达到切换时间后进入待调度状态，再被唤醒，再等待，以此往复恶性循环。<br>\n简单的总结下就是：Python的多线程在多核CPU上，只对于IO密集型计算产生正面效果；而当有至少有一个CPU密集型线程存在，那么多线程效率会由于GIL而大幅下降。</p>\n<h5>线程池。修改 生成者消费者 的代码，不再是一个生产者和一个消费者，而是可以有任意个 消费者线程(一个线程池)，每个线程可以在任意时刻处理或消耗任意多个产品。</h5>\n<h2>参考文章</h2>\n<ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html\">进程与线程的一个简单解释</a></li>\n<li><a href=\"http://cenalulu.github.io/python/gil-in-python/\">Python的GIL是什么鬼，多线程性能究竟如何</a></li>\n<li><a href=\"http://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html\">Python的全局锁问题</a></li>\n<li><a href=\"http://www.cnblogs.com/huxi/archive/2010/06/26/1765808.html\">Python线程指南</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87498\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87498votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87498\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 13 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/3cccc8c943fe706b4be2fc3d02ba4a1e.jpg"], "title": "python线程笔记", "fav_nums": 13}
{"praise_nums": 2, "front_image_path": "full/ff4209c1b8729206983bfaef669359d375939301.jpg", "tags": "", "comment_nums": 2, "url_object_id": "dc24893b0670fa8d24fe348bde421217", "url": "http://python.jobbole.com/87509/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.duanshishi.com/?p=1753\">小石头（@小石头_sh ）</a>   </div><h2>Goal</h2>\n<p>本文目标是利用TensorFlow做一个简单的图像分类器，在比较大的数据集上，尽可能高效地做图像相关处理，从Train，Validation到Inference，是一个比较基本的Example， 从一个基本的任务学习如果在TensorFlow下做高效地图像读取，基本的图像处理，整个项目很简单，但其中有一些trick，在实际项目当中有很大的好处， 比如绝对不要一次读入所有的 的数据到内存（尽管在Mnist这类级别的例子上经常出现)…</p>\n<p>最开始看到是这篇blog里面的<a href=\"http://blog.topspeedsnail.com/archives/10897\">TensorFlow练习22: 手写汉字识别</a>, 但是这篇文章只用了140训练与测试，试了下代码 很快，但是当扩展到所有的时，发现32g的内存都不够用，这才注意到原文中都是用numpy，会先把所有的数据放入到内存，但这个不必须的，无论在MXNet还是TensorFlow中都是不必 须的，MXNet使用的是DataIter，会在程序运行的过程中异步读取数据，TensorFlow也是这样的，TensorFlow封装了高级的api，用来做数据的读取，比如TFRecord，还有就是从filenames中读取， 来异步读取文件，然后做shuffle batch，再feed到模型的Graph中来做模型参数的更新。具体在tf如何做数据的读取可以看看<a href=\"https://www.tensorflow.org/how_tos/reading_data/\">reading data in tensorflow</a></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611ly1fdxp2dhkc8j21kw0sk11m.jpg\" width=\"2048\" height=\"1028\"></p>\n<p>这里我会拿到所有的数据集来做训练与测试，算作是对<code>斗大的熊猫</code>上面那篇文章的一个扩展。</p>\n<h2>Batch Generate</h2>\n<p>数据集来自于<a href=\"http://www.nlpr.ia.ac.cn/CN/folder/folder8.shtml\">中科院自动化研究所</a>，感谢分享精神！！！具体下载:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d7031f897025434\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1trn_gnt.zip\r\nwget http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1tst_gnt.zip\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7031f897025434-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7031f897025434-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7031f897025434-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d7031f897025434-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1trn_gnt.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7031f897025434-2\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1tst_gnt.zip</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7031f897025434-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>解压后发现是一些gnt文件，然后用了<code>斗大的熊猫</code>里面的代码，将所有文件都转化为对应label目录下的所有png的图片。（注意在HWDB1.1trn_gnt.zip解压后是alz文件，需要再次解压 我在mac没有找到合适的工具，windows上有alz的解压工具)。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d7032a363432353\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os\r\nimport numpy as np\r\nimport struct\r\nfrom PIL import Image\r\n\r\n\r\ndata_dir = '../data'\r\ntrain_data_dir = os.path.join(data_dir, 'HWDB1.1trn_gnt')\r\ntest_data_dir = os.path.join(data_dir, 'HWDB1.1tst_gnt')\r\n\r\n\r\ndef read_from_gnt_dir(gnt_dir=train_data_dir):\r\n    def one_file(f):\r\n        header_size = 10\r\n        while True:\r\n            header = np.fromfile(f, dtype='uint8', count=header_size)\r\n            if not header.size: break\r\n            sample_size = header[0] + (header[1]&lt;&lt;8) + (header[2]&lt;&lt;16) + (header[3]&lt;&lt;24)\r\n            tagcode = header[5] + (header[4]&lt;&lt;8)\r\n            width = header[6] + (header[7]&lt;&lt;8)\r\n            height = header[8] + (header[9]&lt;&lt;8)\r\n            if header_size + width*height != sample_size:\r\n                break\r\n            image = np.fromfile(f, dtype='uint8', count=width*height).reshape((height, width))\r\n            yield image, tagcode\r\n    for file_name in os.listdir(gnt_dir):\r\n        if file_name.endswith('.gnt'):\r\n            file_path = os.path.join(gnt_dir, file_name)\r\n            with open(file_path, 'rb') as f:\r\n                for image, tagcode in one_file(f):\r\n                    yield image, tagcode\r\nchar_set = set()\r\nfor _, tagcode in read_from_gnt_dir(gnt_dir=train_data_dir):\r\n    tagcode_unicode = struct.pack('&gt;H', tagcode).decode('gb2312')\r\n    char_set.add(tagcode_unicode)\r\nchar_list = list(char_set)\r\nchar_dict = dict(zip(sorted(char_list), range(len(char_list))))\r\nprint len(char_dict)\r\nimport pickle\r\nf = open('char_dict', 'wb')\r\npickle.dump(char_dict, f)\r\nf.close()\r\ntrain_counter = 0\r\ntest_counter = 0\r\nfor image, tagcode in read_from_gnt_dir(gnt_dir=train_data_dir):\r\n    tagcode_unicode = struct.pack('&gt;H', tagcode).decode('gb2312')\r\n    im = Image.fromarray(image)\r\n    dir_name = '../data/train/' + '%0.5d'%char_dict[tagcode_unicode]\r\n    if not os.path.exists(dir_name):\r\n        os.mkdir(dir_name)\r\n    im.convert('RGB').save(dir_name+'/' + str(train_counter) + '.png')\r\n    train_counter += 1\r\nfor image, tagcode in read_from_gnt_dir(gnt_dir=test_data_dir):\r\n    tagcode_unicode = struct.pack('&gt;H', tagcode).decode('gb2312')\r\n    im = Image.fromarray(image)\r\n    dir_name = '../data/test/' + '%0.5d'%char_dict[tagcode_unicode]\r\n    if not os.path.exists(dir_name):\r\n        os.mkdir(dir_name)\r\n    im.convert('RGB').save(dir_name+'/' + str(test_counter) + '.png')\r\n    test_counter += 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7032a363432353-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7032a363432353-60\">60</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">struct</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PIL </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-7\"><span class=\"crayon-v\">data_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'../data'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-8\"><span class=\"crayon-v\">train_data_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data_dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'HWDB1.1trn_gnt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-9\"><span class=\"crayon-v\">test_data_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data_dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'HWDB1.1tst_gnt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-12\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_from_gnt_dir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gnt_dir</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">train_data_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">one_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">header_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">header</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromfile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'uint8'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">header_size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sample_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-cn\">24</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tagcode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">width</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">height</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">height</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sample_size</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromfile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'uint8'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tagcode</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-26\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gnt_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.gnt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">file_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gnt_dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rb'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tagcode </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">one_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-31\"><span class=\"crayon-h\">                    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tagcode</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-32\"><span class=\"crayon-v\">char_set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-33\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tagcode </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_from_gnt_dir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gnt_dir</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">train_data_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tagcode_unicode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">struct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt;H'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tagcode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">char_set</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tagcode_unicode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-36\"><span class=\"crayon-v\">char_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">char_set</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-37\"><span class=\"crayon-v\">char_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">char_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">char_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-38\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">char_dict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-39\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pickle</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-40\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'char_dict'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wb'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-41\"><span class=\"crayon-k \">pickle</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">char_dict</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-42\"><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-43\"><span class=\"crayon-v\">train_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-44\"><span class=\"crayon-v\">test_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-45\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tagcode </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_from_gnt_dir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gnt_dir</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">train_data_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tagcode_unicode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">struct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt;H'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tagcode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">im</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'../data/train/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%0.5d'</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">char_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tagcode_unicode</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mkdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">im</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'RGB'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">train_counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'.png'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">train_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-53\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tagcode </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">read_from_gnt_dir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gnt_dir</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">test_data_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tagcode_unicode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">struct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt;H'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tagcode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">im</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'../data/test/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%0.5d'</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">char_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tagcode_unicode</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mkdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7032a363432353-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">im</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'RGB'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dir_name</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'.png'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7032a363432353-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">test_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0157 seconds] -->\r\n<p>处理好的数据，放到了云盘，大家可以直接在我的云盘来下载处理好的数据集<a href=\"https://pan.baidu.com/s/1o84jIrg\">HWDB1</a>. 这里说明下，char_dict是汉字和对应的数字label的记录。</p>\n<p>得到数据集后，就要考虑如何读取了，一次用numpy读入内存在很多小数据集上是可以行的，但是在稍微大点的数据集上内存就成了瓶颈，但是不要害怕，TensorFlow有自己的方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d70331057299838\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef batch_data(file_labels,sess, batch_size=128):\r\n    image_list = [file_label[0] for file_label in file_labels]\r\n    label_list = [int(file_label[1]) for file_label in file_labels]\r\n    print 'tag2 {0}'.format(len(image_list))\r\n    images_tensor = tf.convert_to_tensor(image_list, dtype=tf.string)\r\n    labels_tensor = tf.convert_to_tensor(label_list, dtype=tf.int64)\r\n    input_queue = tf.train.slice_input_producer([images_tensor, labels_tensor])\r\n\r\n    labels = input_queue[1]\r\n    images_content = tf.read_file(input_queue[0])\r\n    # images = tf.image.decode_png(images_content, channels=1)\r\n    images = tf.image.convert_image_dtype(tf.image.decode_png(images_content, channels=1), tf.float32)\r\n    # images = images / 256\r\n    images =  pre_process(images)\r\n    # print images.get_shape()\r\n    # one hot\r\n    labels = tf.one_hot(labels, 3755)\r\n    image_batch, label_batch = tf.train.shuffle_batch([images, labels], batch_size=batch_size, capacity=50000,min_after_dequeue=10000)\r\n    # print 'image_batch', image_batch.get_shape()\r\n\r\n    coord = tf.train.Coordinator()\r\n    threads = tf.train.start_queue_runners(sess=sess, coord=coord)\r\n    return image_batch, label_batch, coord, threads\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70331057299838-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70331057299838-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">batch_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">image_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_label </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">label_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_label </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tag2 {0}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images_tensor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert_to_tensor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels_tensor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert_to_tensor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">input_queue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">slice_input_producer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">images_tensor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_tensor</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">input_queue</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images_content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input_queue</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># images = tf.image.decode_png(images_content, channels=1)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert_image_dtype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode_png</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images_content</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channels</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># images = images / 256</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">pre_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># print images.get_shape()</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># one hot</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">one_hot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3755</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">image_batch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label_batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shuffle_batch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batch_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">capacity</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">50000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">min_after_dequeue</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># print 'image_batch', image_batch.get_shape()</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-20\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">coord</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Coordinator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_queue_runners</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">coord</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">coord</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70331057299838-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image_batch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label_batch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">coord</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70331057299838-24\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>简单介绍下，首先你需要得到所有的图像的path和对应的label的列表，利用<code>tf.convert_to_tensor</code>转换为对应的tensor， 利用<code>tf.train.slice_input_producer</code>将image_list ,label_list做一个slice处理，然后做图像的读取、预处理，以及label的one_hot表示，然后就是传到<code>tf.train.shuffle_batch</code>产生一个个shuffle batch，这些就可以feed到你的 模型。 <code>slice_input_producer</code>和<code>shuffle_batch</code>这类操作内部都是基于queue，是一种异步的处理方式,会在设备中开辟一段空间用作cache，不同的进程会分别一直往cache中塞数据 和取数据，保证内存或显存的占用以及每一个mini-batch不需要等待，直接可以从cache中获取。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/large/63918611ly1fdxp2dyhmoj20kk0e0dgm.jpg\" width=\"740\" height=\"504\"></p>\n<h2>Data Augmentation</h2>\n<p>由于图像场景不复杂，只是做了一些基本的处理，包括图像翻转，改变下亮度等等，这些在TensorFlow里面有现成的api，所以尽量使用TensorFlow来做相关的处理：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d70337820224221\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef pre_process(images):\r\n    if FLAGS.random_flip_up_down:\r\n        images = tf.image.random_flip_up_down(images)\r\n    if FLAGS.random_flip_left_right:\r\n        images = tf.image.random_flip_left_right(images)\r\n    if FLAGS.random_brightness:\r\n        images = tf.image.random_brightness(images, max_delta=0.3)\r\n    if FLAGS.random_contrast:\r\n        images = tf.image.random_contrast(images, 0.8, 1.2)\r\n    new_size = tf.constant([FLAGS.image_size,FLAGS.image_size], dtype=tf.int32)\r\n    images = tf.image.resize_images(images, new_size)\r\n    return images\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70337820224221-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70337820224221-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70337820224221-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70337820224221-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70337820224221-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70337820224221-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70337820224221-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">pre_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70337820224221-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random_flip_up_down</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random_flip_up_down</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70337820224221-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random_flip_left_right</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random_flip_left_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70337820224221-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random_brightness</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random_brightness</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_delta</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70337820224221-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random_contrast</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random_contrast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70337820224221-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">new_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">constant</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image_size</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize_images</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">new_size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70337820224221-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">images</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70337820224221-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p></p>\n<h2>Build Graph</h2>\n<p>这里很简单的构造了一个两个卷积+一个全连接层的网络，没有做什么更深的设计，感觉意义不大，设计了一个dict，用来返回后面要用的所有op，还有就是为了方便再训练中查看loss和accuracy， 没有什么特别的，很容易理解, labels 为None时 方便做inference。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d7033b992550152\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef network(images, labels=None):\r\n    endpoints = {}\r\n    conv_1 = slim.conv2d(images, 32, [3,3],1, padding='SAME')\r\n    max_pool_1 = slim.max_pool2d(conv_1, [2,2],[2,2], padding='SAME')\r\n    conv_2 = slim.conv2d(max_pool_1, 64, [3,3],padding='SAME')\r\n    max_pool_2 = slim.max_pool2d(conv_2, [2,2],[2,2], padding='SAME')\r\n    flatten = slim.flatten(max_pool_2)\r\n    out = slim.fully_connected(flatten,3755, activation_fn=None)\r\n    global_step = tf.Variable(initial_value=0)\r\n    if labels is not None:\r\n        loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(out, labels))\r\n        train_op = tf.train.AdamOptimizer(learning_rate=0.0001).minimize(loss, global_step=global_step)\r\n        accuracy = tf.reduce_mean(tf.cast(tf.equal(tf.argmax(out, 1), tf.argmax(labels, 1)), tf.float32))\r\n        tf.summary.scalar('loss', loss)\r\n        tf.summary.scalar('accuracy', accuracy)\r\n        merged_summary_op = tf.summary.merge_all()\r\n    output_score = tf.nn.softmax(out)\r\n    predict_val_top3, predict_index_top3 = tf.nn.top_k(output_score, k=3)\r\n\r\n    endpoints['global_step'] = global_step\r\n    if labels is not None:\r\n        endpoints['labels'] = labels\r\n        endpoints['train_op'] = train_op\r\n        endpoints['loss'] = loss\r\n        endpoints['accuracy'] = accuracy\r\n        endpoints['merged_summary_op'] = merged_summary_op\r\n    endpoints['output_score'] = output_score\r\n    endpoints['predict_val_top3'] = predict_val_top3\r\n    endpoints['predict_index_top3'] = predict_index_top3\r\n    return endpoints\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7033b992550152-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7033b992550152-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">network</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conv_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">max_pool_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conv_1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conv_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_pool_1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">max_pool_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conv_2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">flatten</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">flatten</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_pool_2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fully_connected</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flatten</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3755</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">activation_fn</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">global_step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Variable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">initial_value</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">labels </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">loss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reduce_mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">softmax_cross_entropy_with_logits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">train_op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AdamOptimizer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">learning_rate</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.0001</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">minimize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">global_step</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">global_step</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">accuracy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reduce_mean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argmax</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argmax</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">summary</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scalar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'loss'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">summary</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scalar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'accuracy'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">accuracy</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">merged_summary_op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">summary</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">merge_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">softmax</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">predict_val_top3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">predict_index_top3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">top_k</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_score</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'global_step'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">global_step</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">labels </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'labels'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">labels</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-23\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'train_op'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_op</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-24\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'loss'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loss</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-25\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'accuracy'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accuracy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-26\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'merged_summary_op'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">merged_summary_op</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-27\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'output_score'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">output_score</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-28\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'predict_val_top3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">predict_val_top3</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-29\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'predict_index_top3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">predict_index_top3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7033b992550152-30\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">endpoints</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7033b992550152-31\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0077 seconds] -->\r\n<p></p>\n<h2>Train</h2>\n<p>train函数包括从已有checkpoint中restore，得到step，快速恢复训练过程，训练主要是每一次得到mini-batch，更新参数，每隔eval_steps后做一次train batch的eval，每隔save_steps 后保存一次checkpoint。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d70340614367227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef train():\r\n    sess = tf.Session()\r\n    file_labels = get_imagesfile(FLAGS.train_data_dir)\r\n    images, labels, coord, threads = batch_data(file_labels, sess)\r\n    endpoints = network(images, labels)\r\n    saver = tf.train.Saver()\r\n    sess.run(tf.global_variables_initializer())\r\n    train_writer = tf.train.SummaryWriter('./log' + '/train',sess.graph)\r\n    test_writer = tf.train.SummaryWriter('./log' + '/val')\r\n    start_step = 0\r\n    if FLAGS.restore:\r\n        ckpt = tf.train.latest_checkpoint(FLAGS.checkpoint_dir)\r\n        if ckpt:\r\n            saver.restore(sess, ckpt)\r\n            print \"restore from the checkpoint {0}\".format(ckpt)\r\n            start_step += int(ckpt.split('-')[-1])\r\n    logger.info(':::Training Start:::')\r\n    try:\r\n        while not coord.should_stop():\r\n        # logger.info('step {0} start'.format(i))\r\n            start_time = time.time()\r\n            _, loss_val, train_summary, step = sess.run([endpoints['train_op'], endpoints['loss'], endpoints['merged_summary_op'], endpoints['global_step']])\r\n            train_writer.add_summary(train_summary, step)\r\n            end_time = time.time()\r\n            logger.info(\"the step {0} takes {1} loss {2}\".format(step, end_time-start_time, loss_val))\r\n            if step &gt; FLAGS.max_steps:\r\n                break\r\n            # logger.info(\"the step {0} takes {1} loss {2}\".format(i, end_time-start_time, loss_val))\r\n            if step % FLAGS.eval_steps == 1:\r\n                accuracy_val,test_summary, step = sess.run([endpoints['accuracy'], endpoints['merged_summary_op'], endpoints['global_step']])\r\n                test_writer.add_summary(test_summary, step)\r\n                logger.info('===============Eval a batch in Train data=======================')\r\n                logger.info( 'the step {0} accuracy {1}'.format(step, accuracy_val))\r\n                logger.info('===============Eval a batch in Train data=======================')\r\n            if step % FLAGS.save_steps == 1:\r\n                logger.info('Save the ckpt of {0}'.format(step))\r\n                saver.save(sess, os.path.join(FLAGS.checkpoint_dir, 'my-model'), global_step=endpoints['global_step'])\r\n    except tf.errors.OutOfRangeError:\r\n        # print \"============train finished=========\"\r\n        logger.info('==================Train Finished================')\r\n        saver.save(sess, os.path.join(FLAGS.checkpoint_dir, 'my-model'), global_step=endpoints['global_step'])\r\n    finally:\r\n        coord.request_stop()\r\n    coord.join(threads)\r\n    sess.close()\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70340614367227-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70340614367227-46\">46</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">train</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_imagesfile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train_data_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">coord</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">batch_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">network</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">saver</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Saver</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">global_variables_initializer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">train_writer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SummaryWriter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./log'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/train'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">test_writer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SummaryWriter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./log'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/val'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">restore</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">latest_checkpoint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">checkpoint_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">saver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"restore from the checkpoint {0}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">start_step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'-'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">':::Training Start:::'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">coord</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">should_stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># logger.info('step {0} start'.format(i))</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">start_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loss_val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">train_summary</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'train_op'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'loss'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'merged_summary_op'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'global_step'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">train_writer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">train_summary</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">end_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"the step {0} takes {1} loss {2}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_time</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">start_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loss_val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max_steps</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># logger.info(\"the step {0} takes {1} loss {2}\".format(i, end_time-start_time, loss_val))</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">eval_steps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">accuracy_val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">test_summary</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'accuracy'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'merged_summary_op'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'global_step'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">test_writer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_summary</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'===============Eval a batch in Train data======================='</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'the step {0} accuracy {1}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">accuracy_val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'===============Eval a batch in Train data======================='</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">save_steps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Save the ckpt of {0}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">saver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">checkpoint_dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'my-model'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">global_step</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'global_step'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">errors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">OutOfRangeError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># print \"============train finished=========\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'==================Train Finished================'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">saver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">checkpoint_dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'my-model'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">global_step</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'global_step'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">coord</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request_stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">coord</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70340614367227-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70340614367227-46\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0106 seconds] -->\r\n<p>Graph</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/large/63918611ly1fdxp2eqw0qj21kw211179.jpg\" width=\"2048\" height=\"2629\"></p>\n<p>Loss and Accuracy</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/large/63918611ly1fdxp2f7d8zj20fi0gsjsb.jpg\" width=\"558\" height=\"604\"></p>\n<h2>Validation</h2>\n<p>训练完成之后，想对最终的模型在测试数据集上做一个评估，这里我也曾经尝试利用batch_data，将slice_input_producer中epoch设置为1，来做相关的工作，但是发现这里无法和train 共用，会出现epoch无初始化值的问题（train中传epoch为None），所以这里自己写了shuffle batch的逻辑，将测试集的images和labels通过feed_dict传进到网络，得到模型的输出， 然后做相关指标的计算：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d70346125544356\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef validation():\r\n    # it should be fixed by using placeholder with epoch num in train stage\r\n    sess = tf.Session()\r\n\r\n    file_labels = get_imagesfile(FLAGS.test_data_dir)\r\n    test_size = len(file_labels)\r\n    print test_size\r\n    val_batch_size = FLAGS.val_batch_size\r\n    test_steps = test_size / val_batch_size\r\n    print test_steps\r\n    # images, labels, coord, threads= batch_data(file_labels, sess)\r\n    images = tf.placeholder(dtype=tf.float32, shape=[None, 64, 64, 1])\r\n    labels = tf.placeholder(dtype=tf.int32, shape=[None,3755])\r\n    # read batch images from file_labels\r\n    # images_batch = np.zeros([128,64,64,1])\r\n    # labels_batch = np.zeros([128,3755])\r\n    # labels_batch[0][20] = 1\r\n    #\r\n    endpoints = network(images, labels)\r\n    saver = tf.train.Saver()\r\n    ckpt = tf.train.latest_checkpoint(FLAGS.checkpoint_dir)\r\n    if ckpt:\r\n        saver.restore(sess, ckpt)\r\n        # logger.info(\"restore from the checkpoint {0}\".format(ckpt))\r\n    # logger.info('Start validation')\r\n    final_predict_val = []\r\n    final_predict_index = []\r\n    groundtruth = []\r\n    for i in range(test_steps):\r\n        start = i* val_batch_size\r\n        end = (i+1)*val_batch_size\r\n        images_batch = []\r\n        labels_batch = []\r\n        labels_max_batch = []\r\n        logger.info('=======start validation on {0}/{1} batch========='.format(i, test_steps))\r\n        for j in range(start,end):\r\n            image_path = file_labels[j][0]\r\n            temp_image = Image.open(image_path).convert('L')\r\n            temp_image = temp_image.resize((FLAGS.image_size, FLAGS.image_size),Image.ANTIALIAS)\r\n            temp_label = np.zeros([3755])\r\n            label = int(file_labels[j][1])\r\n            # print label\r\n            temp_label[label] = 1\r\n            # print \"====\",np.asarray(temp_image).shape\r\n            labels_batch.append(temp_label)\r\n            # print \"====\",np.asarray(temp_image).shape\r\n            images_batch.append(np.asarray(temp_image)/255.0)\r\n            labels_max_batch.append(label)\r\n        # print images_batch\r\n        images_batch = np.array(images_batch).reshape([-1, 64, 64, 1])\r\n        labels_batch = np.array(labels_batch)\r\n        batch_predict_val, batch_predict_index = sess.run([endpoints['predict_val_top3'],\r\n                        endpoints['predict_index_top3']], feed_dict={images:images_batch, labels:labels_batch})\r\n        logger.info('=======validation on {0}/{1} batch end========='.format(i, test_steps))\r\n        final_predict_val += batch_predict_val.tolist()\r\n        final_predict_index += batch_predict_index.tolist()\r\n        groundtruth += labels_max_batch\r\n    sess.close()\r\n    return final_predict_val, final_predict_index, groundtruth\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d70346125544356-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d70346125544356-60\">60</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">validation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># it should be fixed by using placeholder with epoch num in train stage</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_imagesfile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">test_data_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">test_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">test_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">val_batch_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">val_batch_size</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">test_steps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val_batch_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">test_steps</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># images, labels, coord, threads= batch_data(file_labels, sess)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3755</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># read batch images from file_labels</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># images_batch = np.zeros([128,64,64,1])</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># labels_batch = np.zeros([128,3755])</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># labels_batch[0][20] = 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">network</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">saver</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Saver</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">latest_checkpoint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">checkpoint_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">saver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># logger.info(\"restore from the checkpoint {0}\".format(ckpt))</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># logger.info('Start validation')</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">final_predict_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">final_predict_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">groundtruth</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_steps</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">i*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val_batch_size</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-31\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">val_batch_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-32\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">images_batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">labels_batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">labels_max_batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'=======start validation on {0}/{1} batch========='</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_steps</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">image_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image_path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'L'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ANTIALIAS</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">temp_label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3755</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file_labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># print label</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">temp_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># print \"====\",np.asarray(temp_image).shape</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">labels_batch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp_label</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># print \"====\",np.asarray(temp_image).shape</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">images_batch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">255.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">labels_max_batch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># print images_batch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">images_batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images_batch</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">labels_batch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels_batch</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">batch_predict_val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch_predict_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'predict_val_top3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-53\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'predict_index_top3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feed_dict</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">images</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">images_batch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">labels_batch</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'=======validation on {0}/{1} batch end========='</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_steps</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">final_predict_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch_predict_val</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tolist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">final_predict_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">batch_predict_index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tolist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">groundtruth</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">labels_max_batch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-58\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d70346125544356-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">final_predict_val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">final_predict_index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">groundtruth</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d70346125544356-60\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0101 seconds] -->\r\n<p>在训练20w个step之后，大概能达到在测试集上能够达到：</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/large/63918611ly1fdxp2ft9arj20ja037wfa.jpg\" width=\"694\" height=\"115\"></p>\n<p>相信如果在网络设计上多花点时间能够在一定程度上提升accuracy和top 3 accuracy.有兴趣的小伙伴们可以玩玩这个数据集。</p>\n<h2>Inference</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c86d7034d018586223\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef inference(image):\r\n    temp_image = Image.open(image).convert('L')\r\n    temp_image = temp_image.resize((FLAGS.image_size, FLAGS.image_size),Image.ANTIALIAS)\r\n    sess = tf.Session()\r\n    logger.info('========start inference============')\r\n    images = tf.placeholder(dtype=tf.float32, shape=[None, 64, 64, 1])\r\n    endpoints = network(images)\r\n    saver = tf.train.Saver()\r\n    ckpt = tf.train.latest_checkpoint(FLAGS.checkpoint_dir)\r\n    if ckpt:\r\n        saver.restore(sess, ckpt)\r\n    predict_val, predict_index = sess.run([endpoints['predict_val_top3'],endpoints['predict_index_top3']], feed_dict={images:temp_image})\r\n    sess.close()\r\n    return final_predict_val, final_predict_index\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c86d7034d018586223-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c86d7034d018586223-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">inference</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'L'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ANTIALIAS</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'========start inference============'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">network</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">images</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">saver</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Saver</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">latest_checkpoint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">FLAGS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">checkpoint_dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">saver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ckpt</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">predict_val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">predict_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'predict_val_top3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">endpoints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'predict_index_top3'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feed_dict</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">images</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">temp_image</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c86d7034d018586223-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">final_predict_val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">final_predict</span><span class=\"crayon-sy\">_</span>index</div><div class=\"crayon-line\" id=\"crayon-58e2c86d7034d018586223-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611ly1fdxp2g9ittj211k09madh.jpg\" width=\"1352\" height=\"346\"></p>\n<p>运气挺好，随便找了张图片就能准确识别出来</p>\n<h2>Summary</h2>\n<p>综上，就是利用tensorflow做中文手写识别的全部，从如何使用tensorflow内部的queue来有效读入数据，到如何设计network， 到如何做train，validation，inference，珍格格流程比较清晰， 美中不足的是，原本打算是在训练过程中，来对测试集做评估，但是在使用queue读test_data_dir下的filenames，和train本身的好像有点问题，不过应该是可以解决的，我这里就pass了。另外可能 还有一些可以改善的地方，比如感觉可以把batch data one hot的部分写入到network，这样，减缓在validation时内存会因为onehot的sparse开销比较大。</p>\n<p>感觉这个中文手写汉字数据集价值很大，后面感觉会有好多可以玩的，比如</p>\n<ul>\n<li>可以参考项亮大神的这篇文章<a href=\"https://zhuanlan.zhihu.com/p/21344595\">端到端的OCR：验证码识别</a>做定长的字符识别和不定长的字符识别，定长的基本原理是说，可以把最终输出扩展为k个输出， 每个值表示对应的字符label，这样cnn模型在feature extract之后就可以自己去识别对应字符而无需人工切割；而LSTM+CTC来解决不定长的验证码，类似于将音频解码为汉字</li>\n<li>最近GAN特别火，感觉可以考虑用这个数据来做某个字的生成，和text2img那个项目<a href=\"https://github.com/paarthneekhara/text-to-image\">text-to-image</a></li>\n</ul>\n<p>这部分的代码都在我的github上<a href=\"https://github.com/burness/tensorflow-101\">tensorflow-101</a>，有遇到相关功能,想参考代码的可以去上面找找，没准就能解决你们遇到的一些小问题.</p>\n<h2>Update in 2017.02.13</h2>\n<p>感谢<a href=\"https://github.com/soloice\">@soloice</a>的PR，使得代码更简洁， 并且修改了网络的结构，使得模型准确率上升很高, 最后top1和top3的结果：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/large/63918611ly1fdxp2gpqqij210205s3zq.jpg\" width=\"1298\" height=\"208\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87509\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87509votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87509\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://wx1.sinaimg.cn/large/63918611ly1fdxp2dhkc8j21kw0sk11m.jpg"], "title": "TensorFlow与中文手写汉字识别", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/21419078469fb3b2b48a75c73707dbfa6e1d5167.jpg", "tags": "", "comment_nums": 0, "url_object_id": "831d5251661f5f38b52666e7ea993b8a", "url": "http://python.jobbole.com/87552/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.evontech.com/what-we-are-saying/entry/python-development-7-libraries-to-look-for-in-2017.html\">manmohan</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/python-development-7-libraries-to-look-for-in-2017?print\">oschina</a>   </div><div>\n<p><a href=\"http://www.evontech.com/what-we-are-saying/entry/why-django-is-the-best-framework-for-python-developers.html\" target=\"_blank\" rel=\"nofollow\">Django 依然是 Python 开发者值得信赖的库</a>。然而，在 2016 年几个还不太知名的库引起了 Python 开发者的关注。在这篇博文中，我向大家揭示 7 个 Python 类库，其中不包括像 Django，Flask 等已广为熟知的库，这些类库在 2017 年可能值得 Python 开发者参考。</p>\n<h2>#1 Arrow</h2>\n<p>移动应用程序无处不在，而且全球人类都参与其中 – 无论是游戏，社交媒体，健康监控或其他。然而， Python 的标准数据/时间库的问题让它很难满足现代应用的需求，这些应用的目标受众生活在不同的地区和国家。<a href=\"http://crsmithdev.com/arrow/\" target=\"_blank\" rel=\"nofollow\">Arrow</a> 就是克服这个问题的类库之一。它拥有简化创建，格式化，操作和转换数据，以及时间和时间戳的功能。</p>\n<p>该库解决了 Python 2 或 3 的支持 datetime 类型的需求。使用 Arrow，开发人员可以轻松地将一个时区转换为另一个时区。此外，Arrow 的日期，时间和日历模块打开了一站式服务的国际化应用程序的大门。</p>\n<h2>#2 TensorFlow</h2>\n<p>2015 年 11 月由 Google 推出的 <a href=\"https://en.wikipedia.org/wiki/TensorFlow\" target=\"_blank\" rel=\"nofollow\">TensorFlow</a> 是一个用于数值计算的开源软件库。 自 TensorFlow 的推出才过去一年多的时间，但是这个库已经在 Python 开发人员中获得了相当大的人气。 事实上， TensorFlow 是<a href=\"https://github.com/trending/python\" rel=\"nofollow\">最时髦 GitHub Python 资源库</a>之一。</p>\n<p>该库可以在桌面，服务器或移动设备中通过单个 API 使用运行在 GPU 和 CPUs 上的数据流图能力。 TensorFlow 最初由 Google 机器智能研究机构的研究人员和工程师开发，用于机器学习和深度神经网络研究。 虽然 TensorFlow 在机器学习社区中掀起了一些小的波澜，但它已经被证明非常适合生产应用程序。</p>\n<h2>#3 Zappa</h2>\n<p>最开始的时候是由 <a href=\"https://aws.amazon.com/lambda/details/\" target=\"_blank\" rel=\"nofollow\">AWS Lambda</a> 带来了无服务架构。而 <a href=\"http://www.infoworld.com/article/3031665/application-development/zappa-serves-python-web-apps-minus-the-servers.html\" target=\"_blank\" rel=\"nofollow\">Zappa</a> 则被认为是改进了的 Python web 应用部署的程序。 Rich Jones 是 Zappa 的主要作者，并且是 Gun.io 的 CTO，<a href=\"https://serverlesscode.com/post/rich-jones-interview-django-zappa/\" rel=\"nofollow\">他在一次采访中说道</a>：“我相信无服务架构（这意味着，系统没有任何永久基础设施）是网络应用的未来”。</p>\n<p>至于 Zappa，它让所有 Python WSGI 的应用在 AWS Lambda + API 网关上的部署变得轻而易举。在 <a href=\"https://en.wikipedia.org/wiki/Virtual_private_server\" target=\"_blank\" rel=\"nofollow\">VPS 服务</a>（类似 <a href=\"https://en.wikipedia.org/wiki/Linode\" target=\"_blank\" rel=\"nofollow\">Linode</a>，PaaS服务的 <a href=\"https://en.wikipedia.org/wiki/Heroku\" rel=\"nofollow\">Heroku</a> ）上摆脱依赖库需要花费成百上千的美元。简单来说，我们可以说 Zaapa 允许在云上以微服务部署，不会有任何与服务器管理相关的麻烦事。Zappa 同样也是很快的，可扩展的。</p>\n<h2>#4 Peewee</h2>\n<p>Peewee 是 Python 生态中简单的，富有表现力的 <a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\" target=\"_blank\" rel=\"nofollow\">ORM</a> ，它支持 SQLite，MySQL 和 PostgreSQL。数据库经常需要为应用去使用扩展的数据。不过，通过 ad hoc 连接串去 get 和 set 数据库中的数据是一项非常有挑战的任务。这种情况下，Peewee 就可以帮很大的忙了。这个库对于开发者和数据库工程师都是安全的，使用它可以以程序化的 Python 类来直观地使用数据库资源。</p>\n<p>开发者们以前用 SQLAlchemy 已经创建了一个数据库，应该会觉得使用 Peewee 创建数据库是更容易的。另外，Peewee 一直以来都适用于 Flask web 框架。</p>\n<p><a href=\"http://www.blog.pythonlibrary.org/2014/07/17/an-intro-to-peewee-another-python-orm/\" target=\"_blank\" rel=\"nofollow\">点击这里学习如何在 Peewee 中创建一个数据库</a></p>\n<h2>#5 Sanic + uvloop</h2>\n<p><a href=\"https://www.twilio.com/blog/2016/12/getting-started-with-sanic-the-asynchronous-uvloop-based-web-framework-for-python-3-5.html\" target=\"_blank\" rel=\"nofollow\">Sanic</a> 是一个与 Flask 类似，基于 <a href=\"https://www.twilio.com/blog/2016/12/getting-started-with-sanic-the-asynchronous-uvloop-based-web-framework-for-python-3-5.html\" target=\"_blank\" rel=\"nofollow\">uvloop</a> 的 web 框架，它能让 Python 更快速。Sanik，是基于 Python 3.5 设计的，它允许开发者在 async/await 语法上建立定义异步函数。在 Sanic 之前，Python 没有办法做到如此之快。uvloop 服务作为一个极其快速的库，顺其自然地替代了异步默认事件的循环。</p>\n<p>Sanik 使得开发者能够在 Python 中编写异步应用，在这种方式下非常类似于 Node.js。但是通过 Sanic 作者的基准测试，<a href=\"https://github.com/channelcat/sanic#benchmarks\" target=\"_blank\" rel=\"nofollow\">uvloop 在处理超过每秒33k次请求时，依然表现良好</a>，这超过了 Node.js 的性能。由于 Sanic 还很新，因此在不久的将来会有更多的改进和变更。你也可以到它的 <a href=\"https://github.com/channelcat/sanic\" target=\"_blank\" rel=\"nofollow\">开源库中</a> 做出贡献。</p>\n<h2># 6 Bokeh</h2>\n<p>你可能知道 Python 在数据可视化方面的一些类库，比如 matplotlib 和 seaborn。然而，Bokeh 是一个专门设计可视化交互并用于现代的 Web 浏览器的展示。开发者可以利用 Bokeh 以类似于 <a href=\"https://en.wikipedia.org/wiki/D3.js\" target=\"_blank\" rel=\"nofollow\">D3.js</a> 的方式创建一流的可视媒体。除此之外，你可以利用非常大的或者流式的数据集来扩展更强的表现交互的能力。</p>\n<p>你可以通过 Bokeh 创建可视化端点，仪表盘和数据应用。开发者也可以利用 Bokeh 处理通过其他类库，比如 Matplotlib, Seaborn 和 ggplot 创建的可视化图形。Bokeh 也可以和 Jupyter Notebooks 很好的结合来用于研究领域。</p>\n<h2>#7 Blaze</h2>\n<p>Blaze 用于处理数据库和分析查询的阵列技术。当对一个大到我们的电脑内存不能存储的数据集进行分析时，NumPy 和 Pandas 往往不能派上用场。这时开发者经常求助于 PostgreSQL，MongoDB，Hadoop，Spark 和磁盘外存储系统（PyTables and BColz）等等。</p>\n<p>然而，理解每一个系统如何工作以及如何将数据整理成合适的形式是一个非常有挑战性的工作。由于缺乏对于如何在新技术之间混合和迁移数据的认识，从数据分析中攫取有效的结论将是非常困难的。Blaze 通过提供一个对不同种类数据库技术统一的接口以及迁移数据抽象化处理来解决这个难题。Blaze 对于表达计算是一个好的选择。</p>\n<p>尽管存在一些其他的不太知名但是有效的 Python 类库，如 <a href=\"https://gym.openai.com/\" target=\"_self\" rel=\"nofollow\">Gym</a> + <a href=\"https://universe.openai.com/\" target=\"_self\" rel=\"nofollow\">Universe</a>，<a href=\"https://github.com/boto/boto\" target=\"_self\" rel=\"nofollow\">Boto3</a>，<a href=\"http://www.hug.rest/\" target=\"_self\" rel=\"nofollow\">Hug</a>，<a href=\"https://scrapy.org/\" target=\"_self\" rel=\"nofollow\">Scrapy</a>，<a href=\"https://www.crummy.com/software/BeautifulSoup/bs4/doc/\" target=\"_self\" rel=\"nofollow\">Beautiful Soup</a> 等等。我只能选择这几个以便这篇博客有一个结尾。Python 开发者可以研究这些类库看看是否符合他们的需要，再合理的选择合适的类库。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87552\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87552votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87552\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/2c224095b3bd5c6fee7c908a481292f7.jpg"], "title": "Python 开发者 2017 应该关注的 7 个类库", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/f26f4474c2549683fffbb2ee95de09466390a0a6.jpg", "tags": "", "comment_nums": 0, "url_object_id": "d6d45a968941a1a5d024f35a97cbc56f", "url": "http://python.jobbole.com/87559/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/sunsky303/p/6506663.html\">sunsky303</a>   </div><div id=\"cnblogs_post_body\">\n<p><span id=\"pos_placeholder\" style=\"width: 0px;height: 0px;margin: 0px;padding: 0px\"></span>2017年的golang、python、php、c++、c、java、Nodejs性能对比</p>\n<p><a href=\"http://www.cnblogs.com/sunsky303/p/6605148.html\" target=\"_blank\"> 续集更新</a></p>\n<p>本人在PHP/C++/Go/Py时，突发奇想，想把最近主流的编程语言性能作个简单的比较， 至于怎么比，还是不得不用神奇的斐波那契算法。可能是比较常用或好玩吧。</p>\n<p>好了，talk is cheap, show me your code!  打开Mac，点开Clion开始Coding吧！</p>\n<p><strong>1.怎么第一是Go呢，因为我个人最近正在用，感觉很不错</strong></p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc18721967641\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage main\r\nimport \"fmt\"\r\nfunc main(){\r\n    fmt.Println(fibonacci(34))\r\n}\r\nfunc fibonacci(i int) int{\r\n    if(i&lt;2){\r\n        return i;\r\n    }\r\n    return fibonacci(i-2) + fibonacci(i-1);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc18721967641-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc18721967641-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc18721967641-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc18721967641-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc18721967641-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc18721967641-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc18721967641-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc18721967641-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc18721967641-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc18721967641-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc18721967641-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc18721967641-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc18721967641-2\"><span class=\"crayon-i\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"fmt\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc18721967641-3\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc18721967641-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc18721967641-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc18721967641-6\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc18721967641-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc18721967641-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc18721967641-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc18721967641-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc18721967641-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>先用 Go1.7看看：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc23180934888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ go version &amp;&amp; time go build  fib.go  &amp;&amp; time ./fib\r\ngo version go1.7.5 darwin/amd64\r\n\r\nreal    0m0.206s\r\nuser    0m0.165s\r\nsys     0m0.059s\r\n5702887\r\n\r\nreal    0m0.052s\r\nuser    0m0.045s\r\nsys     0m0.004s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc23180934888-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc23180934888-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc23180934888-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc23180934888-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc23180934888-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc23180934888-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc23180934888-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc23180934888-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc23180934888-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc23180934888-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc23180934888-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc23180934888-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">go </span><span class=\"crayon-v\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">go </span><span class=\"crayon-e\">build  </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">fib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc23180934888-2\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">version </span><span class=\"crayon-v\">go1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">7.5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">darwin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">amd64</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc23180934888-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc23180934888-4\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.206s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc23180934888-5\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.165s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc23180934888-6\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.059s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc23180934888-7\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc23180934888-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc23180934888-9\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.052s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc23180934888-10\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.045s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc23180934888-11\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.004s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>然后，再看看1.8的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc27412687372\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ go18 version &amp;&amp; time go18 build  fib.go  &amp;&amp; time ./fib\r\ngo version go1.8 darwin/amd64\r\n\r\nreal    0m0.204s\r\nuser    0m0.153s\r\nsys     0m0.062s\r\n5702887\r\n\r\nreal    0m0.051s\r\nuser    0m0.045s\r\nsys     0m0.003s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc27412687372-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc27412687372-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc27412687372-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc27412687372-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc27412687372-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc27412687372-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc27412687372-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc27412687372-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc27412687372-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc27412687372-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc27412687372-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc27412687372-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">go18 </span><span class=\"crayon-v\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">go18 </span><span class=\"crayon-e\">build  </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">fib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc27412687372-2\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">version </span><span class=\"crayon-v\">go1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">darwin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">amd64</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc27412687372-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc27412687372-4\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.204s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc27412687372-5\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.153s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc27412687372-6\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.062s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc27412687372-7\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc27412687372-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc27412687372-9\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.051s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc27412687372-10\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.045s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc27412687372-11\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.003s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>感觉看不出差异，但官方1.8在GC、Compile等方面优化提升了20%，可能是这demo太简单了吧。</p>\n<p>2.Python，最近玩得也火热，所以拿来比比</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc2b084539827\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fibonacci(i):\r\n    if i&lt;2:\r\n        return i\r\n    return fibonacci(i-2) + fibonacci(i-1)\r\n \r\nprint(fibonacci(34))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2b084539827-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc2b084539827-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2b084539827-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc2b084539827-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2b084539827-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc2b084539827-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc2b084539827-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc2b084539827-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc2b084539827-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc2b084539827-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc2b084539827-5\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc2b084539827-6\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>先来看看python2.7</p>\n</div>\n<p> </p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc2e688443299\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ python2 -V &amp;&amp; time python2 ./fib.py \r\nPython 2.7.13\r\n5702887\r\n\r\nreal 0m2.651s\r\nuser 0m2.594s\r\nsys 0m0.027s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2e688443299-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc2e688443299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2e688443299-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc2e688443299-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2e688443299-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc2e688443299-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc2e688443299-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc2e688443299-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">V</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">python2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc2e688443299-2\"><span class=\"crayon-i\">Python</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.7.13</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc2e688443299-3\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc2e688443299-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc2e688443299-5\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0m2.651s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc2e688443299-6\"><span class=\"crayon-k \">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0m2.594s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc2e688443299-7\"><span class=\"crayon-k \">sys</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0m0.027s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<div id=\"cnblogs_post_body\">\n<p>接着是Py 3.5</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc32128499344\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ python3 -V &amp;&amp; time python3 ./fib.py \r\nPython 3.5.1\r\n5702887\r\n\r\nreal    0m3.110s\r\nuser    0m2.982s\r\nsys     0m0.026s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc32128499344-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc32128499344-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc32128499344-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc32128499344-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc32128499344-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc32128499344-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc32128499344-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc32128499344-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">V</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-i\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc32128499344-2\"><span class=\"crayon-i\">Python</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.5.1</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc32128499344-3\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc32128499344-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc32128499344-5\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m3.110s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc32128499344-6\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m2.982s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc32128499344-7\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.026s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>一眼就看出Py最大的问题了：越升级越慢， 而且要命的是很多语法不兼容，但平时写写算法、小程序还不错，其它的时候，就算了，还是用Go吧。</p>\n<p>3.PHP嘛，我工作用的多，所以也必须比较下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc35316087201\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\nfunction fibonacci($i){\r\n    if($i&lt;2) return $i;\r\n    return fibonacci($i-2) + fibonacci($i-1);\r\n}\r\necho  fibonacci(34);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc35316087201-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc35316087201-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc35316087201-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc35316087201-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc35316087201-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc35316087201-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc35316087201-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc35316087201-2\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc35316087201-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc35316087201-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc35316087201-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc35316087201-6\"><span class=\"crayon-e\">echo  </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>由于我的工作主要用的php5.4，所以先来波：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc38278680998\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ php54 -v &amp;&amp; time php54  fib.php \r\nPHP 5.4.43 (cli) (built: Dec 21 2016 12:01:59) \r\nCopyright (c) 1997-2014 The PHP Group\r\nZend Engine v2.4.0, Copyright (c) 1998-2014 Zend Technologies\r\n5702887\r\nreal    0m2.288s\r\nuser    0m2.248s\r\nsys     0m0.021s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc38278680998-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc38278680998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc38278680998-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc38278680998-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc38278680998-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc38278680998-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc38278680998-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc38278680998-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc38278680998-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">php54</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">php54  </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">php </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc38278680998-2\"><span class=\"crayon-i\">PHP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.43</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cli</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc38278680998-3\"><span class=\"crayon-e\">Copyright</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1997</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2014</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">PHP </span><span class=\"crayon-e\">Group</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc38278680998-4\"><span class=\"crayon-e\">Zend </span><span class=\"crayon-e\">Engine </span><span class=\"crayon-v\">v2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">4.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Copyright</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1998</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2014</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zend </span><span class=\"crayon-i\">Technologies</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc38278680998-5\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc38278680998-6\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m2.288s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc38278680998-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m2.248s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc38278680998-8\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.021s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n\n</div>\n<p>测试环境是5.6，所以也来波：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc3b849174752\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ php -v &amp;&amp; time php  fib.php \r\nPHP 5.6.28 (cli) (built: Dec  6 2016 12:38:54) \r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n5702887\r\nreal    0m2.307s\r\nuser    0m2.278s\r\nsys     0m0.017s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3b849174752-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3b849174752-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3b849174752-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3b849174752-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3b849174752-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3b849174752-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3b849174752-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3b849174752-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc3b849174752-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">php</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">php  </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">php </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3b849174752-2\"><span class=\"crayon-i\">PHP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.6.28</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cli</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Dec</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">38</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">54</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc3b849174752-3\"><span class=\"crayon-e\">Copyright</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1997</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">PHP </span><span class=\"crayon-e\">Group</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3b849174752-4\"><span class=\"crayon-e\">Zend </span><span class=\"crayon-e\">Engine </span><span class=\"crayon-v\">v2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Copyright</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1998</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zend </span><span class=\"crayon-i\">Technologies</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc3b849174752-5\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3b849174752-6\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m2.307s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc3b849174752-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m2.278s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3b849174752-8\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.017s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n\n</div>\n<p>新项目、自己玩什么的都是php7, 请看：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc3e973744106\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ php -v &amp;&amp; time php  fib.php\r\nPHP 7.1.2 (cli) (built: Feb 17 2017 10:52:17) ( NTS )\r\nCopyright (c) 1997-2017 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\r\n5702887\r\nreal    0m0.815s\r\nuser    0m0.780s\r\nsys     0m0.015s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3e973744106-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3e973744106-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3e973744106-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3e973744106-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3e973744106-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3e973744106-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc3e973744106-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc3e973744106-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc3e973744106-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">php</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">php  </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3e973744106-2\"><span class=\"crayon-i\">PHP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.1.2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cli</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">52</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">NTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc3e973744106-3\"><span class=\"crayon-e\">Copyright</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1997</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">PHP </span><span class=\"crayon-e\">Group</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3e973744106-4\"><span class=\"crayon-e\">Zend </span><span class=\"crayon-e\">Engine </span><span class=\"crayon-v\">v3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Copyright</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1998</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zend </span><span class=\"crayon-i\">Technologies</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc3e973744106-5\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3e973744106-6\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.815s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc3e973744106-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.780s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc3e973744106-8\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.015s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<p>感觉php7和5是天壤之别，完全不是一个东西，而且进步提升太大了，在此依赖鸟哥点个赞！建议大家多用php7.</p>\n<p>4.C++是我最爱的理论基础，当然说的是C++11/14，不是老古董c99等</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc42225234381\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;iostream&gt;\r\n \r\nconstexpr int fibonacci(const int i){\r\n    if(i&lt;2) return i;\r\n    return fibonacci(i-2) + fibonacci(i-1);\r\n}\r\n \r\nint main() {\r\n    fibonacci(34);\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc42225234381-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc42225234381-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc42225234381-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc42225234381-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc42225234381-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc42225234381-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc42225234381-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc42225234381-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc42225234381-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc42225234381-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc42225234381-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc42225234381-1\"><span class=\"crayon-p\">#include &lt;iostream&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc42225234381-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc42225234381-3\"><span class=\"crayon-e\">constexpr </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc42225234381-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc42225234381-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc42225234381-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc42225234381-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc42225234381-8\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc42225234381-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc42225234381-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc42225234381-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>先用g++ 6.2 无优化看看：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc45431703910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ time g++-6  -o a.bin main.cpp &amp;&amp; time  ./a.bin \r\n\r\nreal    0m0.378s\r\nuser    0m0.254s\r\nsys     0m0.104s\r\n5702887\r\n\r\nreal    0m0.050s\r\nuser    0m0.043s\r\nsys     0m0.002s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc45431703910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc45431703910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc45431703910-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc45431703910-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc45431703910-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc45431703910-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc45431703910-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc45431703910-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc45431703910-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc45431703910-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc45431703910-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">++</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc45431703910-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc45431703910-3\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.378s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc45431703910-4\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.254s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc45431703910-5\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.104s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc45431703910-6\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc45431703910-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc45431703910-8\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.050s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc45431703910-9\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.043s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc45431703910-10\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.002s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>加优化-O2后，</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc48135731368\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ time g++-6 -O2 -o a.bin main.cpp &amp;&amp; time  ./a.bin\r\nreal 0m0.327s\r\nuser\t0m0.258s\r\nsys\t0m0.056s\r\n5702887\r\n\r\nreal 0m0.005s\r\nuser\t0m0.002s\r\nsys\t0m0.002s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc48135731368-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc48135731368-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc48135731368-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc48135731368-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc48135731368-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc48135731368-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc48135731368-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc48135731368-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc48135731368-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc48135731368-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">++</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">O2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc48135731368-2\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0m0.327s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc48135731368-3\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">\t</span><span class=\"crayon-cn\">0m0.258s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc48135731368-4\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">\t</span><span class=\"crayon-cn\">0m0.056s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc48135731368-5\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc48135731368-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc48135731368-7\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0m0.005s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc48135731368-8\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">\t</span><span class=\"crayon-cn\">0m0.002s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc48135731368-9\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">\t</span><span class=\"crayon-cn\">0m0.002s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>效果还是很明显的， 运行时间只有前者一半。</p>\n<p>5. C也写了个</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc4b336039373\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n \r\nint fibonacci(int i){\r\n    if(i&lt;2) return i;\r\n    return fibonacci(i-2) + fibonacci(i-1);\r\n}\r\nint main(){\r\n    printf(\"%d\",fibonacci(34));\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4b336039373-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4b336039373-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4b336039373-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4b336039373-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4b336039373-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4b336039373-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4b336039373-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4b336039373-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4b336039373-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc4b336039373-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4b336039373-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4b336039373-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4b336039373-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4b336039373-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4b336039373-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4b336039373-7\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4b336039373-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4b336039373-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>不加优化：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc4e459737800\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ time gcc-6 -o c.bin fib.c &amp;&amp; time ./c.bin \r\n\r\nreal    0m0.341s\r\nuser    0m0.063s\r\nsys     0m0.101s\r\n5702887\r\nreal    0m0.049s\r\nuser    0m0.044s\r\nsys     0m0.002s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4e459737800-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4e459737800-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4e459737800-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4e459737800-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4e459737800-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4e459737800-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4e459737800-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc4e459737800-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc4e459737800-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc4e459737800-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4e459737800-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4e459737800-3\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.341s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4e459737800-4\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.063s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4e459737800-5\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.101s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4e459737800-6\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4e459737800-7\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.049s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc4e459737800-8\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.044s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc4e459737800-9\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.002s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>加-O2优化:</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc52412790492\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ time gcc-6 -O2 -o c.bin fib.c &amp;&amp; time ./c.bin \r\n\r\nreal    0m0.143s\r\nuser    0m0.065s\r\nsys     0m0.034s\r\n5702887\r\nreal    0m0.034s\r\nuser    0m0.028s\r\nsys     0m0.002s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc52412790492-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc52412790492-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc52412790492-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc52412790492-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc52412790492-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc52412790492-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc52412790492-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc52412790492-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc52412790492-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc52412790492-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">O2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bin </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc52412790492-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc52412790492-3\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.143s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc52412790492-4\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.065s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc52412790492-5\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.034s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc52412790492-6\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc52412790492-7\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.034s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc52412790492-8\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.028s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc52412790492-9\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.002s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>和C++14一样， 优化后提速明显，快了一倍。</p>\n<p>6.Java，是我最不想写的，虽然它很火，感觉太臃肿了</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc55605843099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Fib{\r\n    public   static void  main(String[] args){\r\n        System.out.println(fibonacci(34));\r\n \r\n    }\r\n \r\n    static int fibonacci( int i){\r\n        if(i&lt;2) return i;\r\n        return fibonacci(i-2) + fibonacci(i-1);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc55605843099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc55605843099-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc55605843099-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc55605843099-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc55605843099-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc55605843099-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc55605843099-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc55605843099-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc55605843099-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc55605843099-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc55605843099-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc55605843099-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Fib</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc55605843099-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\">   </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc55605843099-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc55605843099-4\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc55605843099-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc55605843099-6\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc55605843099-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc55605843099-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc55605843099-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc55605843099-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc55605843099-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n<p>编译、运行的结果是：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc58094766742\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ java -version &amp;&amp; time javac Fib.java &amp;&amp;  time java Fib \r\njava version \"1.8.0_25\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_25-b17)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)\r\n\r\nreal    0m0.952s\r\nuser    0m1.302s\r\nsys     0m0.144s\r\n5702887\r\n\r\nreal    0m0.150s\r\nuser    0m0.123s\r\nsys     0m0.025s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc58094766742-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc58094766742-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc58094766742-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc58094766742-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc58094766742-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc58094766742-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc58094766742-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">javac </span><span class=\"crayon-v\">Fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">java</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">java </span><span class=\"crayon-e\">Fib </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc58094766742-2\"><span class=\"crayon-e\">java </span><span class=\"crayon-i\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1.8.0_25\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-3\"><span class=\"crayon-e\">Java</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SE </span><span class=\"crayon-e\">Runtime </span><span class=\"crayon-e\">Environment</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">build</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.8.0_25</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b17</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc58094766742-4\"><span class=\"crayon-e\">Java </span><span class=\"crayon-e\">HotSpot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Bit </span><span class=\"crayon-e\">Server </span><span class=\"crayon-e\">VM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">build</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25.25</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b02</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mixed </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc58094766742-6\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.952s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m1.302s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc58094766742-8\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.144s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-9\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc58094766742-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-11\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.150s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc58094766742-12\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.123s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc58094766742-13\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.025s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<p>性能还行， Compile时间和c++/go比就太low了。</p>\n<p>7.最后出场的当然是一直大紫大红的javascript，不，准确说是Nodejs(这玩意和java真tmd没半毛钱关系)</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc5c507199219\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction fibonacci(i){\r\n    if(i&lt;2) return i;\r\n    return fibonacci(i-2) + fibonacci(i-1);\r\n}\r\nconsole.log(fibonacci(34))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5c507199219-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc5c507199219-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5c507199219-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc5c507199219-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5c507199219-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc5c507199219-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc5c507199219-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc5c507199219-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc5c507199219-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc5c507199219-5\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>结果：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be625fc5f124747730\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqiangjian@localhost:/works/learnCPP$ node -v &amp;&amp; time node  fib.js \r\nv6.10.0\r\n5702887\r\n\r\nreal    0m0.332s\r\nuser    0m0.161s\r\nsys     0m0.062s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5f124747730-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc5f124747730-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5f124747730-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc5f124747730-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5f124747730-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be625fc5f124747730-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be625fc5f124747730-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be625fc5f124747730-1\"><span class=\"crayon-v\">qiangjian</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">works</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">learnCPP</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">node  </span><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc5f124747730-2\"><span class=\"crayon-v\">v6</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">10.0</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc5f124747730-3\"><span class=\"crayon-cn\">5702887</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc5f124747730-4\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be625fc5f124747730-5\"><span class=\"crayon-i\">real</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.332s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be625fc5f124747730-6\"><span class=\"crayon-i\">user</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0m0.161s</span></div><div class=\"crayon-line\" id=\"crayon-58e2be625fc5f124747730-7\"><span class=\"crayon-i\">sys</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0m0.062s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>结果还是令人震惊的，竟然只有TMD 0.3s，一共也不到0.5s，几乎接近java了， 但这代码量、维护性的优势还真得多感谢Google爹、Chromium爹的V8儿子以及开源社区。</p>\n<p>如果Nodejs真的运行得稳定了， 不准真能一统“程序江湖”， 当然我只是说说，不要太认真。</p>\n<p>来张图中吧：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/4b81d6bd0104d1d775bb019221e44b23.png\" alt=\"\"></p>\n<p>总结：</p>\n<p>感觉每种language都不同用途，性能只是一个很单一的指标，我本人比较看重的是：可阅读性、可维护性、可移植性、健壮性、扩展性，然后是性能。 而且现代硬件越来越牛逼，动不动手机就8个G，cpu赶上5年前的PC的cpu了，ssd普及化…。 本人比较看好Golang/php/python，也关注现代的C++，如14、17, 至于rust、swift、java、scala就算了，这主要和个人的需要、公司技术栈相关。哈哈！ 先写这么多吧！</p>\n<p><a href=\"http://www.cnblogs.com/sunsky303/p/6605148.html\" target=\"_blank\">续集更新</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87559\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87559votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87559\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/4b81d6bd0104d1d775bb019221e44b23.png"], "title": "2017年的golang、python、php、c++、c、java、Nodejs性能对比", "fav_nums": 0}
{"praise_nums": 1, "front_image_path": "full/a6d031713da6a85b0c6d6390db2c13c7de0b75fd.jpg", "tags": "", "comment_nums": 1, "url_object_id": "ebdca57f05d82fd7145ce041a2f127c3", "url": "http://python.jobbole.com/87562/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/lyrichu/p/6635798.html\">lyrichu</a>   </div><p>最近在研究文本挖掘相关的内容，所谓巧妇难为无米之炊，要想进行文本分析，首先得到有文本吧。获取文本的方式有很多，比如从网上下载现成的文本文档，或者通过第三方提供的API进行获取数据。但是有的时候我们想要的数据并不能直接获取，因为并不提供直接的下载渠道或者API供我们获取数据。那么这个时候该怎么办呢？有一种比较好的办法是通过网络爬虫，即编写计算机程序伪装成用户去获得想要的数据。利用计算机的高效，我们可以轻松快速地获取数据。</p>\n<p>那么该如何写一个爬虫呢？有很多种语言都可以写爬虫，比如Java，php,python 等，我个人比较喜欢使用python。因为python不仅有着内置的功能强大的网络库，还有诸多优秀的第三方库，别人直接造好了轮子，我们直接拿过来用就可以了，这为写爬虫带来了极大的方便。不夸张地说，使用不到10行python代码其实就可以写一个小小的爬虫，而使用其他的语言可以要多写很多代码，简洁易懂正是python的巨大的优势。</p>\n<p>好了废话不多说，进入今天的正题。最近几年网易云音乐火了起来，我自己就是网易云音乐的用户，用了几年了。以前用的是QQ音乐和酷狗，通过我自己的亲身经历来看，我觉得网易云音乐最优特色的就是其精准的歌曲推荐和独具特色的用户评论（郑重声明！！！这不是软文，非广告！！！仅代表个人观点，非喜勿喷！）。经常一首歌曲下面会有一些被点赞众多的神评论。加上前些日子网易云音乐将精选用户评论搬上了地铁，网易云音乐的评论又火了一把。所以我想对网易云的评论进行分析，发现其中的规律，特别是分析一些热评具有什么共同的特点。带着这个目的，我开始了对网易云评论的抓取工作。</p>\n<p>python内置了两个网络库urllib和urllib2，但是这两个库使用起来不是特别方便，所以在这里我们使用一个广受好评的第三方库requests。使用requests只用很少的几行代码就可以实现设置代理，模拟登陆等比较复杂的爬虫工作。如果已经安装pip的话，直接使用pip install requests 即可安装。中文文档地址在此http://docs.python-requests.org/zh_CN/latest/user/quickstart.html，大家有什么问题可以自行参考官方文档，上面会有非常详细的介绍。至于urllib和urllib2这两个库也是比较有用的，以后如果有机会我会再给大家介绍一下。</p>\n<p>在正式开始介绍爬虫之前，首先来说一下爬虫的基本工作原理，我们知道我们打开浏览器访问某个网址本质上是向服务器发送了一定的请求，服务器在收到我们的请求之后，会根据我们的请求返回数据，然后通过浏览器将这些数据解析好，呈现在我们的面前。如果我们使用代码的话，就要跳过浏览器的这个步骤，直接向服务器发送一定的数据，然后再取回服务器返回的数据，提取出我们想要的信息。但是问题是，有的时候服务器需要对我们发送的请求进行校验，如果它认为我们的请求是非法的，就会不返回数据，或者返回错误的数据。所以为了避免发生这种情况，我们有的时候需要把程序伪装成一个正常的用户，以便顺利得到服务器的回应。如何伪装呢？这就要看用户通过浏览器访问一个网页与我们通过程序访问一个网页之间的区别。通常来说，我们通过浏览器访问一个网页，除了发送访问的url之外，还会给服务发送额外的信息，比如headers（头部信息）等，这就相当于是请求的身份证明，服务器看到了这些数据，就会知道我们是通过正常的浏览器访问的，就会乖乖地返回数据给我们了。所以我们程序就得像浏览器一样，在发送请求的时候，带上这些标志着我们身份的信息，这样就能顺利拿到数据。有的时候，我们必须在登录状态下才能得到一些数据，所以我们必须要模拟登录。本质上来说，通过浏览器登录就是post一些表单信息给服务器（包括用户名，密码等信息），服务器校验之后我们就可以顺利登录了，利用程序也是一样，浏览器post什么数据，我们原样发送就可以了。关于模拟登录，我后面会专门介绍一下。当然事情有的时候也不会这么顺利，因为有些网站设置了反爬措施，比如如果访问过快，有时候会被封ip（典型的比如豆瓣）。这个时候我们还得要设置代理服务器，即变更我们的ip地址，如果一个ip被封了，就换另外一个ip，具体怎么做，这些话题以后慢慢再说。</p>\n<p>最后，再介绍一个我认为在写爬虫过程中非常有用的一个小技巧。如果你在使用火狐浏览器或者chrome的话，也许你会注意到有一个叫作开发者工具（chrome）或者web控制台（firefox）的地方。这个工具非常有用，因为利用它，我们可以清楚地看到在访问一个网站的过程中，浏览器到底发送了什么信息，服务器究竟返回了什么信息，这些信息是我们写爬虫的关键所在。下面你就会看到它的巨大用处。</p>\n<p>————————————————————–正式开始的分割线————————————————————————</p>\n<p>首先打开网易云音乐的网页版，随便选择一首歌曲打开它的网页，这里我以周杰伦的《晴天》为例。如下图1</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/14a30af461374016aa470e86658e215a.png\" alt=\"\" width=\"879\" height=\"413\"></p>\n<p style=\"text-align: center\">图1</p>\n<p>接下来打开web控制台(chrom的话打开开发者工具，如果是其他浏览器应该也是类似)，如下图2</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/11da4553b34b7b5394217fe93cb77cef.png\" alt=\"\" width=\"386\" height=\"342\"></p>\n<p style=\"text-align: center\">图2</p>\n<p>然后这个时候我们需要点选网络，清除所有的信息，然后点击重新发送(相当于是刷新浏览器),这样我们就可以直观看到浏览器发送了什么信息以及服务器回应了什么信息。如下图3</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/b78ac182c20bc089defaca8864bac113.png\" alt=\"\" width=\"716\" height=\"267\"></p>\n<p style=\"text-align: center\">图3</p>\n<p>刷新之后得到的数据如下图4所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/9608982de0ff2f4e999305e86a6d22c3.png\" alt=\"\" width=\"1024\" height=\"187\"></p>\n<p style=\"text-align: center\">图4</p>\n<p>可以看到浏览器发送了非常多的信息，那么哪一个才是我们想要的呢？这里我们可以通过状态码做一个初步的判断，status code（状态码）标志了服务器请求的状态，这里状态码为200即表示请求正常，而304则表示不正常（状态码种类非常多，如果要想详细了解可以自行搜索，这里不说304具体的含义了）。所以我们一般只用看状态码为200的请求就可以了，还有就是，我们可以通过右边栏的预览来粗略观察服务器返回了什么信息（或者查看响应）。如下图5所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/8d78e34b4493fc5b7113c571ce8504ca.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图5</p>\n<p>通过这两种方法结合一般我们就可以快速找到我们想要分析的请求。注意图5中的请求网址一栏即是我们想要请求的网址，请求的方法有两种：get和post，还有一个需要重点关注的就是请求头，里面包含了user-Agent（客户端信息），refrence（从何处跳转过来）等多种信息，一般无论是get还是post方法我们都会把头部信息带上。头部信息如下图6所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/7b1a331cce6c12e95df49eb86dd1ea68.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图6</p>\n<p>另外还需要注意的是：get请求一般就直接把请求的参数以？parameter1=value1&amp;parameter2=value2 等这样的形式发送了，所以不需要带上额外的请求参数，而post请求则一般需要带上额外的参数，而不直接把参数放在url当中，所以有的时候我们还需要关注参数这一栏。经过仔细寻找，我们终于找到原来与评论相关的请求在http://music.163.com/weapi/v1/resource/comments/R_SO_4_186016?csrf_token=  这个请求当中，如下图7所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/6841e2135a7d3b3abb926385a488c667.png\" alt=\"\" width=\"603\" height=\"118\"></p>\n<p style=\"text-align: center\">图7</p>\n<p>点开这个请求，我们发现它是一个post请求，请求的参数有两个，一个是params，还有一个是encSecKey，这两个参数的值非常的长，感觉应该像是加密过的。如下图8所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/9c351a6529b33b254268bce3da39d232.png\" alt=\"\" width=\"461\" height=\"112\"></p>\n<p style=\"text-align: center\">图8</p>\n<p>服务器返回的和评论相关的数据为json格式的，里面含有非常丰富的信息（比如有关评论者的信息，评论日期，点赞数，评论内容等等），如下图9所示：（其实hotComments为热门评论，comments为评论数组）<img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/869af4a2476c4eac8c6964b9b8d44b99.png\" alt=\"\" width=\"179\" height=\"193\"></p>\n<p style=\"text-align: center\">图9</p>\n<p>至此，我们已经确定了方向了，即只需要确定params和encSecKey这两个参数值即可，这个问题困扰了我一下午，我弄了很久也没有搞清楚这两个参数的加密方式，但是我发现了一个规律，http://music.163.com/weapi/v1/resource/comments/R_SO_4_186016?csrf_token= 中 R_SO_4_后面的数字就是这首歌的id值，而对于不同的歌曲的param和encSecKey值，如果把一首歌比如A的这两个参数值传给B这首歌，那么对于相同的页数，这种参数是通用的，即A的第一页的两个参数值传给其他任何一首歌的两个参数，都可以获得相应歌曲的第一页的评论，对于第二页，第三页等也是类似。但是遗憾的是，不同的页数参数是不同的，这种办法只能抓取有限的几页（当然抓取评论总数和热门评论已经足够了），如果要想抓取全部数据，就必须搞明白这两个参数值的加密方式。以为没有搞明白，昨天晚上我带着这个问题去知乎搜索了一下，居然真的被我找到了答案。在这个问题https://www.zhihu.com/question/36081767 下，@平胸小仙女 这位知友详细说明了如何破解这两个参数的加密过程，我研究了一下，发现还是有点小复杂的，按照他写的方法，我改动了一下，就成功得到了全部的评论。这里要对@平胸小仙女（个人主页 https://www.zhihu.com/people/luocaodan/answers）表示感谢。如果大家对于破解参数加密有兴趣的话，可以去直接参考原帖，地址是：https://www.zhihu.com/question/36081767。</p>\n<p>到此为止，如何抓取网易云音乐的评论全部数据就全部讲完了。按照惯例，最后上代码，亲测有效：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c83a5f1bf585190567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python2.7\r\n# -*- coding: utf-8 -*-\r\n# &lt;a href=\"http://www.jobbole.com/members/dai745726163\"&gt;@Time&lt;/a&gt;   : 2017/3/28 8:46\r\n# @Author : Lyrichu\r\n# &lt;a href=\"http://www.jobbole.com/members/Email\"&gt;@Email&lt;/a&gt;  : 919987476@qq.com\r\n# @File   : NetCloud_spider3.py\r\n'''\r\n@Description:\r\n网易云音乐评论爬虫，可以完整爬取整个评论\r\n部分参考了@平胸小仙女的文章(地址:https://www.zhihu.com/question/36081767)\r\npost加密部分也给出了，可以参考原帖：\r\n作者：平胸小仙女\r\n链接：https://www.zhihu.com/question/36081767/answer/140287795\r\n来源：知乎\r\n'''\r\nfrom Crypto.Cipher import AES\r\nimport base64\r\nimport requests\r\nimport json\r\nimport codecs\r\nimport time\r\n\r\n# 头部信息\r\nheaders = {\r\n    'Host':\"music.163.com\",\r\n    'Accept-Language':\"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3\",\r\n    'Accept-Encoding':\"gzip, deflate\",\r\n    'Content-Type':\"application/x-www-form-urlencoded\",\r\n    'Cookie':\"_ntes_nnid=754361b04b121e078dee797cdb30e0fd,1486026808627; _ntes_nuid=754361b04b121e078dee797cdb30e0fd; JSESSIONID-WYYY=yfqt9ofhY%5CIYNkXW71TqY5OtSZyjE%2FoswGgtl4dMv3Oa7%5CQ50T%2FVaee%2FMSsCifHE0TGtRMYhSPpr20i%5CRO%2BO%2B9pbbJnrUvGzkibhNqw3Tlgn%5Coil%2FrW7zFZZWSA3K9gD77MPSVH6fnv5hIT8ms70MNB3CxK5r3ecj3tFMlWFbFOZmGw%5C%3A1490677541180; _iuqxldmzr_=32; vjuids=c8ca7976.15a029d006a.0.51373751e63af8; vjlast=1486102528.1490172479.21; __gads=ID=a9eed5e3cae4d252:T=1486102537:S=ALNI_Mb5XX2vlkjsiU5cIy91-ToUDoFxIw; vinfo_n_f_l_n3=411a2def7f75a62e.1.1.1486349441669.1486349607905.1490173828142; P_INFO=m15527594439@163.com|1489375076|1|study|00&amp;99|null&amp;null&amp;null#hub&amp;420100#10#0#0|155439&amp;1|study_client|15527594439@163.com; NTES_CMT_USER_INFO=84794134%7Cm155****4439%7Chttps%3A%2F%2Fsimg.ws.126.net%2Fe%2Fimg5.cache.netease.com%2Ftie%2Fimages%2Fyun%2Fphoto_default_62.png.39x39.100.jpg%7Cfalse%7CbTE1NTI3NTk0NDM5QDE2My5jb20%3D; usertrack=c+5+hljHgU0T1FDmA66MAg==; Province=027; City=027; _ga=GA1.2.1549851014.1489469781; __utma=94650624.1549851014.1489469781.1490664577.1490672820.8; __utmc=94650624; __utmz=94650624.1490661822.6.2.utmcsr=baidu|utmccn=(organic)|utmcmd=organic; playerid=81568911; __utmb=94650624.23.10.1490672820\",\r\n    'Connection':\"keep-alive\",\r\n    'Referer':'http://music.163.com/'\r\n}\r\n# 设置代理服务器\r\nproxies= {\r\n            'http:':'http://121.232.146.184',\r\n            'https:':'https://144.255.48.197'\r\n        }\r\n\r\n# offset的取值为:(评论页数-1)*20,total第一页为true，其余页为false\r\n# first_param = '{rid:\"\", offset:\"0\", total:\"true\", limit:\"20\", csrf_token:\"\"}' # 第一个参数\r\nsecond_param = \"010001\" # 第二个参数\r\n# 第三个参数\r\nthird_param = \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\r\n# 第四个参数\r\nforth_param = \"0CoJUm6Qyw8W8jud\"\r\n\r\n# 获取参数\r\ndef get_params(page): # page为传入页数\r\n    iv = \"0102030405060708\"\r\n    first_key = forth_param\r\n    second_key = 16 * 'F'\r\n    if(page == 1): # 如果为第一页\r\n        first_param = '{rid:\"\", offset:\"0\", total:\"true\", limit:\"20\", csrf_token:\"\"}'\r\n        h_encText = AES_encrypt(first_param, first_key, iv)\r\n    else:\r\n        offset = str((page-1)*20)\r\n        first_param = '{rid:\"\", offset:\"%s\", total:\"%s\", limit:\"20\", csrf_token:\"\"}' %(offset,'false')\r\n        h_encText = AES_encrypt(first_param, first_key, iv)\r\n    h_encText = AES_encrypt(h_encText, second_key, iv)\r\n    return h_encText\r\n\r\n# 获取 encSecKey\r\ndef get_encSecKey():\r\n    encSecKey = \"257348aecb5e556c066de214e531faadd1c55d814f9be95fd06d6bff9f4c7a41f831f6394d5a3fd2e3881736d94a02ca919d952872e7d0a50ebfa1769a7a62d512f5f1ca21aec60bc3819a9c3ffca5eca9a0dba6d6f7249b06f5965ecfff3695b54e1c28f3f624750ed39e7de08fc8493242e26dbc4484a01c76f739e135637c\"\r\n    return encSecKey\r\n\r\n\r\n# 解密过程\r\ndef AES_encrypt(text, key, iv):\r\n    pad = 16 - len(text) % 16\r\n    text = text + pad * chr(pad)\r\n    encryptor = AES.new(key, AES.MODE_CBC, iv)\r\n    encrypt_text = encryptor.encrypt(text)\r\n    encrypt_text = base64.b64encode(encrypt_text)\r\n    return encrypt_text\r\n\r\n# 获得评论json数据\r\ndef get_json(url, params, encSecKey):\r\n    data = {\r\n         \"params\": params,\r\n         \"encSecKey\": encSecKey\r\n    }\r\n    response = requests.post(url, headers=headers, data=data,proxies = proxies)\r\n    return response.content\r\n\r\n# 抓取热门评论，返回热评列表\r\ndef get_hot_comments(url):\r\n    hot_comments_list = []\r\n    hot_comments_list.append(u\"用户ID 用户昵称 用户头像地址 评论时间 点赞总数 评论内容\\n\")\r\n    params = get_params(1) # 第一页\r\n    encSecKey = get_encSecKey()\r\n    json_text = get_json(url,params,encSecKey)\r\n    json_dict = json.loads(json_text)\r\n    hot_comments = json_dict['hotComments'] # 热门评论\r\n    print(\"共有%d条热门评论!\" % len(hot_comments))\r\n    for item in hot_comments:\r\n            comment = item['content'] # 评论内容\r\n            likedCount = item['likedCount'] # 点赞总数\r\n            comment_time = item['time'] # 评论时间(时间戳)\r\n            userID = item['user']['userID'] # 评论者id\r\n            nickname = item['user']['nickname'] # 昵称\r\n            avatarUrl = item['user']['avatarUrl'] # 头像地址\r\n            comment_info = userID + \" \" + nickname + \" \" + avatarUrl + \" \" + comment_time + \" \" + likedCount + \" \" + comment + u\"\\n\"\r\n            hot_comments_list.append(comment_info)\r\n    return hot_comments_list\r\n\r\n# 抓取某一首歌的全部评论\r\ndef get_all_comments(url):\r\n    all_comments_list = [] # 存放所有评论\r\n    all_comments_list.append(u\"用户ID 用户昵称 用户头像地址 评论时间 点赞总数 评论内容\\n\") # 头部信息\r\n    params = get_params(1)\r\n    encSecKey = get_encSecKey()\r\n    json_text = get_json(url,params,encSecKey)\r\n    json_dict = json.loads(json_text)\r\n    comments_num = int(json_dict['total'])\r\n    if(comments_num % 20 == 0):\r\n        page = comments_num / 20\r\n    else:\r\n        page = int(comments_num / 20) + 1\r\n    print(\"共有%d页评论!\" % page)\r\n    for i in range(page):  # 逐页抓取\r\n        params = get_params(i+1)\r\n        encSecKey = get_encSecKey()\r\n        json_text = get_json(url,params,encSecKey)\r\n        json_dict = json.loads(json_text)\r\n        if i == 0:\r\n            print(\"共有%d条评论!\" % comments_num) # 全部评论总数\r\n        for item in json_dict['comments']:\r\n            comment = item['content'] # 评论内容\r\n            likedCount = item['likedCount'] # 点赞总数\r\n            comment_time = item['time'] # 评论时间(时间戳)\r\n            userID = item['user']['userId'] # 评论者id\r\n            nickname = item['user']['nickname'] # 昵称\r\n            avatarUrl = item['user']['avatarUrl'] # 头像地址\r\n            comment_info = unicode(userID) + u\" \" + nickname + u\" \" + avatarUrl + u\" \" + unicode(comment_time) + u\" \" + unicode(likedCount) + u\" \" + comment + u\"\\n\"\r\n            all_comments_list.append(comment_info)\r\n        print(\"第%d页抓取完毕!\" % (i+1))\r\n    return all_comments_list\r\n\r\n\r\n# 将评论写入文本文件\r\ndef save_to_file(list,filename):\r\n        with codecs.open(filename,'a',encoding='utf-8') as f:\r\n            f.writelines(list)\r\n        print(\"写入文件成功!\")\r\n\r\nif __name__ == \"__main__\":\r\n    start_time = time.time() # 开始时间\r\n    url = \"http://music.163.com/weapi/v1/resource/comments/R_SO_4_186016/?csrf_token=\"\r\n    filename = u\"晴天.txt\"\r\n    all_comments_list = get_all_comments(url)\r\n    save_to_file(all_comments_list,filename)\r\n    end_time = time.time() #结束时间\r\n    print(\"程序耗时%f秒.\" % (end_time - start_time))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-58e2c83a5f1bf585190567-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c83a5f1bf585190567-154\">154</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-1\"><span class=\"crayon-p\">#!/usr/bin/env python2.7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-2\"><span class=\"crayon-p\"># -*- coding: utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-3\"><span class=\"crayon-p\"># &lt;a href=\"http://www.jobbole.com/members/dai745726163\"&gt;@Time&lt;/a&gt;   : 2017/3/28 8:46</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-4\"><span class=\"crayon-p\"># @Author : Lyrichu</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-5\"><span class=\"crayon-p\"># &lt;a href=\"http://www.jobbole.com/members/Email\"&gt;@Email&lt;/a&gt;  : 919987476@qq.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-6\"><span class=\"crayon-p\"># @File   : NetCloud_spider3.py</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-7\"><span class=\"crayon-s\">''</span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-8\"><span class=\"crayon-s\">@Description:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-9\"><span class=\"crayon-s\">网易云音乐评论爬虫，可以完整爬取整个评论</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-10\"><span class=\"crayon-s\">部分参考了@平胸小仙女的文章(地址:https://www.zhihu.com/question/36081767)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-11\"><span class=\"crayon-s\">post加密部分也给出了，可以参考原帖：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-12\"><span class=\"crayon-s\">作者：平胸小仙女</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-13\"><span class=\"crayon-s\">链接：https://www.zhihu.com/question/36081767/answer/140287795</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-14\"><span class=\"crayon-s\">来源：知乎</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-15\"><span class=\"crayon-s\">'</span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-16\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Crypto</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Cipher </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">AES</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-17\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">base64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-18\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">requests</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-19\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-20\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">codecs</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-21\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-22\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-23\"><span class=\"crayon-p\"># 头部信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-24\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Host'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"music.163.com\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept-Language'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept-Encoding'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"gzip, deflate\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"application/x-www-form-urlencoded\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Cookie'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"_ntes_nnid=754361b04b121e078dee797cdb30e0fd,1486026808627; _ntes_nuid=754361b04b121e078dee797cdb30e0fd; JSESSIONID-WYYY=yfqt9ofhY%5CIYNkXW71TqY5OtSZyjE%2FoswGgtl4dMv3Oa7%5CQ50T%2FVaee%2FMSsCifHE0TGtRMYhSPpr20i%5CRO%2BO%2B9pbbJnrUvGzkibhNqw3Tlgn%5Coil%2FrW7zFZZWSA3K9gD77MPSVH6fnv5hIT8ms70MNB3CxK5r3ecj3tFMlWFbFOZmGw%5C%3A1490677541180; _iuqxldmzr_=32; vjuids=c8ca7976.15a029d006a.0.51373751e63af8; vjlast=1486102528.1490172479.21; __gads=ID=a9eed5e3cae4d252:T=1486102537:S=ALNI_Mb5XX2vlkjsiU5cIy91-ToUDoFxIw; vinfo_n_f_l_n3=411a2def7f75a62e.1.1.1486349441669.1486349607905.1490173828142; P_INFO=m15527594439@163.com|1489375076|1|study|00&amp;99|null&amp;null&amp;null#hub&amp;420100#10#0#0|155439&amp;1|study_client|15527594439@163.com; NTES_CMT_USER_INFO=84794134%7Cm155****4439%7Chttps%3A%2F%2Fsimg.ws.126.net%2Fe%2Fimg5.cache.netease.com%2Ftie%2Fimages%2Fyun%2Fphoto_default_62.png.39x39.100.jpg%7Cfalse%7CbTE1NTI3NTk0NDM5QDE2My5jb20%3D; usertrack=c+5+hljHgU0T1FDmA66MAg==; Province=027; City=027; _ga=GA1.2.1549851014.1489469781; __utma=94650624.1549851014.1489469781.1490664577.1490672820.8; __utmc=94650624; __utmz=94650624.1490661822.6.2.utmcsr=baidu|utmccn=(organic)|utmcmd=organic; playerid=81568911; __utmb=94650624.23.10.1490672820\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Connection'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"keep-alive\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Referer'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'http://music.163.com/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-33\"><span class=\"crayon-p\"># 设置代理服务器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-34\"><span class=\"crayon-v\">proxies</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'http:'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'http://121.232.146.184'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'https:'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'https://144.255.48.197'</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-38\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-39\"><span class=\"crayon-p\"># offset的取值为:(评论页数-1)*20,total第一页为true，其余页为false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-40\"><span class=\"crayon-p\"># first_param = '{rid:\"\", offset:\"0\", total:\"true\", limit:\"20\", csrf_token:\"\"}' # 第一个参数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-41\"><span class=\"crayon-v\">second_param</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"010001\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 第二个参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-42\"><span class=\"crayon-p\"># 第三个参数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-43\"><span class=\"crayon-v\">third_param</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-44\"><span class=\"crayon-p\"># 第四个参数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-45\"><span class=\"crayon-v\">forth_param</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0CoJUm6Qyw8W8jud\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-46\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-47\"><span class=\"crayon-p\"># 获取参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-48\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_params</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># page为传入页数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">iv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0102030405060708\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">first_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">forth_param</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-51\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">second_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'F'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 如果为第一页</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">first_param</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{rid:\"\", offset:\"0\", total:\"true\", limit:\"20\", csrf_token:\"\"}'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">h_encText</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AES_encrypt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">first_param</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iv</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">first_param</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{rid:\"\", offset:\"%s\", total:\"%s\", limit:\"20\", csrf_token:\"\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'false'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">h_encText</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AES_encrypt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">first_param</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iv</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">h_encText</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AES_encrypt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">h_encText</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">second_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iv</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h_encText</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-61\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-62\"><span class=\"crayon-p\"># 获取 encSecKey</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-63\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_encSecKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"257348aecb5e556c066de214e531faadd1c55d814f9be95fd06d6bff9f4c7a41f831f6394d5a3fd2e3881736d94a02ca919d952872e7d0a50ebfa1769a7a62d512f5f1ca21aec60bc3819a9c3ffca5eca9a0dba6d6f7249b06f5965ecfff3695b54e1c28f3f624750ed39e7de08fc8493242e26dbc4484a01c76f739e135637c\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encSecKey</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-66\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-68\"><span class=\"crayon-p\"># 解密过程</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-69\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">AES_encrypt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pad</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">pad *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pad</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">encryptor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AES</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AES</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MODE_CBC</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iv</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">encrypt_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encryptor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encrypt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">encrypt_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base64</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">b64encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">encrypt_text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encrypt_text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-76\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-77\"><span class=\"crayon-p\"># 获得评论json数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-78\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-80\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">\"params\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-81\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">\"encSecKey\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encSecKey</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">proxies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proxies</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">content</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-85\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-86\"><span class=\"crayon-p\"># 抓取热门评论，返回热评列表</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-87\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_hot_comments</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hot_comments_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hot_comments_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"用户ID 用户昵称 用户头像地址 评论时间 点赞总数 评论内容\\n\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_params</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 第一页</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_encSecKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">json_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">json_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">loads</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">json_text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hot_comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'hotComments'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 热门评论</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"共有%d条热门评论!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hot_comments</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hot_comments</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 评论内容</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">likedCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'likedCount'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 点赞总数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-99\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">comment_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'time'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 评论时间(时间戳)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-100\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'userID'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 评论者id</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-101\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nickname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'nickname'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 昵称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-102\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">avatarUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'avatarUrl'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 头像地址</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-103\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">comment_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nickname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">avatarUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">likedCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"\\n\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-104\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">hot_comments_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comment_info</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-105\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hot_comments_list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-106\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-107\"><span class=\"crayon-p\"># 抓取某一首歌的全部评论</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-108\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_all_comments</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">all_comments_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 存放所有评论</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">all_comments_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"用户ID 用户昵称 用户头像地址 评论时间 点赞总数 评论内容\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 头部信息</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_params</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-112\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_encSecKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-113\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">json_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">json_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">loads</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">json_text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-115\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comments_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">json_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'total'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comments_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-117\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comments_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-120\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"共有%d页评论!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-121\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 逐页抓取</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-122\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_params</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-123\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_encSecKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">json_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">encSecKey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">json_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">loads</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">json_text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-126\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-127\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"共有%d条评论!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments_num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 全部评论总数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'comments'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-129\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 评论内容</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">likedCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'likedCount'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 点赞总数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-131\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">comment_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'time'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 评论时间(时间戳)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-132\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'userId'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 评论者id</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-133\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nickname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'nickname'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 昵称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-134\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">avatarUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'avatarUrl'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 头像地址</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-135\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">comment_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unicode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userID</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nickname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">avatarUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unicode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comment_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unicode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">likedCount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"\\n\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-136\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">all_comments_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comment_info</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-137\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"第%d页抓取完毕!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">all_comments_list</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-139\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-140\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-141\"><span class=\"crayon-p\"># 将评论写入文本文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-142\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">save_to_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">codecs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-144\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">writelines</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"写入文件成功!\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-146\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-147\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-148\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 开始时间</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://music.163.com/weapi/v1/resource/comments/R_SO_4_186016/?csrf_token=\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-150\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">\"晴天.txt\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-151\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">all_comments_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_all_comments</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-152\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">save_to_file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">all_comments_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c83a5f1bf585190567-153\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">end_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#结束时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c83a5f1bf585190567-154\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"程序耗时%f秒.\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">end_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0204 seconds] -->\r\n\n</div>\n<p>我利用上述代码跑了一下，抓了两首周杰伦的热门歌曲《晴天》（有130多万评论）和《告白气球》（有20多万评论），前者跑了大概有20多分钟，后者有6600多秒（也就是将近2个小时），截图如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/d6af7581230122ea1a8acb5e4728c643.png\" alt=\"\" width=\"283\" height=\"97\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/23867b7c8639cd5dc12015cfd14bc865.png\" alt=\"\" width=\"898\" height=\"479\"></p>\n<p>注意我是按照空格来分隔的，每一行分别有用户ID 用户昵称 用户头像地址 评论时间 点赞总数 评论内容 这些内容。我将这两个txt文件上传到百度云了，对数据感兴趣的同学可以直接下载进行文本分析，地址为：《晴天》（http://pan.baidu.com/s/1boBglfp），《告白气球》（http://pan.baidu.com/s/1o8O7k1s），或者自己跑一下代码抓取一下也是可以的（注意不要开太多线程给网易云的服务器太大压力哦~~中间有一段时间服务器返回数据特别慢，不知道是不是限制访问了，后来又好了）。我后面也许会自己去对评论数据进行可视化分析，敬请期待！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87562\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87562votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87562\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "title": "Python 获取网易云音乐热门评论", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/af4571ab68e7f3066d3aadf08de9928f8d6c901b.jpg", "tags": "", "comment_nums": 0, "url_object_id": "168b0224957cf0851cbefd9df95c8bd5", "url": "http://python.jobbole.com/87541/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000008814676\">adam1q84</a>   </div><p>Python 的 asyncio 类似于 C++ 的 Boost.Asio。</p>\n<p>所谓「异步 IO」，就是你发起一个 IO 操作，却不用等它结束，你可以继续做其他事情，当它结束时，你会得到通知。</p>\n<p>Asyncio 是并发（concurrency）的一种方式。对 Python 来说，并发还可以通过线程（threading）和多进程（multiprocessing）来实现。</p>\n<p>Asyncio 并不能带来真正的并行（parallelism）。当然，因为 GIL（全局解释器锁）的存在，Python 的多线程也不能带来真正的并行。</p>\n<p>可交给 asyncio 执行的任务，称为协程（coroutine）。一个协程可以放弃执行，把机会让给其它协程（即 <code>yield from</code> 或 <code>await</code>）。</p>\n<h2>定义协程</h2>\n<p>协程的定义，需要使用 <code>async def</code> 语句。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280ef3398412133\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def do_some_work(x): pass</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280ef3398412133-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280ef3398412133-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pass</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><code>do_some_work</code> 便是一个协程。<br>\n准确来说，<code>do_some_work</code> 是一个协程函数，可以通过 <code>asyncio.iscoroutinefunction</code> 来验证：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280efc744569228\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint(asyncio.iscoroutinefunction(do_some_work))  # True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280efc744569228-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280efc744569228-1\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iscoroutinefunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">do_some_work</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这个协程什么都没做，我们让它睡眠几秒，以模拟实际的工作量 ：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f00211126628\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def do_some_work(x):\r\n    print(\"Waiting \" + str(x))\r\n    await asyncio.sleep(x)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f00211126628-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f00211126628-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f00211126628-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f00211126628-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f00211126628-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Waiting \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f00211126628-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在解释 <code>await</code> 之前，有必要说明一下协程可以做哪些事。协程可以：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f03814799471\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n* 等待一个 future 结束\r\n* 等待另一个协程（产生一个结果，或引发一个异常）\r\n* 产生一个结果给正在等它的协程\r\n* 引发一个异常给正在等它的协程\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f03814799471-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f03814799471-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f03814799471-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f03814799471-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f03814799471-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f03814799471-1\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span>等待一个<span class=\"crayon-h\"> </span><span class=\"crayon-i\">future</span><span class=\"crayon-h\"> </span>结束</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f03814799471-2\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span>等待另一个协程（产生一个结果，或引发一个异常）</div><div class=\"crayon-line\" id=\"crayon-58e2be6280f03814799471-3\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span>产生一个结果给正在等它的协程</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f03814799471-4\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span>引发一个异常给正在等它的协程</div><div class=\"crayon-line\" id=\"crayon-58e2be6280f03814799471-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><code>asyncio.sleep</code> 也是一个协程，所以 <code>await asyncio.sleep(x)</code> 就是等待另一个协程。可参见 <code>asyncio.sleep</code> 的文档：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f07560016071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsleep(delay, result=None, *, loop=None)\r\nCoroutine that completes after a given time (in seconds).</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f07560016071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f07560016071-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f07560016071-1\"><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loop</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f07560016071-2\"><span class=\"crayon-e\">Coroutine </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">completes </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">given </span><span class=\"crayon-e\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h2>运行协程</h2>\n<p>调用协程函数，协程并不会开始运行，只是返回一个协程对象，可以通过 <code>asyncio.iscoroutine</code> 来验证：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f0a600776576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint(asyncio.iscoroutine(do_some_work(3)))  # True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f0a600776576-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f0a600776576-1\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iscoroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>此处还会引发一条警告：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f0d108740425\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync1.py:16: RuntimeWarning: coroutine 'do_some_work' was never awaited\r\n  print(asyncio.iscoroutine(do_some_work(3)))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f0d108740425-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f0d108740425-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f0d108740425-1\"><span class=\"crayon-v\">async1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RuntimeWarning</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">coroutine</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'do_some_work'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">never </span><span class=\"crayon-e\">awaited</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f0d108740425-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iscoroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>要让这个协程对象运行的话，有两种方式：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f10359766091\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n* 在另一个已经运行的协程中用 `await` 等待它\r\n* 通过 `ensure_future` 函数计划它的执行\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f10359766091-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f10359766091-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f10359766091-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f10359766091-1\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span>在另一个已经运行的协程中用<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">await</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span>等待它</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f10359766091-2\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span>通过<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ensure_future</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span>函数计划它的执行</div><div class=\"crayon-line\" id=\"crayon-58e2be6280f10359766091-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>简单来说，只有 loop 运行了，协程才可能运行。<br>\n下面先拿到当前线程缺省的 loop ，然后把协程对象交给 <code>loop.run_until_complete</code>，协程对象随后会在 loop 里得到运行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f13367804661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(do_some_work(3))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f13367804661-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f13367804661-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f13367804661-1\"><span class=\"crayon-v\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_event_loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f13367804661-2\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>run_until_complete</code> 是一个阻塞（blocking）调用，直到协程运行结束，它才返回。这一点从函数名不难看出。<br>\n<code>run_until_complete</code> 的参数是一个 future，但是我们这里传给它的却是协程对象，之所以能这样，是因为它在内部做了检查，通过 <code>ensure_future</code> 函数把协程对象包装（wrap）成了 future。所以，我们可以写得更明显一些：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f17660433006\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloop.run_until_complete(asyncio.ensure_future(do_some_work(3)))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f17660433006-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f17660433006-1\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>完整代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f1a710111682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport asyncio\r\n\r\nasync def do_some_work(x):\r\n    print(\"Waiting \" + str(x))\r\n    await asyncio.sleep(x)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(do_some_work(3))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f1a710111682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f1a710111682-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f1a710111682-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f1a710111682-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f1a710111682-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f1a710111682-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f1a710111682-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f1a710111682-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f1a710111682-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">asyncio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f1a710111682-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6280f1a710111682-3\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f1a710111682-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Waiting \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f1a710111682-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f1a710111682-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6280f1a710111682-7\"><span class=\"crayon-v\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_event_loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f1a710111682-8\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>运行结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f1d748771961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWaiting 3\r\n&lt;三秒钟后程序结束&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f1d748771961-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f1d748771961-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f1d748771961-1\"><span class=\"crayon-i\">Waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f1d748771961-2\"><span class=\"crayon-o\">&lt;</span>三秒钟后程序结束<span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2>回调</h2>\n<p>假如协程是一个 IO 的读操作，等它读完数据后，我们希望得到通知，以便下一步数据的处理。这一需求可以通过往 future 添加回调来实现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f20538655539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef done_callback(futu):\r\n    print('Done')\r\n\r\nfutu = asyncio.ensure_future(do_some_work(3))\r\nfutu.add_done_callback(done_callback)\r\n\r\nloop.run_until_complete(futu)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f20538655539-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f20538655539-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f20538655539-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f20538655539-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f20538655539-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f20538655539-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f20538655539-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f20538655539-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">done_callback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">futu</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f20538655539-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Done'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f20538655539-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f20538655539-4\"><span class=\"crayon-v\">futu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f20538655539-5\"><span class=\"crayon-v\">futu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_done_callback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">done_callback</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f20538655539-6\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6280f20538655539-7\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">futu</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h2>多个协程</h2>\n<p>实际项目中，往往有多个协程，同时在一个 loop 里运行。为了把多个协程交给 loop，需要借助 <code>asyncio.gather</code> 函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f23574630950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloop.run_until_complete(asyncio.gather(do_some_work(1), do_some_work(3)))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f23574630950-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f23574630950-1\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">gather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>或者先把协程存在列表里：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f27774099980\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncoros = [do_some_work(1), do_some_work(3)]\r\nloop.run_until_complete(asyncio.gather(*coros))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f27774099980-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f27774099980-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f27774099980-1\"><span class=\"crayon-v\">coros</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f27774099980-2\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">gather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">coros</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>运行结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f2a604533864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWaiting 3\r\nWaiting 1\r\n&lt;等待三秒钟&gt;\r\nDone</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f2a604533864-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f2a604533864-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f2a604533864-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f2a604533864-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f2a604533864-1\"><span class=\"crayon-i\">Waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f2a604533864-2\"><span class=\"crayon-i\">Waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f2a604533864-3\"><span class=\"crayon-o\">&lt;</span>等待三秒钟<span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f2a604533864-4\"><span class=\"crayon-v\">Done</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这两个协程是并发运行的，所以等待的时间不是 1 + 3 = 4 秒，而是以耗时较长的那个协程为准。</p>\n<p>参考函数 <code>gather</code> 的文档：</p>\n<blockquote><p>gather(*coros_or_futures, loop=None, return_exceptions=False)<br>\nReturn a future aggregating results from the given coroutines or futures.</p></blockquote>\n<p>发现也可以传 futures 给它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f2d943681802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfutus = [asyncio.ensure_future(do_some_work(1)),\r\n             asyncio.ensure_future(do_some_work(3))]\r\n\r\nloop.run_until_complete(asyncio.gather(*futus))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f2d943681802-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f2d943681802-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f2d943681802-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f2d943681802-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f2d943681802-1\"><span class=\"crayon-v\">futus</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f2d943681802-2\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f2d943681802-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f2d943681802-4\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">gather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">futus</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p><code>gather</code> 起聚合的作用，把多个 futures 包装成单个 future，因为 <code>loop.run_until_complete</code> 只接受单个 future。</p>\n<h2>run_until_complete 和 run_forever</h2>\n<p>我们一直通过 <code>run_until_complete</code> 来运行 loop ，等到 future 完成，<code>run_until_complete</code> 也就返回了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f30059143287\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def do_some_work(x):\r\n    print('Waiting ' + str(x))\r\n    await asyncio.sleep(x)\r\n    print('Done')\r\n\r\nloop = asyncio.get_event_loop()\r\n\r\ncoro = do_some_work(3)\r\nloop.run_until_complete(coro)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f30059143287-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f30059143287-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f30059143287-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f30059143287-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f30059143287-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f30059143287-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f30059143287-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f30059143287-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f30059143287-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f30059143287-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f30059143287-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Waiting '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f30059143287-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f30059143287-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Done'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f30059143287-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f30059143287-6\"><span class=\"crayon-v\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_event_loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f30059143287-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f30059143287-8\"><span class=\"crayon-v\">coro</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f30059143287-9\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">coro</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f34527392672\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWaiting 3\r\n&lt;等待三秒钟&gt;\r\nDone\r\n&lt;程序退出&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f34527392672-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f34527392672-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f34527392672-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f34527392672-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f34527392672-1\"><span class=\"crayon-i\">Waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f34527392672-2\"><span class=\"crayon-o\">&lt;</span>等待三秒钟<span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f34527392672-3\"><span class=\"crayon-v\">Done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f34527392672-4\"><span class=\"crayon-o\">&lt;</span>程序退出<span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在改用 <code>run_forever</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f37462958619\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def do_some_work(x):\r\n    print('Waiting ' + str(x))\r\n    await asyncio.sleep(x)\r\n    print('Done')\r\n\r\nloop = asyncio.get_event_loop()\r\n\r\ncoro = do_some_work(3)\r\nasyncio.ensure_future(coro)\r\n\r\nloop.run_forever()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f37462958619-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f37462958619-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f37462958619-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f37462958619-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f37462958619-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f37462958619-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f37462958619-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f37462958619-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f37462958619-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f37462958619-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f37462958619-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f37462958619-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f37462958619-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Waiting '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f37462958619-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f37462958619-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Done'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f37462958619-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f37462958619-6\"><span class=\"crayon-v\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_event_loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f37462958619-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f37462958619-8\"><span class=\"crayon-v\">coro</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f37462958619-9\"><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">coro</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f37462958619-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6280f37462958619-11\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_forever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f3a827801858\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWaiting 3\r\n&lt;等待三秒钟&gt;\r\nDone\r\n&lt;程序没有退出&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f3a827801858-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f3a827801858-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f3a827801858-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f3a827801858-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f3a827801858-1\"><span class=\"crayon-i\">Waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f3a827801858-2\"><span class=\"crayon-o\">&lt;</span>等待三秒钟<span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f3a827801858-3\"><span class=\"crayon-v\">Done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f3a827801858-4\"><span class=\"crayon-o\">&lt;</span>程序没有退出<span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>三秒钟过后，future 结束，但是程序并不会退出。<code>run_forever</code> 会一直运行，直到 <code>stop</code> 被调用，但是你不能像下面这样调 <code>stop</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f3d835747858\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloop.run_forever()\r\nloop.stop()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f3d835747858-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f3d835747858-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f3d835747858-1\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_forever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f3d835747858-2\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><code>run_forever</code> 不返回，<code>stop</code> 永远也不会被调用。所以，只能在协程中调 <code>stop</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f40531159780\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def do_some_work(loop, x):\r\n    print('Waiting ' + str(x))\r\n    await asyncio.sleep(x)\r\n    print('Done')\r\n    loop.stop()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f40531159780-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f40531159780-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f40531159780-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f40531159780-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f40531159780-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f40531159780-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f40531159780-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Waiting '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f40531159780-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f40531159780-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Done'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f40531159780-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这样并非没有问题，假如有多个协程在 loop 里运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f43295183724\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasyncio.ensure_future(do_some_work(loop, 1))\r\nasyncio.ensure_future(do_some_work(loop, 3))\r\n\r\nloop.run_forever()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f43295183724-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f43295183724-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f43295183724-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f43295183724-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f43295183724-1\"><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f43295183724-2\"><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f43295183724-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f43295183724-4\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_forever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>第二个协程没结束，loop 就停止了——被先结束的那个协程给停掉的。<br>\n要解决这个问题，可以用 <code>gather</code> 把多个协程合并成一个 future，并添加回调，然后在回调里再去停止 loop。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f47030459903\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def do_some_work(loop, x):\r\n    print('Waiting ' + str(x))\r\n    await asyncio.sleep(x)\r\n    print('Done')\r\n\r\ndef done_callback(loop, futu):\r\n    loop.stop()\r\n\r\nloop = asyncio.get_event_loop()\r\n\r\nfutus = asyncio.gather(do_some_work(loop, 1), do_some_work(loop, 3))\r\nfutus.add_done_callback(functools.partial(done_callback, loop))\r\n\r\nloop.run_forever()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f47030459903-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f47030459903-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Waiting '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Done'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">done_callback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">futu</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-8\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-9\"><span class=\"crayon-v\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_event_loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-10\"> </div><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-11\"><span class=\"crayon-v\">futus</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">gather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-12\"><span class=\"crayon-v\">futus</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_done_callback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">functools</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">partial</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">done_callback</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f47030459903-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f47030459903-14\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_forever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>其实这基本上就是 <code>run_until_complete</code> 的实现了，<code>run_until_complete</code> 在内部也是调用 <code>run_forever</code>。</p>\n<h2>Close Loop?</h2>\n<p>以上示例都没有调用 <code>loop.close</code>，好像也没有什么问题。所以到底要不要调 <code>loop.close</code> 呢？<br>\n简单来说，loop 只要不关闭，就还可以再运行。：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f4a442737988\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloop.run_until_complete(do_some_work(loop, 1))\r\nloop.run_until_complete(do_some_work(loop, 3))\r\nloop.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f4a442737988-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f4a442737988-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f4a442737988-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f4a442737988-1\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f4a442737988-2\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f4a442737988-3\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>但是如果关闭了，就不能再运行了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f4d589800732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloop.run_until_complete(do_some_work(loop, 1))\r\nloop.close()\r\nloop.run_until_complete(do_some_work(loop, 3))  # 此处异常</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f4d589800732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f4d589800732-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f4d589800732-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f4d589800732-1\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f4d589800732-2\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f4d589800732-3\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 此处异常</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>建议调用 <code>loop.close</code>，以彻底清理 loop 对象防止误用。</p>\n<h2>gather vs. wait</h2>\n<p><code>asyncio.gather</code> 和 <code>asyncio.wait</code> 功能相似。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f51932627389\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncoros = [do_some_work(loop, 1), do_some_work(loop, 3)]\r\nloop.run_until_complete(asyncio.wait(coros))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f51932627389-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f51932627389-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f51932627389-1\"><span class=\"crayon-v\">coros</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_some_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f51932627389-2\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">coros</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>具体差别可请参见 StackOverflow 的讨论：<a href=\"http://stackoverflow.com/questions/42231161/asyncio-gather-vs-asyncio-wait\">Asyncio.gather vs asyncio.wait</a>。</p>\n<h2>Timer</h2>\n<p>C++ Boost.Asio 提供了 IO 对象 timer，但是 Python 并没有原生支持 timer，不过可以用 <code>asyncio.sleep</code> 模拟。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2be6280f5f097972197\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync def timer(x, cb):\r\n    futu = asyncio.ensure_future(asyncio.sleep(x))\r\n    futu.add_done_callback(cb)\r\n    await futu\r\n\r\nt = timer(3, lambda futu: print('Done'))\r\nloop.run_until_complete(t)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f5f097972197-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f5f097972197-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f5f097972197-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f5f097972197-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f5f097972197-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2be6280f5f097972197-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2be6280f5f097972197-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2be6280f5f097972197-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">timer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f5f097972197-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">futu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensure_future</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">asyncio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f5f097972197-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">futu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_done_callback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f5f097972197-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-i\">futu</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f5f097972197-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2be6280f5f097972197-6\"><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lambda </span><span class=\"crayon-v\">futu</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Done'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2be6280f5f097972197-7\"><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run_until_complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>第一部分完。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87541\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87541votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87541\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "title": "Python 的异步 IO：Asyncio 简介（一）", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/a6d031713da6a85b0c6d6390db2c13c7de0b75fd.jpg", "tags": "", "comment_nums": 0, "url_object_id": "f5d5f20f0aeb82ebfbfd234ffdf17236", "url": "http://python.jobbole.com/87538/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://iamtrask.github.io/2015/11/15/anyone-can-code-lstm/\">@iamtrask</a>   译文出处：<a target=\"_blank\" href=\"http://magicly.me/2017/03/09/iamtrask-anyone-can-code-lstm/\">谦谦君子</a>   </div><h1 id=\"概要\">概要</h1>\n<p>我通过玩具代码一边学习一边调试能达到最好的学习效果。本文通过一个简单的python实现，教会你循环神经网络。</p>\n<p>原文作者<a href=\"https://twitter.com/iamtrask\" target=\"_blank\" rel=\"external\">@iamtrask</a>说他会在twitter上继续发布第二部分LSTM，敬请关注。</p>\n<h1 id=\"废话少说，-给我看看代码\">废话少说， 给我看看代码</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0da2477863925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport copy, numpy as np\r\nnp.random.seed(0) #固定随机数生成器的种子，便于得到固定的输出，【译者注：完全是为了方便调试用的]\r\n# compute sigmoid nonlinearity\r\ndef sigmoid(x): #激活函数\r\n    output = 1/(1+np.exp(-x))\r\n    return output\r\n# convert output of sigmoid function to its derivative\r\ndef sigmoid_output_to_derivative(output):#激活函数的导数\r\n    return output*(1-output)\r\n# training dataset generation\r\nint2binary = {} #整数到其二进制表示的映射\r\nbinary_dim = 8 #暂时制作256以内的加法， 可以调大\r\n## 以下5行代码计算0-256的二进制表示\r\nlargest_number = pow(2,binary_dim)\r\nbinary = np.unpackbits(\r\n    np.array([range(largest_number)],dtype=np.uint8).T,axis=1)\r\nfor i in range(largest_number):\r\n    int2binary[i] = binary[i]\r\n# input variables\r\nalpha = 0.1 #学习速率\r\ninput_dim = 2 #因为我们是做两个数相加，每次会喂给神经网络两个bit，所以输入的维度是2\r\nhidden_dim = 16 #隐藏层的神经元节点数，远比理论值要大（译者注：理论上而言，应该一个节点就可以记住有无进位了，但我试了发现4的时候都没法收敛），你可以自己调整这个数，看看调大了是容易更快地收敛还是更慢\r\noutput_dim = 1 #我们的输出是一个数，所以维度为1\r\n# initialize neural network weights\r\nsynapse_0 = 2*np.random.random((input_dim,hidden_dim)) - 1 #输入层到隐藏层的转化矩阵，维度为2*16， 2是输入维度，16是隐藏层维度\r\nsynapse_1 = 2*np.random.random((hidden_dim,output_dim)) - 1\r\nsynapse_h = 2*np.random.random((hidden_dim,hidden_dim)) - 1\r\n# 译者注：np.random.random产生的是[0,1)的随机数，2 * [0, 1) - 1 =&gt; [-1, 1)，\r\n# 是为了有正有负更快地收敛，这涉及到如何初始化参数的问题，通常来说都是靠“经验”或者说“启发式规则”，说得直白一点就是“蒙的”！机器学习里面，超参数的选择，大部分都是这种情况，哈哈。。。\r\n# 我自己试了一下用【0, 2)之间的随机数，貌似不能收敛，用[0,1)就可以，呵呵。。。\r\n# 以下三个分别对应三个矩阵的变化\r\nsynapse_0_update = np.zeros_like(synapse_0)\r\nsynapse_1_update = np.zeros_like(synapse_1)\r\nsynapse_h_update = np.zeros_like(synapse_h)\r\n# training logic\r\n# 学习10000个例子\r\nfor j in range(100000):\r\n    \r\n    # 下面6行代码，随机产生两个0-128的数字，并查出他们的二进制表示。为了避免相加之和超过256，这里选择两个0-128的数字\r\n    # generate a simple addition problem (a + b = c)\r\n    a_int = np.random.randint(largest_number/2) # int version\r\n    a = int2binary[a_int] # binary encoding\r\n    b_int = np.random.randint(largest_number/2) # int version\r\n    b = int2binary[b_int] # binary encoding\r\n    # true answer\r\n    c_int = a_int + b_int\r\n    c = int2binary[c_int]\r\n    \r\n    # where we'll store our best guess (binary encoded)\r\n    # 存储神经网络的预测值\r\n    d = np.zeros_like(c)\r\n    overallError = 0 #每次把总误差清零\r\n    \r\n    layer_2_deltas = list() #存储每个时间点输出层的误差\r\n    layer_1_values = list() #存储每个时间点隐藏层的值\r\n    layer_1_values.append(np.zeros(hidden_dim)) #一开始没有隐藏层，所以里面都是0\r\n    \r\n    # moving along the positions in the binary encoding\r\n    for position in range(binary_dim):#循环遍历每一个二进制位\r\n        \r\n        # generate input and output\r\n        X = np.array([[a[binary_dim - position - 1],b[binary_dim - position - 1]]])#从右到左，每次去两个输入数字的一个bit位\r\n        y = np.array([[c[binary_dim - position - 1]]]).T#正确答案\r\n        # hidden layer (input ~+ prev_hidden)\r\n        layer_1 = sigmoid(np.dot(X,synapse_0) + np.dot(layer_1_values[-1],synapse_h))#（输入层 + 之前的隐藏层） -&gt; 新的隐藏层，这是体现循环神经网络的最核心的地方！！！\r\n        # output layer (new binary representation)\r\n        layer_2 = sigmoid(np.dot(layer_1,synapse_1)) #隐藏层 * 隐藏层到输出层的转化矩阵synapse_1 -&gt; 输出层\r\n        # did we miss?... if so, by how much?\r\n        layer_2_error = y - layer_2 #预测误差是多少\r\n        layer_2_deltas.append((layer_2_error)*sigmoid_output_to_derivative(layer_2)) #我们把每一个时间点的误差导数都记录下来\r\n        overallError += np.abs(layer_2_error[0])#总误差\r\n    \r\n        # decode estimate so we can print it out\r\n        d[binary_dim - position - 1] = np.round(layer_2[0][0]) #记录下每一个预测bit位\r\n        \r\n        # store hidden layer so we can use it in the next timestep\r\n        layer_1_values.append(copy.deepcopy(layer_1))#记录下隐藏层的值，在下一个时间点用\r\n    \r\n    future_layer_1_delta = np.zeros(hidden_dim)\r\n    \r\n    #前面代码我们完成了所有时间点的正向传播以及计算最后一层的误差，现在我们要做的是反向传播，从最后一个时间点到第一个时间点\r\n    for position in range(binary_dim):\r\n        \r\n        X = np.array([[a[position],b[position]]]) #最后一次的两个输入\r\n        layer_1 = layer_1_values[-position-1] #当前时间点的隐藏层\r\n        prev_layer_1 = layer_1_values[-position-2] #前一个时间点的隐藏层\r\n        \r\n        # error at output layer\r\n        layer_2_delta = layer_2_deltas[-position-1] #当前时间点输出层导数\r\n        # error at hidden layer\r\n        # 通过后一个时间点（因为是反向传播）的隐藏层误差和当前时间点的输出层误差，计算当前时间点的隐藏层误差\r\n        layer_1_delta = (future_layer_1_delta.dot(synapse_h.T) + layer_2_delta.dot(synapse_1.T)) * sigmoid_output_to_derivative(layer_1)\r\n        # let's update all our weights so we can try again\r\n        # 我们已经完成了当前时间点的反向传播误差计算， 可以构建更新矩阵了。但是我们并不会现在就更新权重矩阵，因为我们还要用他们计算前一个时间点的更新矩阵呢。\r\n        # 所以要等到我们完成了所有反向传播误差计算， 才会真正的去更新权重矩阵，我们暂时把更新矩阵存起来。\r\n        # 可以看这里了解更多关于反向传播的知识http://iamtrask.github.io/2015/07/12/basic-python-network/\r\n        synapse_1_update += np.atleast_2d(layer_1).T.dot(layer_2_delta)\r\n        synapse_h_update += np.atleast_2d(prev_layer_1).T.dot(layer_1_delta)\r\n        synapse_0_update += X.T.dot(layer_1_delta)\r\n        \r\n        future_layer_1_delta = layer_1_delta\r\n    \r\n    # 我们已经完成了所有的反向传播，可以更新几个转换矩阵了。并把更新矩阵变量清零\r\n    synapse_0 += synapse_0_update * alpha\r\n    synapse_1 += synapse_1_update * alpha\r\n    synapse_h += synapse_h_update * alpha\r\n    synapse_0_update *= 0\r\n    synapse_1_update *= 0\r\n    synapse_h_update *= 0\r\n    \r\n    # print out progress\r\n    if(j % 1000 == 0):\r\n        print(\"Error:\" + str(overallError))\r\n        print(\"Pred:\" + str(d))\r\n        print(\"True:\" + str(c))\r\n        out = 0\r\n        for index,x in enumerate(reversed(d)):\r\n            out += x*pow(2,index)\r\n        print(str(a_int) + \" + \" + str(b_int) + \" = \" + str(out))\r\n        print(\"------------\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0da2477863925-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0da2477863925-120\">120</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">copy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-2\"><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#固定随机数生成器的种子，便于得到固定的输出，【译者注：完全是为了方便调试用的]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-3\"><span class=\"crayon-c\"># compute sigmoid nonlinearity</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#激活函数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-7\"><span class=\"crayon-c\"># convert output of sigmoid function to its derivative</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid_output_to_derivative</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">#激活函数的导数</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-10\"><span class=\"crayon-c\"># training dataset generation</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-11\"><span class=\"crayon-v\">int2binary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#整数到其二进制表示的映射</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-12\"><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#暂时制作256以内的加法， 可以调大</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-13\"><span class=\"crayon-c\">## 以下5行代码计算0-256的二进制表示</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-14\"><span class=\"crayon-v\">largest_number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-15\"><span class=\"crayon-v\">binary</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unpackbits</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">largest_number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">uint8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">axis</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-17\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">largest_number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">int2binary</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">binary</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-19\"><span class=\"crayon-c\"># input variables</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-20\"><span class=\"crayon-v\">alpha</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#学习速率</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-21\"><span class=\"crayon-v\">input_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#因为我们是做两个数相加，每次会喂给神经网络两个bit，所以输入的维度是2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-22\"><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#隐藏层的神经元节点数，远比理论值要大（译者注：理论上而言，应该一个节点就可以记住有无进位了，但我试了发现4的时候都没法收敛），你可以自己调整这个数，看看调大了是容易更快地收敛还是更慢</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-23\"><span class=\"crayon-v\">output_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#我们的输出是一个数，所以维度为1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-24\"><span class=\"crayon-c\"># initialize neural network weights</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-25\"><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input_dim</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#输入层到隐藏层的转化矩阵，维度为2*16， 2是输入维度，16是隐藏层维度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-26\"><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">output_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-27\"><span class=\"crayon-v\">synapse_h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-28\"><span class=\"crayon-c\"># 译者注：np.random.random产生的是[0,1)的随机数，2 * [0, 1) - 1 =&gt; [-1, 1)，</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-29\"><span class=\"crayon-c\"># 是为了有正有负更快地收敛，这涉及到如何初始化参数的问题，通常来说都是靠“经验”或者说“启发式规则”，说得直白一点就是“蒙的”！机器学习里面，超参数的选择，大部分都是这种情况，哈哈。。。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-30\"><span class=\"crayon-c\"># 我自己试了一下用【0, 2)之间的随机数，貌似不能收敛，用[0,1)就可以，呵呵。。。</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-31\"><span class=\"crayon-c\"># 以下三个分别对应三个矩阵的变化</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-32\"><span class=\"crayon-v\">synapse_0_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros_like</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-33\"><span class=\"crayon-v\">synapse_1_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros_like</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-34\"><span class=\"crayon-v\">synapse_h_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros_like</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_h</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-35\"><span class=\"crayon-c\"># training logic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-36\"><span class=\"crayon-c\"># 学习10000个例子</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-37\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-38\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 下面6行代码，随机产生两个0-128的数字，并查出他们的二进制表示。为了避免相加之和超过256，这里选择两个0-128的数字</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># generate a simple addition problem (a + b = c)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">largest_number</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># int version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int2binary</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">a_int</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># binary encoding</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">largest_number</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># int version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int2binary</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">b_int</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># binary encoding</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># true answer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">c_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">_</span>int</div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int2binary</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">c_int</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-48\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># where we'll store our best guess (binary encoded)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 存储神经网络的预测值</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros_like</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">overallError</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#每次把总误差清零</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-53\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">layer_2_deltas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#存储每个时间点输出层的误差</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">layer_1_values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#存储每个时间点隐藏层的值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">layer_1_values</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#一开始没有隐藏层，所以里面都是0</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-57\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># moving along the positions in the binary encoding</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">position </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">#循环遍历每一个二进制位</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-60\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># generate input and output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#从右到左，每次去两个输入数字的一个bit位</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-c\">#正确答案</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># hidden layer (input ~+ prev_hidden)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1_values</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">synapse_h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#（输入层 + 之前的隐藏层） -&gt; 新的隐藏层，这是体现循环神经网络的最核心的地方！！！</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># output layer (new binary representation)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#隐藏层 * 隐藏层到输出层的转化矩阵synapse_1 -&gt; 输出层</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># did we miss?... if so, by how much?</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_2_error</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">layer_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#预测误差是多少</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_2_deltas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_2_error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">sigmoid_output_to_derivative</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#我们把每一个时间点的误差导数都记录下来</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">overallError</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">abs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_2_error</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#总误差</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-72\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># decode estimate so we can print it out</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">position</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_2</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#记录下每一个预测bit位</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-75\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># store hidden layer so we can use it in the next timestep</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_1_values</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">copy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">deepcopy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#记录下隐藏层的值，在下一个时间点用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-78\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">future_layer_1_delta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hidden_dim</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-80\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#前面代码我们完成了所有时间点的正向传播以及计算最后一层的误差，现在我们要做的是反向传播，从最后一个时间点到第一个时间点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">position </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">binary_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-83\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">position</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">position</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#最后一次的两个输入</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">layer_1_values</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#当前时间点的隐藏层</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">prev_layer_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">layer_1_values</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#前一个时间点的隐藏层</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-87\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-88\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># error at output layer</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-89\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_2_delta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">layer_2_deltas</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#当前时间点输出层导数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># error at hidden layer</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># 通过后一个时间点（因为是反向传播）的隐藏层误差和当前时间点的输出层误差，计算当前时间点的隐藏层误差</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">layer_1_delta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">future_layer_1_delta</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_h</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">layer_2_delta</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid_output_to_derivative</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-93\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># let's update all our weights so we can try again</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># 我们已经完成了当前时间点的反向传播误差计算， 可以构建更新矩阵了。但是我们并不会现在就更新权重矩阵，因为我们还要用他们计算前一个时间点的更新矩阵呢。</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># 所以要等到我们完成了所有反向传播误差计算， 才会真正的去更新权重矩阵，我们暂时把更新矩阵存起来。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># 可以看这里了解更多关于反向传播的知识http://iamtrask.github.io/2015/07/12/basic-python-network/</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">synapse_1_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">atleast_2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_2_delta</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-98\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">synapse_h_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">atleast_2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prev_layer_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1_delta</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-99\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">synapse_0_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">layer_1_delta</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-100\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-101\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">future_layer_1_delta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">layer_1_delta</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-102\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 我们已经完成了所有的反向传播，可以更新几个转换矩阵了。并把更新矩阵变量清零</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-104\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_0_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">alpha</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-105\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_1_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">alpha</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-106\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">synapse_h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_h_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">alpha</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-107\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">synapse_0_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-108\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_1_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_h_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-110\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># print out progress</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-112\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Error:\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">overallError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-114\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Pred:\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-115\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"True:\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-116\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-117\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">reversed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-118\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">*</span><span class=\"crayon-k \">pow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0da2477863925-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a_int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" + \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b_int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" = \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0da2477863925-120\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"------------\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0242 seconds] -->\r\n<p></p>\n<h1 id=\"运行时输出\">运行时输出</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0db0068907679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nError:[ 3.45638663]\r\nPred:[0 0 0 0 0 0 0 1]\r\nTrue:[0 1 0 0 0 1 0 1]\r\n9 + 60 = 1\r\n------------\r\nError:[ 3.63389116]\r\nPred:[1 1 1 1 1 1 1 1]\r\nTrue:[0 0 1 1 1 1 1 1]\r\n28 + 35 = 255\r\n------------\r\nError:[ 3.91366595]\r\nPred:[0 1 0 0 1 0 0 0]\r\nTrue:[1 0 1 0 0 0 0 0]\r\n116 + 44 = 72\r\n------------\r\nError:[ 3.72191702]\r\nPred:[1 1 0 1 1 1 1 1]\r\nTrue:[0 1 0 0 1 1 0 1]\r\n4 + 73 = 223\r\n------------\r\nError:[ 3.5852713]\r\nPred:[0 0 0 0 1 0 0 0]\r\nTrue:[0 1 0 1 0 0 1 0]\r\n71 + 11 = 8\r\n------------\r\nError:[ 2.53352328]\r\nPred:[1 0 1 0 0 0 1 0]\r\nTrue:[1 1 0 0 0 0 1 0]\r\n81 + 113 = 162\r\n------------\r\nError:[ 0.57691441]\r\nPred:[0 1 0 1 0 0 0 1]\r\nTrue:[0 1 0 1 0 0 0 1]\r\n81 + 0 = 81\r\n------------\r\nError:[ 1.42589952]\r\nPred:[1 0 0 0 0 0 0 1]\r\nTrue:[1 0 0 0 0 0 0 1]\r\n4 + 125 = 129\r\n------------\r\nError:[ 0.47477457]\r\nPred:[0 0 1 1 1 0 0 0]\r\nTrue:[0 0 1 1 1 0 0 0]\r\n39 + 17 = 56\r\n------------\r\nError:[ 0.21595037]\r\nPred:[0 0 0 0 1 1 1 0]\r\nTrue:[0 0 0 0 1 1 1 0]\r\n11 + 3 = 14\r\n------------</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db0068907679-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c855c0db0068907679-50\">50</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-1\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.45638663</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-2\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-3\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-4\"><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-5\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-6\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.63389116</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-7\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-8\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-9\"><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-11\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.91366595</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-12\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-13\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-14\"><span class=\"crayon-cn\">116</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">72</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-15\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-16\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.72191702</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-17\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-18\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-19\"><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">73</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">223</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-20\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-21\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.5852713</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-22\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-23\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-24\"><span class=\"crayon-cn\">71</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-25\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-26\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.53352328</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-27\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-28\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-29\"><span class=\"crayon-cn\">81</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">113</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">162</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-30\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-31\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.57691441</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-32\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-33\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-34\"><span class=\"crayon-cn\">81</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">81</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-35\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-36\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.42589952</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-37\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-38\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-39\"><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">125</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">129</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-40\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-41\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.47477457</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-42\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-43\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-44\"><span class=\"crayon-cn\">39</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-45\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-46\"><span class=\"crayon-v\">Error</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.21595037</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-47\"><span class=\"crayon-v\">Pred</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-48\"><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-58e2c855c0db0068907679-49\"><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c855c0db0068907679-50\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0150 seconds] -->\r\n<p></p>\n<h1 id=\"第一部分：什么是神经元记忆\">第一部分：什么是神经元记忆</h1>\n<p>顺着背出字母表，你很容易做到吧？</p>\n<p>倒着背呢， 有点难哦。</p>\n<p>试着想一首你记得的歌词。为什么顺着回忆比倒着回忆难？你能直接跳到第二小节的中间么？额， 好像有点难。 这是为什么呢？</p>\n<p>这其实很符合逻辑。 你记忆字母表或者歌词并不是像计算机把信息存储在硬盘上那样的（译者注：计算机可以随机访问磁盘。）。你是顺序记忆的。知道了前一个字母，你很容易知道下一个。这是一种条件记忆，只有你最近知道了前一个记忆，你才容易想起来下一个记忆，就想你熟悉的链表一样。</p>\n<p>但是，并不是说你不唱歌的时候，歌就不在你脑子里了。而是说你如果想直接跳到中间那部分，你会发现很难直接找到其在脑中的呈现（也许是一堆神经元）。你想直接搜索到一首歌的中间部分，这是很难的， 因为你以前没有这样做过，所以没有索引可以指向歌曲的中间部分。 就好比你邻居家有很多小路， 你从前门进去顺着路走很容易找到后院，但是让你直接到后院去就不太容易。想了解更过关于大脑的知识，请看<a href=\"http://www.human-memory.net/processes_recall.html\" target=\"_blank\" rel=\"external\">这里</a>。</p>\n<p>跟链表很像，记忆这样存储很高效。我们可以发现这样存储在解决很多问题时候有优势。</p>\n<p>如果你的数据是一个序列，那么记忆就很重要（意味着你必须记住某些东西）。看下面的视频：</p>\n<p>每一个数据点就是视频中的一帧。如果你想训练一个神经网络来预测下一帧小球的位置， 那么知道上一帧小球的位置就很重要。这样的序列数据就是我们需要构建循环神经网络的原因。那么， 神经网络怎么记住以前的信息呢？</p>\n<p>神经网络有隐藏层。一般而言，隐藏层的状态由输入决定。所以，一般而言神经网络的信息流如下图：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0db7127841000\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninput -&gt; hidden -&gt; output</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0db7127841000-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0db7127841000-1\"><span class=\"crayon-k \">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hidden</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这很简单直接。特定的输入决定特定的隐藏层，特定的隐藏层又决定了输出。这是一种封闭系统。记忆改变了这种状况。记忆意味着，隐藏状态是由当前时间点的输入和上一个时间点的隐藏状态决定的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0dba734816812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(input + prev_hidden) -&gt; hidden -&gt; output</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0dba734816812-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0dba734816812-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prev_hidden</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hidden</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>为什么是隐藏层而不是输入层呢？我们也可以这样做呀：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0dbd024076277\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(input + prev_input) -&gt; hidden -&gt; output</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0dbd024076277-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0dbd024076277-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prev_input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hidden</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在，仔细想想，如果有四个时间点，如果我们采用隐藏层循环是如下图：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/99adbb88d246e58d389144ee1d0d8282.jpg\" alt=\"hidden layer recurrence\"><br>\n如果采用输入层循环会是：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/3ee1fe80693839cd27dca8672a86f51c.jpg\" alt=\"input layer recurrence\"><br>\n看到区别没，隐藏层记忆了之前所有的输入信息，而输入层循环则只能利用到上一个输入。举个例子，假设一首歌词里面有”….I love you…”和”…I love carrots…”，如果采用输入层循环，则没法根据”I love”来预测下一个词是什么？因为当前输入是love，前一个输入是I，这两种情况一致，所以没法区分。 而隐藏层循环则可以记住更久之前的输入信息，因而能更好地预测下一个词。理论上而言，隐藏层循环可以记住所有之前的输入，当然记忆会随着时间流逝逐渐忘却。有兴趣的可以看<a href=\"http://karpathy.github.io/2015/05/21/rnn-effectiveness/\" target=\"_blank\" rel=\"external\">这篇blog</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0dc0751164886\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n停下来好好想想， 直到你感觉想明白了再继续。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0dc0751164886-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0dc0751164886-1\">停下来好好想想，<span class=\"crayon-h\"> </span>直到你感觉想明白了再继续。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1 id=\"第二部分：RNN-神经网络记忆\">第二部分：RNN – 神经网络记忆</h1>\n<p>现在我们已经有了一些直观认识， 接下来让我们更进一步分析。正如在<a href=\"http://iamtrask.github.io/2015/07/12/basic-python-network/\" target=\"_blank\" rel=\"external\">反向传播这篇blog</a>里介绍的，神经网络的输入层是由输入数据集决定的。每一行输入数据用来产生隐藏层（通过正向传播）。每个隐藏层又用于产生输出层（假设只有一层隐藏层）。如我们之前所说，记忆意味着隐藏层是由输入数据和前一次的隐藏层组合而成。怎么做的呢？很像神经网络里面其他传播的做法一样， 通过矩阵！这个矩阵定义了当前隐藏层跟前一个隐藏层的关系。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/fcc3a0a858b65641f1c8b1daef2345fa.png\" alt=\"rnn\"><br>\n这幅图中很重要的一点是有三个权重矩阵。有两个我们很熟悉了。SYNAPSE_0用于把输入数据传播到隐藏层。SYNAPSE_1把隐藏层传播到输出数据。新矩阵（SYNAPSE_h，用于循环）把当前的隐藏层（layer_1）传播到下一个时间点的隐藏层（还是layer_1）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0dc3043213981\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n停下来好好想想， 直到你感觉想明白了再继续。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0dc3043213981-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0dc3043213981-1\">停下来好好想想，<span class=\"crayon-h\"> </span>直到你感觉想明白了再继续。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/db8b531e1f38870b5be578001822738e.gif\" alt=\"forward\"><br>\n上面的gif图展示了循环神经网络的神奇之处以及一些很重要的性质。它展示了四个时间点隐藏层的情况。第一个时间点，隐藏层仅由输入数据决定。第二个时间点，隐藏层是由输入数据和第一个时间点的隐藏层共同决定的。以此类推。你应该注意到了，第四个时间点的时候，网络已经“满了”。所以大概第五个时间点来的时候，就要选择哪些记忆保留，哪些记忆覆盖。现实如此。这就是记忆“容量”的概念。如你所想，更大的隐藏层，就能记住更长时间的东西。同样，这就需要神经网络学会<strong>忘记不相关的记忆</strong>然后<strong>记住重要的记忆</strong>。第三步有没看出什么重要信息？为什么<strong>绿色</strong>的要比其他颜色的多呢？</p>\n<p>另外要注意的是隐藏层夹在输入层和输出层中间，所以输出已经不仅仅取决于输入了。输入仅仅改变记忆，而输出仅仅依赖于记忆。有趣的是，如果2，3，4时间节点没有输入数据的话，隐藏层同样会随着时间流逝而变化。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c855c0dc7929085870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n停下来好好想想，确保你明白了刚讲的内容。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c855c0dc7929085870-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c855c0dc7929085870-1\">停下来好好想想，确保你明白了刚讲的内容。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1 id=\"第三部分：基于时间的反向传播\">第三部分：基于时间的反向传播</h1>\n<p>那么循环神经网络是怎么学习的呢？看看下面的图。黑色表示预测结果，明黄色表示错误，褐黄色表示导数。<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/4a3911783cc08255a2346545dd08fba7.gif\" alt=\"bp\"><br>\n网络通过从1到4的全部前向传播（可以是任意长度的整个序列），然后再从4到1的反向传播导数来学习。你可以把它看成一个有点变形的普通神经网络，除了我们在不同的地方共享权值（synapses 0,1,and h）。除了这点， 它就是一个普通的神经网络。</p>\n<h1 id=\"我们的玩具代码\">我们的玩具代码</h1>\n<p>来，我们用循环神经网络做个模型来实现<strong>二进制加法</strong>。看到下面的图没，你猜猜顶上的彩色的1表示什么意思呢？<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/03/01a3fa138bdf2d30c68a049bd9fa4a30.gif\" alt=\"toy code\"><br>\n方框里的彩色的1表示<strong>进位</strong>。我们就要用循环神经网络来记住这个进位。求和的时候需要记住<strong>进位</strong>（如果不懂，可以看<a href=\"https://www.youtube.com/watch?v=jB_sRh5yoZk\" target=\"_blank\" rel=\"external\">这里</a>）。</p>\n<p>二进制加法做法就是，从右往左，根据上面两行的bit来预测第三行的bit为1还是0。我们想要神经网络遍历整个二进制序列记住是否有进位，以便能计算出正确的结果。不要太纠结这个问题本身，神经网络也不在乎这个问题。它在乎的只是每个时刻它会收到两个输入（0或者1），然后它会传递给用于记忆是否有进位的隐藏层。神经网络会把所有这些信息（输入和隐藏层的记忆）考虑进去，来对每一位（每个时间点）做出正确的预测。</p>\n<hr>\n<p>下面原文里面是针对每行代码做的注释， 为了方便阅读， 我直接把注释写到了代码里面， 便于大家阅读。</p>\n<p>译者注：RNN在自然语言处理里面大量使用，包括机器翻译，对话系统，机器做诗词等，本文只是简单介绍了一下原理。后续我会写一些应用方面的文章，敬请期待。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87538\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87538votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87538\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "title": "所有人都能学会用Python写出RNN-LSTM代码", "fav_nums": 3}
{"praise_nums": 1, "front_image_path": "full/a899bc006206081326c6e53828774de680c13c26.jpg", "tags": "", "comment_nums": 1, "url_object_id": "c8d3b29f5d3e64fc620ccfffb26d0b44", "url": "http://python.jobbole.com/87513/", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zumagia\">Ree Ray</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.oreilly.com/learning/hello-tensorflow\">Aaron Schumacher</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>零基础创建和训练你的第一个 TensorFlow 图（Graph）</h3>\n<p><a href=\"https://www.tensorflow.org/\">TensorFlow</a> 之大远远超出你的认识。事实上它是一个针对深度学习的库，并藉由和谷歌的关系赢得了许多关注。但除去这些噱头，项目的如下特性（unique elements）值得深入玩味。</p>\n<blockquote>\n<ul>\n<li>核心库“不仅”适用深度学习，且面向绝大部分的机器学习技术。</li>\n<li>线性代数和其它内部构件（internals）（的功能）尤其突出（prominently exposed）。</li>\n<li>除了主要的机器学习功能以外，TensorFlow 还有自己的日志（logging）系统、可交互的日志可视化工具（interactive log visualizer），甚至有工程性非常强的（heavily engineered）服务架构（serving architecture）。</li>\n<li>TensorFlow 的执行（execution）模型有别于 Python 的 scikit-learn，或是 R 语言中大部分的工具。</li>\n</ul>\n</blockquote>\n<p>TensorFlow 里这些酷炫的玩意（Cool stuff）非常容易被那些渴望探索机器学习的初学者接受（take in）。</p>\n<p>TensorFlow 的原理是什么？让我们深入剖析来查看和理解它的每个独立部分。我们会探索即将进行计算的数据的数据流<a href=\"https://en.wikipedia.org/wiki/Graph_(abstract_data_type)\">图</a>（data flow graph），怎么通过 TensorFlow 使用<a href=\"https://en.wikipedia.org/wiki/Gradient_descent\">梯度下降（gradient descent）</a>来训练模型，以及怎样利用 <a href=\"https://www.tensorflow.org/versions/r0.8/how_tos/summaries_and_tensorboard/\">TensorBoard</a> 来可视化 TensorFlow 的工作。虽然这些例子解决不了工业级的机器学习问题，但是能够帮助你理解构建 TensorFlow 的每个组件（components ），包括下面的程序会使用到的！</p>\n<h2><strong>Python 与 TensorFlow 中的命名（names）与执行</strong></h2>\n<p>TensorFlow 的计算管理和 Python 完全不同。按照 <a href=\"https://twitter.com/hadleywickham/status/732288980549390336\">Hadley Wickham</a> 的说法，对于这两者都该牢记的是：一个对象（obejct）不会对应（have）一个命名（见图 1）。为了观察 Python 和 TensorFlow 的相似性（以及差异），让我们看看他们是如何引用（refer to）对象和处理执行的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2016/07/824236e36e2bd3710161a78b849e956d.jpg\"><img class=\"aligncenter size-full wp-image-61923\" src=\"http://jbcdn2.b0.upaiyun.com/2016/07/824236e36e2bd3710161a78b849e956d.jpg\" alt=\"1\" width=\"1400\" height=\"944\"></a></p>\n<p>图 1 命名“对应”对象，反之却不然。图片由 Hadley Wickham 提供，已获授权。</p>\n<p>Python 代码中的变量名并不是它们代表的那样；它们只是指向对象。因此，当你写出以下的代码：<code>foo = []</code> 和 <code>bar = foo</code>，不仅说明 <code>foo</code> 和 <code>bar</code> 的值相等，并且强调了 <code>foo</code> <em>就是</em> <code>bar</code>。也就是说它们指向了相同的列表对象。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742df959711073\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; foo = []\r\n&gt;&gt;&gt; bar = foo\r\n&gt;&gt;&gt; foo == bar\r\n## True\r\n&gt;&gt;&gt; foo is bar\r\n## True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742df959711073-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742df959711073-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742df959711073-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742df959711073-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742df959711073-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742df959711073-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742df959711073-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742df959711073-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742df959711073-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742df959711073-4\"><span class=\"crayon-p\">## True</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742df959711073-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742df959711073-6\"><span class=\"crayon-p\">## True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>你也会发现 <code>id(foo)</code> 和 <code>id(bar)</code> 是一样的。这种一致性（identity），一旦被错误使用（misunderstood），会产生一些意外的 bug，尤其对于列表这样的<a href=\"https://codehabitude.com/2013/12/24/python-objects-mutable-vs-immutable/\">可变</a>数据结构（mutable data structures）。</p>\n<p>就内部而言，Python 管理所有的对象并且会保留所有变量名和引用对象的过程（track）。TensorFlow 图则代表了这种管理方式的另一个层次（layer）；如同我们所见，Python 的命名会引用对象，使得有更多（granular）连接和管理 TensorFlow 的图的 ops（operations）。</p>\n<p>当你在 Python 解释器（expression），诸如交互式编译器或者“读取-求值-输出循环（Read Evaluate Print Loop，缩写为 REPL）”，可以即时读取和输出。Python 会执行你的命令。所以如果当我输入 <code>foo.append(bar)</code>，Python 会立刻添加，即使我再也不用到 <code>foo</code>。</p>\n<p>更懒的替代方法是我输入 <code>foo.append(bar)</code>，如果我在以后再执行 <code>foo</code>，Python 会接着添加。这就非常接近 TensorFlow 的做法了，即定义关系完全和计算结果分离开来。</p>\n<p>TensorFlow 分离了计算的定义和执行，甚至分开来进行这些操作：一个图定义了一个 ops，但只会在会话（session）中进行。图和会话都是独立创建的。图类似于施工图（blueprint），而会话更像施工地点。</p>\n<p>回到纯 Python 的例子，回忆一下 <code>foo</code> 和 <code>bar</code> 会引用相同的列表。把 <code>bar</code> 添加进 <code>foo</code>，就如同把列表塞进它本身。你可以把这个结构看作是一个有节点（node）的图指向它本身。嵌套列表（Nesting lists）是代表图结构的一种方式，像 TensorFlow 的计算图。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742ea737967549\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; foo.append(bar)\r\n&gt;&gt;&gt; foo\r\n## [[...]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742ea737967549-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742ea737967549-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742ea737967549-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742ea737967549-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742ea737967549-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742ea737967549-3\"><span class=\"crayon-p\">## [[...]]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>真正的 TensorFlow 图比这更有意思！</p>\n<h2><strong>最简单的 TensorFlow 图</strong></h2>\n<p>让我们开始手把手从头创建最简单的 TensorFlow 图。和别的框架比，TensorFlow 非常容易<a href=\"https://www.tensorflow.org/versions/r0.8/get_started/os_setup.html\">安装</a>。本文使用的例子可以在 Python 2.7 或者 3.3+ 中运行，TensorFlow 的版本则是 0.8。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742ee348930296\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; import tensorflow as tf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742ee348930296-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742ee348930296-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">tensorflow </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>到这一步 TensorFlow 已经为我们处理了许多声明（state）。已经存在一个隐藏的默认图，举个例子，就<a href=\"https://github.com/tensorflow/tensorflow/blob/v0.8.0/tensorflow/python/framework/ops.py#L3399\">内部而言</a>，它在 <code>_default_graph_stack</code>，但我们不能直接调用（access）它，需要通过 <code>tf.get_default_graph()</code> 函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742f2675597389\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; graph = tf.get_default_graph()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742f2675597389-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742f2675597389-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_default_graph</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>TensorFlow 图的节点被成为“operations”或者简称为“ops”。在图的 <code>graph.get_operations()</code> 函数中可以了解 ops 是什么。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742f5436091311\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; graph.get_operations()\r\n## []</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742f5436091311-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742f5436091311-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742f5436091311-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_operations</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742f5436091311-2\"><span class=\"crayon-p\">## []</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在图还是空的。我们需要把让 TensorFlow 计算的数据塞进去。因此先输入一个简单的常量（constant） 1。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742f8540495465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; input_value = tf.constant(1.0)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742f8540495465-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742f8540495465-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">input_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">constant</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这个常量目前以一个节点的形式存在，也就是图里的一个 op（operation）。Python 的变量名 <code>input_value</code> 间接引用这个 op，但我们还是能在默认图中找到这个 op。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c208742fc552073586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; operations = graph.get_operations()\r\n&gt;&gt;&gt; operations\r\n## [&lt;tensorflow.python.framework.ops.Operation at 0x1185005d0&gt;]\r\n&gt;&gt;&gt; operations[0].node_def\r\n## name: \"Const\"\r\n## op: \"Const\"\r\n## attr {\r\n##   key: \"dtype\"\r\n##   value {\r\n##     type: DT_FLOAT\r\n##   }\r\n## }\r\n## attr {\r\n##   key: \"value\"\r\n##   value {\r\n##     tensor {\r\n##       dtype: DT_FLOAT\r\n##       tensor_shape {\r\n##       }\r\n##       float_val: 1.0\r\n##     }\r\n##   }\r\n## }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c208742fc552073586-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58e2c208742fc552073586-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_operations</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operations</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-3\"><span class=\"crayon-p\">## [&lt;tensorflow.python.framework.ops.Operation at 0x1185005d0&gt;]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_def</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-5\"><span class=\"crayon-p\">## name: \"Const\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-6\"><span class=\"crayon-p\">## op: \"Const\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-7\"><span class=\"crayon-p\">## attr {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-8\"><span class=\"crayon-p\">##   key: \"dtype\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-9\"><span class=\"crayon-p\">##   value {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-10\"><span class=\"crayon-p\">##     type: DT_FLOAT</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-11\"><span class=\"crayon-p\">##   }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-12\"><span class=\"crayon-p\">## }</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-13\"><span class=\"crayon-p\">## attr {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-14\"><span class=\"crayon-p\">##   key: \"value\"</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-15\"><span class=\"crayon-p\">##   value {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-16\"><span class=\"crayon-p\">##     tensor {</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-17\"><span class=\"crayon-p\">##       dtype: DT_FLOAT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-18\"><span class=\"crayon-p\">##       tensor_shape {</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-19\"><span class=\"crayon-p\">##       }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-20\"><span class=\"crayon-p\">##       float_val: 1.0</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-21\"><span class=\"crayon-p\">##     }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c208742fc552073586-22\"><span class=\"crayon-p\">##   }</span></div><div class=\"crayon-line\" id=\"crayon-58e2c208742fc552073586-23\"><span class=\"crayon-p\">## }</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>TensorFlow 内部使用了协议缓冲（<a href=\"https://developers.google.com/protocol-buffers/\">Protocol buffers</a>，类似于谷歌式（Google-strength）的 <a href=\"http://www.json.org/\">JSON</a>）。打印上述常量 op 的 <code>node_def</code> 可以观察 TensorFlow 怎么用协议缓冲来表示常量 1。</p>\n<p>刚开始接触 TensorFlow 的人有时候会想知道为什么对于“TensorFlow 的版本”问题会大惊小怪（fuss）。为什么不能使用原有的 Python 变量，而不去定义 TensorFlow 对象？TensorFlow <a href=\"https://www.tensorflow.org/versions/r0.8/tutorials/mnist/pros/index.html#deep-mnist-for-experts\">其中一个教程</a>解释如下（译者注：为了避免重复劳动，以下引用翻译来自 <a href=\"http://tensorfly.cn/tfdoc/tutorials/mnist_pros.html\">TensorFlow 中文社区</a>，特此致谢）：</p>\n<blockquote><p>在Python中进行高效的数值计算，我们通常会使用像NumPy一类的库，将一些诸如矩阵乘法的耗时操作在Python环境的外部来计算，这些计算通常会通过其它语言并用更为高效的代码来实现。但遗憾的是，每一个操作切换回Python环境时仍需要不小的开销。如果你想在GPU或者分布式环境中计算时，这一开销更加可怖，这一开销主要可能是用来进行数据迁移。</p>\n<p>TensorFlow也是在Python外部完成其主要工作，但是进行了改进以避免这种开销。其并没有采用在Python外部独立运行某个耗时操作的方式，而是先让我们描述一个交互操作图，然后完全将其运行在Python外部。这与Theano或Torch的做法类似。</p></blockquote>\n<p>TensorFlow 能干许多了不起的事情，但需要很明确给出要求，即便只是单个常量。</p>\n<p>如果我们查看 <code>input_value</code>，会发现是一个维度为空的 32 位的浮点型张量（tensor）：意味着只有一个数字。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874300085035192\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; input_value\r\n## &lt;tf.Tensor 'Const:0' shape=() dtype=float32&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874300085035192-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874300085035192-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874300085035192-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">input_value</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874300085035192-2\"><span class=\"crayon-p\">## &lt;tf.Tensor 'Const:0' shape=() dtype=float32&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>值得注意的是，这个操作<em>不会</em>告诉我们这个数字<em>是</em>什么。执行 <code>input_value</code> 并得到这个数字的值，我们需要创建一个会话使图的 ops 能够被执行而且明确要求“运行” <code>input_value</code>（会话默认会处理（picks up）默认图）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874304978484152\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; sess = tf.Session()\r\n&gt;&gt;&gt; sess.run(input_value)\r\n## 1.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874304978484152-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874304978484152-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874304978484152-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874304978484152-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874304978484152-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input_value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874304978484152-3\"><span class=\"crayon-p\">## 1.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>对于“运行”一个常量可能会感到有些奇怪。但这和在 Python 中执行常见的表达一样；仅仅只是因为 TensorFlow 管理自身空间——计算图——以及有自己独特的方法执行。</p>\n<h2><strong>最简单的 TensorFlow 神经元（neuron）</strong></h2>\n<p>现在带有简单图的会话已经创建好了，让我们继续创建一个只有单个参数的神经元，或者说是权重（weight）。通常，即便再简单的神经元也会存在偏项（bias term）和非同一性激励函数（non-identity activation function），但我们省去这步。</p>\n<p>神经元的权重不会是一个常量；我们希望它能够改变，因为需要从“真实”的输入和输出来进行训练。这个权重将会是 TensorFlow 的变量。我们把这个变量的初始值设为 0.8。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874308000533811\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; weight = tf.Variable(0.8)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874308000533811-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874308000533811-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Variable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.8</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>你也许以为添加 1 个变量也会在图中添加 1 个 op，但事实上是 4 个。我们来看看所有 ops 的命名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087430b432508979\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; for op in graph.get_operations(): print(op.name)\r\n## Const\r\n## Variable/initial_value\r\n## Variable\r\n## Variable/Assign\r\n## Variable/read</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087430b432508979-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087430b432508979-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c2087430b432508979-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087430b432508979-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c2087430b432508979-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087430b432508979-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087430b432508979-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">op </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_operations</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087430b432508979-2\"><span class=\"crayon-p\">## Const</span></div><div class=\"crayon-line\" id=\"crayon-58e2c2087430b432508979-3\"><span class=\"crayon-p\">## Variable/initial_value</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087430b432508979-4\"><span class=\"crayon-p\">## Variable</span></div><div class=\"crayon-line\" id=\"crayon-58e2c2087430b432508979-5\"><span class=\"crayon-p\">## Variable/Assign</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087430b432508979-6\"><span class=\"crayon-p\">## Variable/read</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>我们并不想单独观察每个 op 太久，但至少观察一个来看看真实的运算。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087430e970180835\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; output_value = weight * input_value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087430e970180835-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087430e970180835-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">weight *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">input_value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在图中有 6 个 ops，最后一个是乘法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874311608219649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; op = graph.get_operations()[-1]\r\n&gt;&gt;&gt; op.name\r\n## 'mul'\r\n&gt;&gt;&gt; for op_input in op.inputs: print(op_input)\r\n## Tensor(\"Variable/read:0\", shape=(), dtype=float32)\r\n## Tensor(\"Const:0\", shape=(), dtype=float32)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874311608219649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874311608219649-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874311608219649-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874311608219649-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874311608219649-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874311608219649-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874311608219649-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_operations</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874311608219649-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874311608219649-3\"><span class=\"crayon-p\">## 'mul'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874311608219649-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">op_input </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">inputs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">op_input</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874311608219649-5\"><span class=\"crayon-p\">## Tensor(\"Variable/read:0\", shape=(), dtype=float32)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874311608219649-6\"><span class=\"crayon-p\">## Tensor(\"Const:0\", shape=(), dtype=float32)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这说明了乘法 op 的输入来源：来自图中的其它 ops。要了解整个图，按这种方法很快会使人恹恹欲睡。所以 <a href=\"https://www.tensorflow.org/versions/r0.8/how_tos/graph_viz/\">TensorBoard graph visualization</a> 就应运而生了。</p>\n<p>怎样查看生成了些什么呢？我们必须“运行” <code>output_value</code> op。但它取决于变量：<code>weight</code>。我们将初始的 <code>weight</code> 设为 0.8，但这个值在当前会话中还没有设置。<code>tf.initialize_all_variables()</code> 函数会生成一个可以初始化所有变量（虽然本例中只有一个变量）的 op，下面运行这个 op。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874315932892891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; init = tf.initialize_all_variables()\r\n&gt;&gt;&gt; sess.run(init)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874315932892891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874315932892891-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874315932892891-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">init</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initialize_all_variables</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874315932892891-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>运行 <code>tf.initialize_all_variables()</code> 后会对目前存在于图中的所有变量进行初始化，所以如果添加更多变量后，会想再次使用 <code>tf.initialize_all_variables()</code>；但原有的 <code>init</code> 不包括新的变量。</p>\n<p>下面我们准备运行 <code>output_value</code> 的 op。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874318696982818\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; sess.run(output_value)\r\n## 0.80000001</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874318696982818-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874318696982818-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874318696982818-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874318696982818-2\"><span class=\"crayon-p\">## 0.80000001</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>回想一下 0.8 * 1.0 进行 32 位的浮点型运算很难得到 0.8；0.80000001 是最接近的数。</p>\n<h2><strong>在 TensorBoard 观察你的图</strong></h2>\n<p>到目前为止，简单的图已经完成了，但通过图解（diagram）能观察会更棒。用 TensorBoard 就能生成这个图解。TensorBoard 读取命名字段（name field）并将每个 op 存储在内部（和 Python 的变量名比起来很不同）。我们可以使用这些 TensorFlow 命名并转换成更符合 Python 习惯的变量名。在这使用的 <code>tf.mul</code> 和前面用 <code>*</code> 一样都是乘法，但它可以设置 op 的命名。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087431b525122462\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; x = tf.constant(1.0, name='input')\r\n&gt;&gt;&gt; w = tf.Variable(0.8, name='weight')\r\n&gt;&gt;&gt; y = tf.mul(w, x, name='output')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087431b525122462-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087431b525122462-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c2087431b525122462-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087431b525122462-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">constant</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087431b525122462-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Variable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'weight'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c2087431b525122462-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mul</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'output'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>TensorBoard 由 TensorFlow 会话创建的输出目录进行观察。我们可以用 <code>SummaryWriter</code> 写入这个输出，如果创建图的时候我们不做任何操作，它只会写入这个图。</p>\n<p>当我们创建 <code>SummaryWriter</code> 时，第一个参数是输出目录的名称，如果不存在会自动创建。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087431f782491285\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; summary_writer = tf.train.SummaryWriter('log_simple_graph', sess.graph)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087431f782491285-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087431f782491285-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">summary_writer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SummaryWriter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'log_simple_graph'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们现在可以在命令行启动 TensorBoard了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874322838462167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tensorboard --logdir=log_simple_graph\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874322838462167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874322838462167-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874322838462167-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tensorboard</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">logdir</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">log_simple</span><span class=\"crayon-sy\">_</span>graph</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874322838462167-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>TensorBoard 会运行一个本地的 web 应用，在 6006 端口（“6006”是“goog”的翻转）。如果你浏览 <code>localhost:6006/#graphs</code>，你可以看到你在 TensorFlow 图的图解，就像图 2 所示。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2016/07/8e221473832caf1e0a44974ea3595d60.jpg\"><img class=\"aligncenter size-full wp-image-61924\" src=\"http://jbcdn2.b0.upaiyun.com/2016/07/8e221473832caf1e0a44974ea3595d60.jpg\" alt=\"2\" width=\"1400\" height=\"646\"></a></p>\n<p>图2：最小 TensorFlow 神经元的 TensorBoard 可视化</p>\n<h2><strong>让神经元学习</strong></h2>\n<p>我们已经创建了神经元，但怎么让它学习呢？我们将输入值设置为 1.0，正确的输出值设置为 0。现在我们有一个非常简单的“训练集”，只有一个值为 1 的特征（feature）和值为 0 的标签（label）。我们希望这个神经元能够学会从 1 变为 0。</p>\n<p>现在向程序输入 1，返回 0.8 的结果是不正确的。我们需要一种方式来描述系统误差。所以我们用“损失（loss）”来描述系统误差，我们的目标就是尽可能减少系统误差。当然，如果误差为负，就不是越小越好了。因此我们用实际输出（current output）和期望输出（desired output）的平方差来定义误差的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874326312567276\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; y_ = tf.constant(0.0)\r\n&gt;&gt;&gt; loss = (y - y_)**2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874326312567276-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874326312567276-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874326312567276-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">constant</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874326312567276-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>目前，图里还没有东西进行学习。因此我们需要一个优化器（optimizer）。我们将使用梯度下降优化器使我们能够按照误差的导数（derivative）来更新权重。这个优化器通过学习率（learning rate）来调节（moderate）更新的大小，我们设置为 0.025。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874329227615645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; optim = tf.train.GradientDescentOptimizer(learning_rate=0.025)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874329227615645-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874329227615645-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">optim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GradientDescentOptimizer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">learning_rate</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.025</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这个优化器聪明极了。通过整个网络，它可以自动计算和使用合适的梯度，完成后面的步骤来进行学习。</p>\n<p>让我们来看看本例中的梯度长什么样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087432c839146963\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; grads_and_vars = optim.compute_gradients(loss)\r\n&gt;&gt;&gt; sess.run(tf.initialize_all_variables())\r\n&gt;&gt;&gt; sess.run(grads_and_vars[1][0])\r\n## 1.6</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087432c839146963-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087432c839146963-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c2087432c839146963-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087432c839146963-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087432c839146963-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grads_and_vars</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">optim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">compute_gradients</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087432c839146963-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initialize_all_variables</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c2087432c839146963-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">grads_and_vars</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087432c839146963-4\"><span class=\"crayon-p\">## 1.6</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>为什么梯度的值是 1.6？我们的误差是错误值（error）的平方，而导数则是错误值的两倍。现在程序的输出是 0.8，还不是 0，所以错误值就是 0.8，0.8 的两倍正好是 1.6。成功了！</p>\n<p>对于更复杂的系统，TensorFlow 自动计算和应用这些梯度会更方便。</p>\n<p>让我们使用梯度，完成反向传播（backpropagation）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087432f560944760\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; sess.run(optim.apply_gradients(grads_and_vars))\r\n&gt;&gt;&gt; sess.run(w)\r\n## 0.75999999  # about 0.76</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087432f560944760-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c2087432f560944760-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c2087432f560944760-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087432f560944760-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">optim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apply_gradients</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">grads_and_vars</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c2087432f560944760-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c2087432f560944760-3\"><span class=\"crayon-p\">## 0.75999999  # about 0.76</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874333741244365\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; sess.run(optim.apply_gradients(grads_and_vars))\r\n&gt;&gt;&gt; sess.run(w)\r\n## 0.75999999  # 约为 0.76</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874333741244365-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874333741244365-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874333741244365-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874333741244365-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">optim</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apply_gradients</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">grads_and_vars</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874333741244365-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874333741244365-3\"><span class=\"crayon-p\">## 0.75999999  # 约为 0.76</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>因为权重等于优化器减去梯度乘以学习率，即减去 1.6 * 0.025，因此减少 0.04 是正确的。</p>\n<p>为了取代上面的手动（hand-holding）优化器，我们可以用：<code>train_step</code> op 来计算和应用梯度。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874336718207960\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; train_step = tf.train.GradientDescentOptimizer(0.025).minimize(loss)\r\n&gt;&gt;&gt; for i in range(100):\r\n&gt;&gt;&gt;     sess.run(train_step)\r\n&gt;&gt;&gt; \r\n&gt;&gt;&gt; sess.run(y)\r\n## 0.0044996012</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874336718207960-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874336718207960-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874336718207960-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874336718207960-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874336718207960-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874336718207960-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874336718207960-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">train_step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GradientDescentOptimizer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.025</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">minimize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874336718207960-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874336718207960-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">train_step</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874336718207960-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874336718207960-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874336718207960-6\"><span class=\"crayon-p\">## 0.0044996012</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>多次迭代训练步骤后，权重和输出的值已经非常接近 0。神经元已经具有学习能力了！</p>\n<h2><strong>用 TensorBoard 展示训练过程</strong></h2>\n<p>我们也许对训练的时候发生了什么感兴趣。也就是我们想知道程序在训练过程中做了些什么。因此可以输出每个迭代的循环。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874339757066794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; sess.run(tf.initialize_all_variables())\r\n&gt;&gt;&gt; for i in range(100):\r\n&gt;&gt;&gt;     print('before step {}, y is {}'.format(i, sess.run(y)))\r\n&gt;&gt;&gt;     sess.run(train_step)\r\n&gt;&gt;&gt; \r\n## before step 0, y is 0.800000011921\r\n## before step 1, y is 0.759999990463\r\n## ...\r\n## before step 98, y is 0.00524811353534\r\n## before step 99, y is 0.00498570781201</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874339757066794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874339757066794-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874339757066794-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874339757066794-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874339757066794-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874339757066794-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874339757066794-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874339757066794-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874339757066794-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874339757066794-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874339757066794-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initialize_all_variables</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874339757066794-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874339757066794-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\">     </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'before step {}, y is {}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874339757066794-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">train_step</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874339757066794-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874339757066794-6\"><span class=\"crayon-p\">## before step 0, y is 0.800000011921</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874339757066794-7\"><span class=\"crayon-p\">## before step 1, y is 0.759999990463</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874339757066794-8\"><span class=\"crayon-p\">## ...</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874339757066794-9\"><span class=\"crayon-p\">## before step 98, y is 0.00524811353534</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874339757066794-10\"><span class=\"crayon-p\">## before step 99, y is 0.00498570781201</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>虽然奏效了，但是有点小瑕疵。就是这一串的数字理解起来很困难。如果能画出来会更好。即使只有一个值需要观察，输出也会非常多导致看不过来。我们更倾向于观察到更多的东西。如果能有组织地记录下所有东西会更好。</p>\n<p>还好，我们前面使用的可视化和我们现在所期望的效果是一样的机制（mechanisms）。</p>\n<p>我们通过添加一个对状态进行摘要的 ops 来描述（instrument）计算图。在此，我们将创建一个 op 来反映（reports）目前 <code>y</code> 的值，也就是神经元的实际输出。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c2087433d668157721\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; summary_y = tf.scalar_summary('output', y)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c2087433d668157721-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c2087433d668157721-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">summary_y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scalar_summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'output'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>当你运行这个具有摘要功能的 op，会返回缓冲协议文本的字符串，利用 <code>SummaryWriter</code> 可以被写入日志目录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874340259001998\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; summary_writer = tf.train.SummaryWriter('log_simple_stats')\r\n&gt;&gt;&gt; sess.run(tf.initialize_all_variables())\r\n&gt;&gt;&gt; for i in range(100):\r\n&gt;&gt;&gt;     summary_str = sess.run(summary_y)\r\n&gt;&gt;&gt;     summary_writer.add_summary(summary_str, i)\r\n&gt;&gt;&gt;     sess.run(train_step)\r\n&gt;&gt;&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874340259001998-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874340259001998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874340259001998-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874340259001998-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874340259001998-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874340259001998-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874340259001998-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874340259001998-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">summary_writer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SummaryWriter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'log_simple_stats'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874340259001998-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initialize_all_variables</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874340259001998-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874340259001998-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">summary_str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">summary_y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874340259001998-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">summary_writer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">summary_str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874340259001998-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">train_step</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874340259001998-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>运行 <code>tensorboard --logdir=log_simple_stats</code>，在 <code>localhost:6006/#events</code>（图 3）可以看到交互的绘图。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2016/07/64f4ad6759b171f7a17b4aee9e77c3c9.jpg\"><img class=\"aligncenter size-full wp-image-61925\" src=\"http://jbcdn2.b0.upaiyun.com/2016/07/64f4ad6759b171f7a17b4aee9e77c3c9.jpg\" alt=\"3\" width=\"1400\" height=\"642\"></a></p>\n<p>图 3：训练迭代数字与神经元输出在 TensorBoard 下的可视化</p>\n<h2><strong>继续前进（Flowing onward）</strong></h2>\n<p>下面是最终版的代码。实在是很短，每个部分都能看出 TensorFlow 的有效和易懂。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58e2c20874344944933465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport tensorflow as tf\r\n\r\nx = tf.constant(1.0, name='input')\r\nw = tf.Variable(0.8, name='weight')\r\ny = tf.mul(w, x, name='output')\r\ny_ = tf.constant(0.0, name='correct_value')\r\nloss = tf.pow(y - y_, 2, name='loss')\r\ntrain_step = tf.train.GradientDescentOptimizer(0.025).minimize(loss)\r\n\r\nfor value in [x, w, y, y_, loss]:\r\n    tf.scalar_summary(value.op.name, value)\r\n\r\nsummaries = tf.merge_all_summaries()\r\n\r\nsess = tf.Session()\r\nsummary_writer = tf.train.SummaryWriter('log_simple_stats', sess.graph)\r\n\r\nsess.run(tf.initialize_all_variables())\r\nfor i in range(100):\r\n    summary_writer.add_summary(sess.run(summaries), i)\r\n    sess.run(train_step)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58e2c20874344944933465-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58e2c20874344944933465-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">tensorflow </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-2\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">constant</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-4\"><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Variable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'weight'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-5\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mul</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'output'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-6\"><span class=\"crayon-v\">y_</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">constant</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'correct_value'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-7\"><span class=\"crayon-v\">loss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'loss'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-8\"><span class=\"crayon-v\">train_step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GradientDescentOptimizer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.025</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">minimize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-10\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">loss</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scalar_summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-12\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-13\"><span class=\"crayon-v\">summaries</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">merge_all_summaries</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-14\"> </div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-15\"><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-16\"><span class=\"crayon-v\">summary_writer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SummaryWriter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'log_simple_stats'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-18\"><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initialize_all_variables</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-19\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58e2c20874344944933465-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">summary_writer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">summaries</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58e2c20874344944933465-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">train_step</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n<p>我们这次运行的示例甚至比在 Michael Nielsen 的 <a href=\"http://neuralnetworksanddeeplearning.com/\">Neural Networks and Deep Learning</a> 中受到启发的例子还要简单。就我个人而言，像这样从细节入手有助于理解和构建更复杂的系统，因为它们都是从简单的建筑模块延生来的。TensorFlow 其中一个优美之处就在于非常灵活，你可以通过简单的组件构建出更复杂的系统。</p>\n<p>如果你想继续实践 TensorFlow，创建更有趣的神经元，也许<a href=\"https://en.wikipedia.org/wiki/Activation_function#Comparison_of_activation_functions\">激励函数（activation functions）</a>还不一样，但这一定很有意思。你可以用更多有趣的数据来训练；添加更多的神经元；添加更多的层；你也可以深入更复杂的<a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/models\">预建模型（pre-built models）</a>；或者花更多时间在 TensorFlow 的官方<a href=\"https://www.tensorflow.org/versions/r0.8/tutorials/\">教程</a>和<a href=\"https://www.tensorflow.org/versions/r0.8/how_tos/\">文档（how-to guides）</a>。加油吧！</p>\n<h2><strong>致谢</strong></h2>\n<p>感谢 Paco Nathan, Ben Lorica, 和 Marie Beaugureau 让本文成真了。感谢 Deep Learning Analytics 的 Henry Chen, Dennis Leung, 和 Paul Gulley，并感谢 DC Machine Learning Journal Club 对早期版本提供了有价值的反馈。再一次感谢 Marie Beaugureau 和 Jenn Webb，大幅提升了最终版的水准。</p>\n<h2><strong>作者介绍</strong></h2>\n<p><a href=\"https://www.oreilly.com/people/aaron-schumacher\">Aaron Schumacher</a> 是 Deep Learning Analytics 的数据科学家以及软件工程师。他在 General Assembly 和 Metis 数据科学训练营地（bootcamp）营地教授过 Python 和 R。Aaron 曾在 Booz Allen Hamilton，纽约大学和 New York City Department of Education 从事过数据方面的工作。Aaron 霹雳舞最好的赛绩是进入到了 R16 Korea 2009 individual footwork battle 的半决赛。他为能在 TensorFlow 0.9 中略尽绵力而感到骄傲。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/a506abb819712f3ff382705191f99fd3.png\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/1b97911a419986c1b5901239023b587e.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"87513\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"87513votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"87513\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zumagia\">Ree Ray</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zumagia\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/08/5ae0c1c8a5260bc7b6648f6fbd115c35.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            学习Python        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zumagia\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/zumagia/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zumagia/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-04-04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/bac69409940954b508b533a76b2ead83.jpg"], "title": "你好，TensorFlow", "fav_nums": 4}
